import{h as t,r as e,c as i,H as s}from"./p-ccfcf823.js";import"./p-7005d10f.js";import"./p-4b404e74.js";import"./p-7e1544ef.js";import{F as r}from"./p-e0116696.js";import{l as n,g as o}from"./p-eaa13968.js";
/**
 * @license
 * Copyright (c) Peculiar Ventures, LLC.
 *
 * This source code is licensed under the BSD 3-Clause license found in the
 * LICENSE file in the root directory of this source tree.
 */const a=e=>t("svg",Object.assign({},e,{width:"24",height:"34",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.11 11.877c.024.03.05.058.081.082l3.016 3.015a.5.5 0 10.707-.707l-1.952-1.952c-.144-.144-.454-.33-.454-.33s.313.083.499.083H16.5a.5.5 0 100-1H7.997c-.19 0-.508.078-.508.078s.311-.178.455-.322l1.97-1.97a.5.5 0 10-.707-.708l-3.121 3.121a.31.31 0 00-.017.05.497.497 0 00.017.531c0 .002.023.03.023.03z",fill:"#6D7D87"}));
/**
 * @license
 * Copyright (c) Peculiar Ventures, LLC.
 *
 * This source code is licensed under the BSD 3-Clause license found in the
 * LICENSE file in the root directory of this source tree.
 */
var c,h=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};const d=class{constructor(t){e(this,t),this.cancel=i(this,"cancel",7),this.continue=i(this,"continue",7),c.set(this,void 0),this.filters={},this.providers=[],this.certificates=[],this.isFetching={connectionDetect:"pending"},this.onClickCancel=()=>{this.cancel.emit()},this.onClickContinue=()=>{const t=this.certificates.find(t=>t.index===this.certificateSelectedIndex);t&&this.continue.emit({certificateId:t.index,providerId:t.providerID,server:h(this,c).server,privateKeyId:t.privateKeyId})},this.onClickUpdateCertificates=()=>{this.tryGetData()},this.onClickTryAgain=async()=>{await this.tryLogin()&&await this.tryGetData()},this.onClickCloseDetails=()=>{this.certificateBase64ForDetails=null},this.onClickCertificate=t=>{this.certificateSelectedIndex=t},this.onClickCertificateDetails=async(t,e)=>{this.certificateBase64ForDetails=await h(this,c).getCertificateBodyById(t,e)}}componentWillLoad(){n.setLocale(this.language)}componentDidLoad(){(function(t,e,i){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");e.set(t,i)})(this,c,new r({onClose:this.onClose.bind(this),onProvidersAdded:this.tryGetData.bind(this),onProvidersRemoved:this.tryGetData.bind(this),filters:this.filters})),this.start()}componentDidUnload(){h(this,c).finish()}onClose(){this.providers=[],this.certificates=[],this.certificateSelectedIndex=void 0,this.certificateBase64ForDetails=void 0,this.setFetching("connectionDetect","rejected")}async start(){if(this.setFetching("connectionDetect","pending"),h(this,c).isConnectionSupported()){await h(this,c).isConnectionDetected()||this.setFetching("connectionDetect","rejected"),await h(this,c).isConnectionDetectedAuto(),this.setFetching("connectionDetect","pending");try{await h(this,c).connect()}catch(t){return console.error(t),void(t&&t.message&&-1!==t.message.indexOf("update your client to the latest version")&&this.setFetching("connectionClientUpdate","rejected"))}await this.tryLogin()&&await this.tryGetData()}else this.setFetching("connectionSupport","rejected")}async tryGetData(){this.setFetching("providers","pending"),this.certificateSelectedIndex=void 0,this.providers=[],this.certificates=[];try{this.providers=await h(this,c).getProviders(),this.setFetching("providers","resolved")}catch(t){return void this.setFetching("providers","rejected")}this.setFetching("certificates","pending");try{this.certificates=await h(this,c).getCertificatesByProviders(this.providers),this.setFetching("certificates","resolved")}catch(t){this.setFetching("certificates","rejected")}}async tryLogin(){this.challenge=void 0,this.setFetching("connectionApprove","pending");try{const t=await h(this,c).challenge();t&&(this.challenge=t,await h(this,c).login()),this.setFetching("connectionApprove","resolved")}catch(t){return void this.setFetching("connectionApprove","rejected")}return!0}setFetching(t,e){this.isFetching=Object.assign(Object.assign({},this.isFetching),{[t]:e})}static renderConnecting(){return t("peculiar-fortify-connecting",null)}static renderFortifyAuthorization(e){return t("peculiar-fortify-authorization",{pin:e})}renderFortifyNotDetected(){return t("peculiar-fortify-not-detected",{downloadAppLink:this.downloadAppLink})}renderFortifyClientUpdate(){return t("peculiar-fortify-client-update",{downloadAppLink:this.downloadAppLink})}static renderFortifyNotSupported(){return t("peculiar-fortify-not-supported",null)}renderChallengeNotApproved(){return t("peculiar-fortify-challenge-not-approved",{onCancel:this.onClickCancel,onTryAgain:this.onClickTryAgain})}renderCertificates(){return t("peculiar-fortify-certificates-list",{certificates:this.certificates,certificateSelectedIndex:this.certificateSelectedIndex,onCertificate:this.onClickCertificate,onCertificateDetails:this.onClickCertificateDetails,onUpdate:this.onClickUpdateCertificates,onCancel:this.onClickCancel,onContinue:this.onClickContinue,loading:"pending"===this.isFetching.certificates||"pending"===this.isFetching.providers,allowContinue:!!this.certificateSelectedIndex})}renderProvidersEmpty(){return t("peculiar-fortify-providers-empty",{onCancel:this.onClickCancel})}static renderUnresolvedStatus(){return t("peculiar-fortify-layout",{type:"message",titleValue:"Someting went wrong for status",descriptionValue:"ERROR"})}render(){let e=null;switch(!0){case"rejected"===this.isFetching.connectionClientUpdate:e=this.renderFortifyClientUpdate();break;case"rejected"===this.isFetching.connectionSupport:e=d.renderFortifyNotSupported();break;case"rejected"===this.isFetching.connectionDetect:e=this.renderFortifyNotDetected();break;case"rejected"===this.isFetching.connectionApprove:e=this.renderChallengeNotApproved();break;case"pending"===this.isFetching.connectionApprove&&!!this.challenge:e=d.renderFortifyAuthorization(this.challenge);break;case"resolved"===this.isFetching.providers&&!this.providers.length:e=this.renderProvidersEmpty();break;case"pending"===this.isFetching.providers&&!!this.providers.length:case!!this.isFetching.certificates:e=this.renderCertificates();break;case"pending"===this.isFetching.connectionDetect:case"pending"===this.isFetching.connectionSupport:case"pending"===this.isFetching.connectionApprove:case"pending"===this.isFetching.providers:e=d.renderConnecting();break;default:e=d.renderUnresolvedStatus()}return t(s,null,t("peculiar-fortify-layout",{hideFooter:this.hideFooter},this.certificateBase64ForDetails&&t("div",{class:"container_details"},t("header",{class:"container_details_header"},t("peculiar-fortify-typography",{type:"h4",align:"center",ellipsis:!0},o("details.title")),t("peculiar-fortify-button",{class:"container_details_button",onClick:this.onClickCloseDetails,"aria-label":"Close details",size:"small"},t(a,{slot:"icon"}),o("actions.back"))),t("div",{class:"container_details_content"},t("peculiar-certificate-viewer",{certificate:this.certificateBase64ForDetails,view:"mobile"}))),e))}};c=new WeakMap,d.style=":host{-webkit-box-sizing:border-box;box-sizing:border-box}:host *,:host *:before,:host *:after{-webkit-box-sizing:inherit;box-sizing:inherit}:host{display:block;min-height:550px;height:550px}.container_details{position:absolute;width:100%;height:100%;top:0;left:0;z-index:1;background-color:white;background-color:rgba(var(--pv-color-light-rgb), 1)}.container_details_header{border-bottom-width:1px;border-bottom-style:solid;padding:10px 100px;position:relative;height:45px;border-color:#e1e4e6;border-color:rgba(var(--pv-color-grey_3-rgb), 1)}.container_details_button{position:absolute;top:50%;left:8px;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.container_details_content{height:calc(100% - 45px);overflow:auto}";export{d as peculiar_fortify_certificates}