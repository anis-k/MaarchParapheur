var __extends=this&&this.__extends||function(){var e=function(t,r){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return e(t,r)};return function(t,r){e(t,r);function i(){this.constructor=t}t.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}();var __awaiter=this&&this.__awaiter||function(e,t,r,i){function a(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,n){function s(e){try{u(i.next(e))}catch(t){n(t)}}function o(e){try{u(i["throw"](e))}catch(t){n(t)}}function u(e){e.done?r(e.value):a(e.value).then(s,o)}u((i=i.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,a,n,s;return s={next:o(0),throw:o(1),return:o(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(e){return function(t){return u([e,t])}}function u(s){if(i)throw new TypeError("Generator is already executing.");while(r)try{if(i=1,a&&(n=s[0]&2?a["return"]:s[0]?a["throw"]||((n=a["return"])&&n.call(a),0):a.next)&&!(n=n.call(a,s[1])).done)return n;if(a=0,n)s=[s[0]&2,n.value];switch(s[0]){case 0:case 1:n=s;break;case 4:r.label++;return{value:s[1],done:false};case 5:r.label++;a=s[1];s=[0];continue;case 7:s=r.ops.pop();r.trys.pop();continue;default:if(!(n=r.trys,n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1];n=s;break}if(n&&r.label<n[2]){r.label=n[2];r.ops.push(s);break}if(n[2])r.ops.pop();r.trys.pop();continue}s=t.call(e,r)}catch(o){s=[6,o];a=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var __spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var i=Array(e),a=0,t=0;t<r;t++)for(var n=arguments[t],s=0,o=n.length;s<o;s++,a++)i[a]=n[s];return i};System.register(["./p-91a27287.system.js","./p-1c4a40aa.system.js"],(function(e,t){"use strict";var r,i,a,n,s,o,u,l,c,h,f,m,p,v,d,y,g,b,w,k,A,S,C,P,I,N,B,x,E,V,_,L,j,D,K,O,U,H,R,J,M,q,T,F,W,Q,G,z,Y,X,$,Z,ee;return{setters:[function(e){r=e.af;i=e.ag;a=e.ah;n=e.ai;s=e.aj;o=e.ak;u=e.al;l=e.am;c=e.an;h=e.ao;f=e.ap;m=e.aq;p=e.ar;v=e.as;d=e.at;y=e.au;g=e.av;b=e.aw;w=e.ax;k=e.ay;A=e.az;S=e.aA;C=e.aB;P=e.aC;I=e.aD;N=e.aE;B=e.aF;x=e.aG;E=e.P;V=e.aH;_=e.aI;L=e.aJ;j=e.aK;D=e.aL;K=e.aM;O=e.aN;U=e.aO;H=e.aP;R=e.aQ;J=e.aR;M=e.aS;q=e.aT;T=e.f;F=e.m;W=e.t;Q=e.j;G=e.Q;z=e.a2;Y=e.C;X=e.J;$=e.L;Z=e.l},function(e){ee=e.i}],execute:function(){var te;var re=this;e({E:void 0,a:void 0,b:void 0});
/**
             * @license
             * Copyright (c) Peculiar Ventures, LLC.
             *
             * This source code is licensed under the BSD 3-Clause license found in the
             * LICENSE file in the root directory of this source tree.
             */function ie(){return/firefox/i.test(window.navigator.userAgent)}function ae(){return/edge\/([\d.]+)/i.test(window.navigator.userAgent)}function ne(){return!!window.document.documentMode}
/**
             * @license
             * Copyright (c) Peculiar Ventures, LLC.
             *
             * This source code is licensed under the BSD 3-Clause license found in the
             * LICENSE file in the root directory of this source tree.
             */if(!Uint8Array.prototype.slice){Object.defineProperty(Uint8Array.prototype,"slice",{value:function(e,t){return new Uint8Array(Array.prototype.slice.call(this,e,t))}})}var se=function(){return __awaiter(re,void 0,void 0,(function(){var e,r,i,a;return __generator(this,(function(n){switch(n.label){case 0:if(!(ae()||ie()||ne()))return[3,6];if(!!window["asmCrypto"])return[3,2];e=window;r="asmCrypto";return[4,t.import("./p-7472e510.system.js")];case 1:e[r]=n.sent();n.label=2;case 2:if(!!window["elliptic"])return[3,4];i=window;a="elliptic";return[4,t.import("./p-0ce4a42b.system.js").then((function(e){return e.e}))];case 3:i[a]=n.sent().default;n.label=4;case 4:return[4,t.import("./p-bbaf40db.system.js")];case 5:n.sent();n.label=6;case 6:if(!!window["protobuf"])return[3,8];return[4,t.import("./p-9dfa5572.system.js").then((function(e){return e.p}))];case 7:n.sent();n.label=8;case 8:if(!!window["WebcryptoSocket"])return[3,10];return[4,t.import("./p-03624b08.system.js")];case 9:n.sent();n.label=10;case 10:return[2]}}))}))};var oe=/iPhone/i;var ue=/iPod/i;var le=/iPad/i;var ce=/\biOS-universal(?:.+)Mac\b/i;var he=/\bAndroid(?:.+)Mobile\b/i;var fe=/Android/i;var me=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i;var pe=/Silk/i;var ve=/Windows Phone/i;var de=/\bWindows(?:.+)ARM\b/i;var ye=/BlackBerry/i;var ge=/BB10/i;var be=/Opera Mini/i;var we=/\b(CriOS|Chrome)(?:.+)Mobile/i;var ke=/Mobile(?:.+)Firefox\b/i;var Ae=function(e){return typeof e!=="undefined"&&e.platform==="MacIntel"&&typeof e.maxTouchPoints==="number"&&e.maxTouchPoints>1&&typeof MSStream==="undefined"};function Se(e){return function(t){return t.test(e)}}function Ce(e){var t={userAgent:"",platform:"",maxTouchPoints:0};if(!e&&typeof navigator!=="undefined"){t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}}else if(typeof e==="string"){t.userAgent=e}else if(e&&e.userAgent){t={userAgent:e.userAgent,platform:e.platform,maxTouchPoints:e.maxTouchPoints||0}}var r=t.userAgent;var i=r.split("[FBAN");if(typeof i[1]!=="undefined"){r=i[0]}i=r.split("Twitter");if(typeof i[1]!=="undefined"){r=i[0]}var a=Se(r);var n={apple:{phone:a(oe)&&!a(ve),ipod:a(ue),tablet:!a(oe)&&(a(le)||Ae(t))&&!a(ve),universal:a(ce),device:(a(oe)||a(ue)||a(le)||a(ce)||Ae(t))&&!a(ve)},amazon:{phone:a(me),tablet:!a(me)&&a(pe),device:a(me)||a(pe)},android:{phone:!a(ve)&&a(me)||!a(ve)&&a(he),tablet:!a(ve)&&!a(me)&&!a(he)&&(a(pe)||a(fe)),device:!a(ve)&&(a(me)||a(pe)||a(he)||a(fe))||a(/\bokhttp\b/i)},windows:{phone:a(ve),tablet:a(de),device:a(ve)||a(de)},other:{blackberry:a(ye),blackberry10:a(ge),opera:a(be),firefox:a(ke),chrome:a(we),device:a(ye)||a(ge)||a(be)||a(ke)||a(we)},any:false,phone:false,tablet:false};n.any=n.apple.device||n.android.device||n.windows.device||n.other.device;n.phone=n.apple.phone||n.android.phone||n.windows.phone;n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet;return n}var Pe=function(){function e(t){if(t===void 0){t={}}this.algorithmId=r(t,"algorithmId",e.defaultValues("algorithmId"));if("algorithmParams"in t)this.algorithmParams=r(t,"algorithmParams",e.defaultValues("algorithmParams"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"algorithmId":return"";case"algorithmParams":return new i;default:throw new Error("Invalid member name for AlgorithmIdentifier class: "+e)}};e.compareWithDefault=function(e,t){switch(e){case"algorithmId":return t==="";case"algorithmParams":return t instanceof i;default:throw new Error("Invalid member name for AlgorithmIdentifier class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",optional:t.optional||false,value:[new n({name:t.algorithmIdentifier||""}),new i({name:t.algorithmParams||"",optional:true})]})};e.prototype.fromSchema=function(t){s(t,["algorithm","params"]);var r=o(t,t,e.schema({names:{algorithmIdentifier:"algorithm",algorithmParams:"params"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for AlgorithmIdentifier");this.algorithmId=r.result.algorithm.valueBlock.toString();if("params"in r.result)this.algorithmParams=r.result.params};e.prototype.toSchema=function(){var e=[];e.push(new n({value:this.algorithmId}));if("algorithmParams"in this&&this.algorithmParams instanceof i===false)e.push(this.algorithmParams);return new a({value:e})};e.prototype.toJSON=function(){var e={algorithmId:this.algorithmId};if("algorithmParams"in this&&this.algorithmParams instanceof i===false)e.algorithmParams=this.algorithmParams.toJSON();return e};e.prototype.isEqual=function(t){if(t instanceof e===false)return false;if(this.algorithmId!==t.algorithmId)return false;if("algorithmParams"in this){if("algorithmParams"in t)return JSON.stringify(this.algorithmParams)===JSON.stringify(t.algorithmParams);return false}if("algorithmParams"in t)return false;return true};return e}();var Ie=function(){function e(t){if(t===void 0){t={}}this.x=r(t,"x",e.defaultValues("x"));this.y=r(t,"y",e.defaultValues("y"));this.namedCurve=r(t,"namedCurve",e.defaultValues("namedCurve"));if("schema"in t)this.fromSchema(t.schema);if("json"in t)this.fromJSON(t.json)}e.defaultValues=function(e){switch(e){case"x":case"y":return new ArrayBuffer(0);case"namedCurve":return"";default:throw new Error("Invalid member name for ECCPublicKey class: "+e)}};e.compareWithDefault=function(t,r){switch(t){case"x":case"y":return u(r,e.defaultValues(t));case"namedCurve":return r==="";default:throw new Error("Invalid member name for ECCPublicKey class: "+t)}};e.schema=function(e){if(e===void 0){e={}}return new l};e.prototype.fromSchema=function(e){if(e instanceof ArrayBuffer===false)throw new Error("Object's schema was not verified against input data for ECPublicKey");var t=new Uint8Array(e);if(t[0]!==4)throw new Error("Object's schema was not verified against input data for ECPublicKey");var r;switch(this.namedCurve){case"1.2.840.10045.3.1.7":r=32;break;case"1.3.132.0.34":r=48;break;case"1.3.132.0.35":r=66;break;default:throw new Error("Incorrect curve OID: "+this.namedCurve)}if(e.byteLength!==r*2+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.x=e.slice(1,r+1);this.y=e.slice(1+r,r*2+1)};e.prototype.toSchema=function(){return new l({data:c(new Uint8Array([4]).buffer,this.x,this.y)})};e.prototype.toJSON=function(){var e="";switch(this.namedCurve){case"1.2.840.10045.3.1.7":e="P-256";break;case"1.3.132.0.34":e="P-384";break;case"1.3.132.0.35":e="P-521";break}return{crv:e,x:h(f(this.x),true,true,false),y:h(f(this.y),true,true,false)}};e.prototype.fromJSON=function(e){var t=0;if("crv"in e){switch(e.crv.toUpperCase()){case"P-256":this.namedCurve="1.2.840.10045.3.1.7";t=32;break;case"P-384":this.namedCurve="1.3.132.0.34";t=48;break;case"P-521":this.namedCurve="1.3.132.0.35";t=66;break}}else throw new Error('Absent mandatory parameter "crv"');if("x"in e){var r=m(p(e.x,true));if(r.byteLength<t){this.x=new ArrayBuffer(t);var i=new Uint8Array(this.x);var a=new Uint8Array(r);i.set(a,1)}else this.x=r.slice(0,t)}else throw new Error('Absent mandatory parameter "x"');if("y"in e){var r=m(p(e.y,true));if(r.byteLength<t){this.y=new ArrayBuffer(t);var i=new Uint8Array(this.y);var a=new Uint8Array(r);i.set(a,1)}else this.y=r.slice(0,t)}else throw new Error('Absent mandatory parameter "y"')};return e}();var Ne=function(){function e(t){if(t===void 0){t={}}this.modulus=r(t,"modulus",e.defaultValues("modulus"));this.publicExponent=r(t,"publicExponent",e.defaultValues("publicExponent"));if("schema"in t)this.fromSchema(t.schema);if("json"in t)this.fromJSON(t.json)}e.defaultValues=function(e){switch(e){case"modulus":return new v;case"publicExponent":return new v;default:throw new Error("Invalid member name for RSAPublicKey class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new v({name:t.modulus||""}),new v({name:t.publicExponent||""})]})};e.prototype.fromSchema=function(t){s(t,["modulus","publicExponent"]);var r=o(t,t,e.schema({names:{modulus:"modulus",publicExponent:"publicExponent"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for RSAPublicKey");this.modulus=r.result.modulus.convertFromDER(256);this.publicExponent=r.result.publicExponent};e.prototype.toSchema=function(){return new a({value:[this.modulus.convertToDER(),this.publicExponent]})};e.prototype.toJSON=function(){return{n:h(f(this.modulus.valueBlock.valueHex),true,true,true),e:h(f(this.publicExponent.valueBlock.valueHex),true,true,true)}};e.prototype.fromJSON=function(e){if("n"in e){var t=m(p(e.n,true));this.modulus=new v({valueHex:t.slice(0,Math.pow(2,d(t.byteLength)))})}else throw new Error('Absent mandatory parameter "n"');if("e"in e)this.publicExponent=new v({valueHex:m(p(e.e,true)).slice(0,3)});else throw new Error('Absent mandatory parameter "e"')};return e}();var Be=function(){function e(t){if(t===void 0){t={}}this.algorithm=r(t,"algorithm",e.defaultValues("algorithm"));this.subjectPublicKey=r(t,"subjectPublicKey",e.defaultValues("subjectPublicKey"));if("parsedKey"in t)this.parsedKey=r(t,"parsedKey",e.defaultValues("parsedKey"));if("schema"in t)this.fromSchema(t.schema);if("json"in t)this.fromJSON(t.json)}e.defaultValues=function(e){switch(e){case"algorithm":return new Pe;case"subjectPublicKey":return new y;default:throw new Error("Invalid member name for PublicKeyInfo class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[Pe.schema(t.algorithm||{}),new y({name:t.subjectPublicKey||""})]})};e.prototype.fromSchema=function(t){s(t,["algorithm","subjectPublicKey"]);var r=o(t,t,e.schema({names:{algorithm:{names:{blockName:"algorithm"}},subjectPublicKey:"subjectPublicKey"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for PublicKeyInfo");this.algorithm=new Pe({schema:r.result.algorithm});this.subjectPublicKey=r.result.subjectPublicKey;switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm){if(this.algorithm.algorithmParams.constructor.blockName()===n.blockName()){try{this.parsedKey=new Ie({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHex})}catch(a){}}}break;case"1.2.840.113549.1.1.1":{var i=g(this.subjectPublicKey.valueBlock.valueHex);if(i.offset!==-1){try{this.parsedKey=new Ne({schema:i.result})}catch(a){}}}break}};e.prototype.toSchema=function(){return new a({value:[this.algorithm.toSchema(),this.subjectPublicKey]})};e.prototype.toJSON=function(){if("parsedKey"in this===false){return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()}}var e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA";break}var t=this.parsedKey.toJSON();for(var r=0,i=Object.keys(t);r<i.length;r++){var a=i[r];e[a]=t[a]}return e};e.prototype.fromJSON=function(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Ie({json:e});this.algorithm=new Pe({algorithmId:"1.2.840.10045.2.1",algorithmParams:new n({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new Ne({json:e});this.algorithm=new Pe({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new b});break;default:throw new Error('Invalid value for "kty" parameter: '+e.kty)}this.subjectPublicKey=new y({valueHex:this.parsedKey.toSchema().toBER(false)})}};e.prototype.importKey=function(e){var t=Promise.resolve();var r=this;if(typeof e==="undefined")return Promise.reject("Need to provide publicKey input parameter");var i=qe();if(typeof i==="undefined")return Promise.reject("Unable to create WebCrypto object");t=t.then((function(){return i.exportKey("spki",e)}));t=t.then((function(e){var t=g(e);try{r.fromSchema(t.result)}catch(i){return Promise.reject("Error during initializing object from schema")}return undefined}),(function(e){return Promise.reject("Error during exporting public key: "+e)}));return t};return e}();var xe=function(){function e(t){if(t===void 0){t={}}this.type=r(t,"type",e.defaultValues("type"));this.values=r(t,"values",e.defaultValues("values"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"type":return"";case"values":return[];default:throw new Error("Invalid member name for Attribute class: "+e)}};e.compareWithDefault=function(e,t){switch(e){case"type":return t==="";case"values":return t.length===0;default:throw new Error("Invalid member name for Attribute class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new n({name:t.type||""}),new w({name:t.setName||"",value:[new k({name:t.values||"",value:new i})]})]})};e.prototype.fromSchema=function(t){s(t,["type","values"]);var r=o(t,t,e.schema({names:{type:"type",values:"values"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for Attribute");this.type=r.result.type.valueBlock.toString();this.values=r.result.values};e.prototype.toSchema=function(){return new a({value:[new n({value:this.type}),new w({value:this.values})]})};e.prototype.toJSON=function(){return{type:this.type,values:Array.from(this.values,(function(e){return e.toJSON()}))}};return e}();var Ee=function(){function e(t){if(t===void 0){t={}}this.version=r(t,"version",e.defaultValues("version"));this.privateKey=r(t,"privateKey",e.defaultValues("privateKey"));if("namedCurve"in t)this.namedCurve=r(t,"namedCurve",e.defaultValues("namedCurve"));if("publicKey"in t)this.publicKey=r(t,"publicKey",e.defaultValues("publicKey"));if("schema"in t)this.fromSchema(t.schema);if("json"in t)this.fromJSON(t.json)}e.defaultValues=function(e){switch(e){case"version":return 1;case"privateKey":return new A;case"namedCurve":return"";case"publicKey":return new Ie;default:throw new Error("Invalid member name for ECCPrivateKey class: "+e)}};e.compareWithDefault=function(t,r){switch(t){case"version":return r===e.defaultValues(t);case"privateKey":return r.isEqual(e.defaultValues(t));case"namedCurve":return r==="";case"publicKey":return Ie.compareWithDefault("namedCurve",r.namedCurve)&&Ie.compareWithDefault("x",r.x)&&Ie.compareWithDefault("y",r.y);default:throw new Error("Invalid member name for ECCPrivateKey class: "+t)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new v({name:t.version||""}),new A({name:t.privateKey||""}),new S({optional:true,idBlock:{tagClass:3,tagNumber:0},value:[new n({name:t.namedCurve||""})]}),new S({optional:true,idBlock:{tagClass:3,tagNumber:1},value:[new y({name:t.publicKey||""})]})]})};e.prototype.fromSchema=function(t){s(t,["version","privateKey","namedCurve","publicKey"]);var r=o(t,t,e.schema({names:{version:"version",privateKey:"privateKey",namedCurve:"namedCurve",publicKey:"publicKey"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for ECPrivateKey");this.version=r.result.version.valueBlock.valueDec;this.privateKey=r.result.privateKey;if("namedCurve"in r.result)this.namedCurve=r.result.namedCurve.valueBlock.toString();if("publicKey"in r.result){var i={schema:r.result.publicKey.valueBlock.valueHex};if("namedCurve"in this)i.namedCurve=this.namedCurve;this.publicKey=new Ie(i)}};e.prototype.toSchema=function(){var e=[new v({value:this.version}),this.privateKey];if("namedCurve"in this){e.push(new S({idBlock:{tagClass:3,tagNumber:0},value:[new n({value:this.namedCurve})]}))}if("publicKey"in this){e.push(new S({idBlock:{tagClass:3,tagNumber:1},value:[new y({valueHex:this.publicKey.toSchema().toBER(false)})]}))}return new a({value:e})};e.prototype.toJSON=function(){if("namedCurve"in this===false||e.compareWithDefault("namedCurve",this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');var t="";switch(this.namedCurve){case"1.2.840.10045.3.1.7":t="P-256";break;case"1.3.132.0.34":t="P-384";break;case"1.3.132.0.35":t="P-521";break}var r={crv:t,d:h(f(this.privateKey.valueBlock.valueHex),true,true,false)};if("publicKey"in this){var i=this.publicKey.toJSON();r.x=i.x;r.y=i.y}return r};e.prototype.fromJSON=function(e){var t=0;if("crv"in e){switch(e.crv.toUpperCase()){case"P-256":this.namedCurve="1.2.840.10045.3.1.7";t=32;break;case"P-384":this.namedCurve="1.3.132.0.34";t=48;break;case"P-521":this.namedCurve="1.3.132.0.35";t=66;break}}else throw new Error('Absent mandatory parameter "crv"');if("d"in e){var r=m(p(e.d,true));if(r.byteLength<t){var i=new ArrayBuffer(t);var a=new Uint8Array(i);var n=new Uint8Array(r);a.set(n,1);this.privateKey=new A({valueHex:i})}else this.privateKey=new A({valueHex:r.slice(0,t)})}else throw new Error('Absent mandatory parameter "d"');if("x"in e&&"y"in e)this.publicKey=new Ie({json:e})};return e}();var Ve=function(){function e(t){if(t===void 0){t={}}this.prime=r(t,"prime",e.defaultValues("prime"));this.exponent=r(t,"exponent",e.defaultValues("exponent"));this.coefficient=r(t,"coefficient",e.defaultValues("coefficient"));if("schema"in t)this.fromSchema(t.schema);if("json"in t)this.fromJSON(t.json)}e.defaultValues=function(e){switch(e){case"prime":return new v;case"exponent":return new v;case"coefficient":return new v;default:throw new Error("Invalid member name for OtherPrimeInfo class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new v({name:t.prime||""}),new v({name:t.exponent||""}),new v({name:t.coefficient||""})]})};e.prototype.fromSchema=function(t){s(t,["prime","exponent","coefficient"]);var r=o(t,t,e.schema({names:{prime:"prime",exponent:"exponent",coefficient:"coefficient"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for OtherPrimeInfo");this.prime=r.result.prime.convertFromDER();this.exponent=r.result.exponent.convertFromDER();this.coefficient=r.result.coefficient.convertFromDER()};e.prototype.toSchema=function(){return new a({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})};e.prototype.toJSON=function(){return{r:h(f(this.prime.valueBlock.valueHex),true,true),d:h(f(this.exponent.valueBlock.valueHex),true,true),t:h(f(this.coefficient.valueBlock.valueHex),true,true)}};e.prototype.fromJSON=function(e){if("r"in e)this.prime=new v({valueHex:m(p(e.r,true))});else throw new Error('Absent mandatory parameter "r"');if("d"in e)this.exponent=new v({valueHex:m(p(e.d,true))});else throw new Error('Absent mandatory parameter "d"');if("t"in e)this.coefficient=new v({valueHex:m(p(e.t,true))});else throw new Error('Absent mandatory parameter "t"')};return e}();var _e=function(){function e(t){if(t===void 0){t={}}this.version=r(t,"version",e.defaultValues("version"));this.modulus=r(t,"modulus",e.defaultValues("modulus"));this.publicExponent=r(t,"publicExponent",e.defaultValues("publicExponent"));this.privateExponent=r(t,"privateExponent",e.defaultValues("privateExponent"));this.prime1=r(t,"prime1",e.defaultValues("prime1"));this.prime2=r(t,"prime2",e.defaultValues("prime2"));this.exponent1=r(t,"exponent1",e.defaultValues("exponent1"));this.exponent2=r(t,"exponent2",e.defaultValues("exponent2"));this.coefficient=r(t,"coefficient",e.defaultValues("coefficient"));if("otherPrimeInfos"in t)this.otherPrimeInfos=r(t,"otherPrimeInfos",e.defaultValues("otherPrimeInfos"));if("schema"in t)this.fromSchema(t.schema);if("json"in t)this.fromJSON(t.json)}e.defaultValues=function(e){switch(e){case"version":return 0;case"modulus":return new v;case"publicExponent":return new v;case"privateExponent":return new v;case"prime1":return new v;case"prime2":return new v;case"exponent1":return new v;case"exponent2":return new v;case"coefficient":return new v;case"otherPrimeInfos":return[];default:throw new Error("Invalid member name for RSAPrivateKey class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new v({name:t.version||""}),new v({name:t.modulus||""}),new v({name:t.publicExponent||""}),new v({name:t.privateExponent||""}),new v({name:t.prime1||""}),new v({name:t.prime2||""}),new v({name:t.exponent1||""}),new v({name:t.exponent2||""}),new v({name:t.coefficient||""}),new a({optional:true,value:[new k({name:t.otherPrimeInfosName||"",value:Ve.schema(t.otherPrimeInfo||{})})]})]})};e.prototype.fromSchema=function(t){s(t,["version","modulus","publicExponent","privateExponent","prime1","prime2","exponent1","exponent2","coefficient","otherPrimeInfos"]);var r=o(t,t,e.schema({names:{version:"version",modulus:"modulus",publicExponent:"publicExponent",privateExponent:"privateExponent",prime1:"prime1",prime2:"prime2",exponent1:"exponent1",exponent2:"exponent2",coefficient:"coefficient",otherPrimeInfo:{names:{blockName:"otherPrimeInfos"}}}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for RSAPrivateKey");this.version=r.result.version.valueBlock.valueDec;this.modulus=r.result.modulus.convertFromDER(256);this.publicExponent=r.result.publicExponent;this.privateExponent=r.result.privateExponent.convertFromDER(256);this.prime1=r.result.prime1.convertFromDER(128);this.prime2=r.result.prime2.convertFromDER(128);this.exponent1=r.result.exponent1.convertFromDER(128);this.exponent2=r.result.exponent2.convertFromDER(128);this.coefficient=r.result.coefficient.convertFromDER(128);if("otherPrimeInfos"in r.result)this.otherPrimeInfos=Array.from(r.result.otherPrimeInfos,(function(e){return new Ve({schema:e})}))};e.prototype.toSchema=function(){var e=[];e.push(new v({value:this.version}));e.push(this.modulus.convertToDER());e.push(this.publicExponent);e.push(this.privateExponent.convertToDER());e.push(this.prime1.convertToDER());e.push(this.prime2.convertToDER());e.push(this.exponent1.convertToDER());e.push(this.exponent2.convertToDER());e.push(this.coefficient.convertToDER());if("otherPrimeInfos"in this){e.push(new a({value:Array.from(this.otherPrimeInfos,(function(e){return e.toSchema()}))}))}return new a({value:e})};e.prototype.toJSON=function(){var e={n:h(f(this.modulus.valueBlock.valueHex),true,true,true),e:h(f(this.publicExponent.valueBlock.valueHex),true,true,true),d:h(f(this.privateExponent.valueBlock.valueHex),true,true,true),p:h(f(this.prime1.valueBlock.valueHex),true,true,true),q:h(f(this.prime2.valueBlock.valueHex),true,true,true),dp:h(f(this.exponent1.valueBlock.valueHex),true,true,true),dq:h(f(this.exponent2.valueBlock.valueHex),true,true,true),qi:h(f(this.coefficient.valueBlock.valueHex),true,true,true)};if("otherPrimeInfos"in this)e.oth=Array.from(this.otherPrimeInfos,(function(e){return e.toJSON()}));return e};e.prototype.fromJSON=function(e){if("n"in e)this.modulus=new v({valueHex:m(p(e.n,true,true))});else throw new Error('Absent mandatory parameter "n"');if("e"in e)this.publicExponent=new v({valueHex:m(p(e.e,true,true))});else throw new Error('Absent mandatory parameter "e"');if("d"in e)this.privateExponent=new v({valueHex:m(p(e.d,true,true))});else throw new Error('Absent mandatory parameter "d"');if("p"in e)this.prime1=new v({valueHex:m(p(e.p,true,true))});else throw new Error('Absent mandatory parameter "p"');if("q"in e)this.prime2=new v({valueHex:m(p(e.q,true,true))});else throw new Error('Absent mandatory parameter "q"');if("dp"in e)this.exponent1=new v({valueHex:m(p(e.dp,true,true))});else throw new Error('Absent mandatory parameter "dp"');if("dq"in e)this.exponent2=new v({valueHex:m(p(e.dq,true,true))});else throw new Error('Absent mandatory parameter "dq"');if("qi"in e)this.coefficient=new v({valueHex:m(p(e.qi,true,true))});else throw new Error('Absent mandatory parameter "qi"');if("oth"in e)this.otherPrimeInfos=Array.from(e.oth,(function(e){return new Ve({json:e})}))};return e}();var Le=function(){function e(t){if(t===void 0){t={}}this.version=r(t,"version",e.defaultValues("version"));this.privateKeyAlgorithm=r(t,"privateKeyAlgorithm",e.defaultValues("privateKeyAlgorithm"));this.privateKey=r(t,"privateKey",e.defaultValues("privateKey"));if("attributes"in t)this.attributes=r(t,"attributes",e.defaultValues("attributes"));if("parsedKey"in t)this.parsedKey=r(t,"parsedKey",e.defaultValues("parsedKey"));if("schema"in t)this.fromSchema(t.schema);if("json"in t)this.fromJSON(t.json)}e.defaultValues=function(e){switch(e){case"version":return 0;case"privateKeyAlgorithm":return new Pe;case"privateKey":return new A;case"attributes":return[];case"parsedKey":return{};default:throw new Error("Invalid member name for PrivateKeyInfo class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new v({name:t.version||""}),Pe.schema(t.privateKeyAlgorithm||{}),new A({name:t.privateKey||""}),new S({optional:true,idBlock:{tagClass:3,tagNumber:0},value:[new k({name:t.attributes||"",value:xe.schema()})]})]})};e.prototype.fromSchema=function(t){s(t,["version","privateKeyAlgorithm","privateKey","attributes"]);var r=o(t,t,e.schema({names:{version:"version",privateKeyAlgorithm:{names:{blockName:"privateKeyAlgorithm"}},privateKey:"privateKey",attributes:"attributes"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for PrivateKeyInfo");this.version=r.result.version.valueBlock.valueDec;this.privateKeyAlgorithm=new Pe({schema:r.result.privateKeyAlgorithm});this.privateKey=r.result.privateKey;if("attributes"in r.result)this.attributes=Array.from(r.result.attributes,(function(e){return new xe({schema:e})}));switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":{var i=g(this.privateKey.valueBlock.valueHex);if(i.offset!==-1)this.parsedKey=new _e({schema:i.result})}break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm){if(this.privateKeyAlgorithm.algorithmParams instanceof n){var i=g(this.privateKey.valueBlock.valueHex);if(i.offset!==-1){this.parsedKey=new Ee({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:i.result})}}}break}};e.prototype.toSchema=function(){var e=[new v({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];if("attributes"in this){e.push(new S({optional:true,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,(function(e){return e.toSchema()}))}))}return new a({value:e})};e.prototype.toJSON=function(){if("parsedKey"in this===false){var e={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};if("attributes"in this)e.attributes=Array.from(this.attributes,(function(e){return e.toJSON()}));return e}var t={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":t.kty="EC";break;case"1.2.840.113549.1.1.1":t.kty="RSA";break}var r=this.parsedKey.toJSON();for(var i=0,a=Object.keys(r);i<a.length;i++){var n=a[i];t[n]=r[n]}return t};e.prototype.fromJSON=function(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Ee({json:e});this.privateKeyAlgorithm=new Pe({algorithmId:"1.2.840.10045.2.1",algorithmParams:new n({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new _e({json:e});this.privateKeyAlgorithm=new Pe({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new b});break;default:throw new Error('Invalid value for "kty" parameter: '+e.kty)}this.privateKey=new A({valueHex:this.parsedKey.toSchema().toBER(false)})}};return e}();var je=function(){function e(t){if(t===void 0){t={}}this.contentType=r(t,"contentType",e.defaultValues("contentType"));this.contentEncryptionAlgorithm=r(t,"contentEncryptionAlgorithm",e.defaultValues("contentEncryptionAlgorithm"));if("encryptedContent"in t){this.encryptedContent=t.encryptedContent;if(this.encryptedContent.idBlock.tagClass===1&&this.encryptedContent.idBlock.tagNumber===4){if(this.encryptedContent.idBlock.isConstructed===false){var i=new A({idBlock:{isConstructed:true},isConstructed:true});var a=0;var n=this.encryptedContent.valueBlock.valueHex.byteLength;while(n>0){var s=new Uint8Array(this.encryptedContent.valueBlock.valueHex,a,a+1024>this.encryptedContent.valueBlock.valueHex.byteLength?this.encryptedContent.valueBlock.valueHex.byteLength-a:1024);var o=new ArrayBuffer(s.length);var u=new Uint8Array(o);for(var l=0;l<u.length;l++)u[l]=s[l];i.valueBlock.value.push(new A({valueHex:o}));n-=s.length;a+=s.length}this.encryptedContent=i}}}if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"contentType":return"";case"contentEncryptionAlgorithm":return new Pe;case"encryptedContent":return new A;default:throw new Error("Invalid member name for EncryptedContentInfo class: "+e)}};e.compareWithDefault=function(t,r){switch(t){case"contentType":return r==="";case"contentEncryptionAlgorithm":return r.algorithmId===""&&"algorithmParams"in r===false;case"encryptedContent":return r.isEqual(e.defaultValues(t));default:throw new Error("Invalid member name for EncryptedContentInfo class: "+t)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new n({name:t.contentType||""}),Pe.schema(t.contentEncryptionAlgorithm||{}),new C({value:[new S({name:t.encryptedContent||"",idBlock:{tagClass:3,tagNumber:0},value:[new k({value:new A})]}),new P({name:t.encryptedContent||"",idBlock:{tagClass:3,tagNumber:0}})]})]})};e.prototype.fromSchema=function(t){s(t,["contentType","contentEncryptionAlgorithm","encryptedContent"]);var r=o(t,t,e.schema({names:{contentType:"contentType",contentEncryptionAlgorithm:{names:{blockName:"contentEncryptionAlgorithm"}},encryptedContent:"encryptedContent"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for EncryptedContentInfo");this.contentType=r.result.contentType.valueBlock.toString();this.contentEncryptionAlgorithm=new Pe({schema:r.result.contentEncryptionAlgorithm});if("encryptedContent"in r.result){this.encryptedContent=r.result.encryptedContent;this.encryptedContent.idBlock.tagClass=1;this.encryptedContent.idBlock.tagNumber=4}};e.prototype.toSchema=function(){var e={isIndefiniteForm:false};var t=[];t.push(new n({value:this.contentType}));t.push(this.contentEncryptionAlgorithm.toSchema());if("encryptedContent"in this){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;var r=this.encryptedContent;r.idBlock.tagClass=3;r.idBlock.tagNumber=0;r.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;t.push(r)}return new a({lenBlock:e,value:t})};e.prototype.toJSON=function(){var e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};if("encryptedContent"in this)e.encryptedContent=this.encryptedContent.toJSON();return e};return e}();var De=function(){function e(t){if(t===void 0){t={}}this.hashAlgorithm=r(t,"hashAlgorithm",e.defaultValues("hashAlgorithm"));this.maskGenAlgorithm=r(t,"maskGenAlgorithm",e.defaultValues("maskGenAlgorithm"));this.saltLength=r(t,"saltLength",e.defaultValues("saltLength"));this.trailerField=r(t,"trailerField",e.defaultValues("trailerField"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"hashAlgorithm":return new Pe({algorithmId:"1.3.14.3.2.26",algorithmParams:new b});case"maskGenAlgorithm":return new Pe({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new Pe({algorithmId:"1.3.14.3.2.26",algorithmParams:new b}).toSchema()});case"saltLength":return 20;case"trailerField":return 1;default:throw new Error("Invalid member name for RSASSAPSSParams class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new S({idBlock:{tagClass:3,tagNumber:0},optional:true,value:[Pe.schema(t.hashAlgorithm||{})]}),new S({idBlock:{tagClass:3,tagNumber:1},optional:true,value:[Pe.schema(t.maskGenAlgorithm||{})]}),new S({idBlock:{tagClass:3,tagNumber:2},optional:true,value:[new v({name:t.saltLength||""})]}),new S({idBlock:{tagClass:3,tagNumber:3},optional:true,value:[new v({name:t.trailerField||""})]})]})};e.prototype.fromSchema=function(t){s(t,["hashAlgorithm","maskGenAlgorithm","saltLength","trailerField"]);var r=o(t,t,e.schema({names:{hashAlgorithm:{names:{blockName:"hashAlgorithm"}},maskGenAlgorithm:{names:{blockName:"maskGenAlgorithm"}},saltLength:"saltLength",trailerField:"trailerField"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for RSASSAPSSParams");if("hashAlgorithm"in r.result)this.hashAlgorithm=new Pe({schema:r.result.hashAlgorithm});if("maskGenAlgorithm"in r.result)this.maskGenAlgorithm=new Pe({schema:r.result.maskGenAlgorithm});if("saltLength"in r.result)this.saltLength=r.result.saltLength.valueBlock.valueDec;if("trailerField"in r.result)this.trailerField=r.result.trailerField.valueBlock.valueDec};e.prototype.toSchema=function(){var t=[];if(!this.hashAlgorithm.isEqual(e.defaultValues("hashAlgorithm"))){t.push(new S({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]}))}if(!this.maskGenAlgorithm.isEqual(e.defaultValues("maskGenAlgorithm"))){t.push(new S({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]}))}if(this.saltLength!==e.defaultValues("saltLength")){t.push(new S({idBlock:{tagClass:3,tagNumber:2},value:[new v({value:this.saltLength})]}))}if(this.trailerField!==e.defaultValues("trailerField")){t.push(new S({idBlock:{tagClass:3,tagNumber:3},value:[new v({value:this.trailerField})]}))}return new a({value:t})};e.prototype.toJSON=function(){var t={};if(!this.hashAlgorithm.isEqual(e.defaultValues("hashAlgorithm")))t.hashAlgorithm=this.hashAlgorithm.toJSON();if(!this.maskGenAlgorithm.isEqual(e.defaultValues("maskGenAlgorithm")))t.maskGenAlgorithm=this.maskGenAlgorithm.toJSON();if(this.saltLength!==e.defaultValues("saltLength"))t.saltLength=this.saltLength;if(this.trailerField!==e.defaultValues("trailerField"))t.trailerField=this.trailerField;return t};return e}();var Ke=function(){function e(t){if(t===void 0){t={}}this.salt=r(t,"salt",e.defaultValues("salt"));this.iterationCount=r(t,"iterationCount",e.defaultValues("iterationCount"));if("keyLength"in t)this.keyLength=r(t,"keyLength",e.defaultValues("keyLength"));if("prf"in t)this.prf=r(t,"prf",e.defaultValues("prf"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"salt":return{};case"iterationCount":return-1;case"keyLength":return 0;case"prf":return new Pe({algorithmId:"1.3.14.3.2.26",algorithmParams:new b});default:throw new Error("Invalid member name for PBKDF2Params class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new C({value:[new A({name:t.saltPrimitive||""}),Pe.schema(t.saltConstructed||{})]}),new v({name:t.iterationCount||""}),new v({name:t.keyLength||"",optional:true}),Pe.schema(t.prf||{names:{optional:true}})]})};e.prototype.fromSchema=function(t){s(t,["salt","iterationCount","keyLength","prf"]);var r=o(t,t,e.schema({names:{saltPrimitive:"salt",saltConstructed:{names:{blockName:"salt"}},iterationCount:"iterationCount",keyLength:"keyLength",prf:{names:{blockName:"prf",optional:true}}}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for PBKDF2Params");this.salt=r.result.salt;this.iterationCount=r.result.iterationCount.valueBlock.valueDec;if("keyLength"in r.result)this.keyLength=r.result.keyLength.valueBlock.valueDec;if("prf"in r.result)this.prf=new Pe({schema:r.result.prf})};e.prototype.toSchema=function(){var t=[];t.push(this.salt);t.push(new v({value:this.iterationCount}));if("keyLength"in this){if(e.defaultValues("keyLength")!==this.keyLength)t.push(new v({value:this.keyLength}))}if("prf"in this){if(e.defaultValues("prf").isEqual(this.prf)===false)t.push(this.prf.toSchema())}return new a({value:t})};e.prototype.toJSON=function(){var t={salt:this.salt.toJSON(),iterationCount:this.iterationCount};if("keyLength"in this){if(e.defaultValues("keyLength")!==this.keyLength)t.keyLength=this.keyLength}if("prf"in this){if(e.defaultValues("prf").isEqual(this.prf)===false)t.prf=this.prf.toJSON()}return t};return e}();var Oe=function(){function e(t){if(t===void 0){t={}}this.keyDerivationFunc=r(t,"keyDerivationFunc",e.defaultValues("keyDerivationFunc"));this.encryptionScheme=r(t,"encryptionScheme",e.defaultValues("encryptionScheme"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"keyDerivationFunc":return new Pe;case"encryptionScheme":return new Pe;default:throw new Error("Invalid member name for PBES2Params class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[Pe.schema(t.keyDerivationFunc||{}),Pe.schema(t.encryptionScheme||{})]})};e.prototype.fromSchema=function(t){s(t,["keyDerivationFunc","encryptionScheme"]);var r=o(t,t,e.schema({names:{keyDerivationFunc:{names:{blockName:"keyDerivationFunc"}},encryptionScheme:{names:{blockName:"encryptionScheme"}}}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for PBES2Params");this.keyDerivationFunc=new Pe({schema:r.result.keyDerivationFunc});this.encryptionScheme=new Pe({schema:r.result.encryptionScheme})};e.prototype.toSchema=function(){return new a({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})};e.prototype.toJSON=function(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}};return e}();function Ue(e,t,r,i,a,n){var s;var o;var u=[];switch(t.toUpperCase()){case"SHA-1":s=20;o=64;break;case"SHA-256":s=32;o=64;break;case"SHA-384":s=48;o=128;break;case"SHA-512":s=64;o=128;break;default:throw new Error("Unsupported hashing algorithm")}var l=new Uint8Array(i);var c=new ArrayBuffer(i.byteLength*2+2);var h=new Uint8Array(c);for(var f=0;f<l.length;f++){h[f*2]=0;h[f*2+1]=l[f]}h[h.length-2]=0;h[h.length-1]=0;i=c.slice(0);var m=new ArrayBuffer(o);var p=new Uint8Array(m);for(var f=0;f<m.byteLength;f++)p[f]=3;var v=a.byteLength;var d=o*Math.ceil(v/o);var y=new ArrayBuffer(d);var g=new Uint8Array(y);var b=new Uint8Array(a);for(var f=0;f<d;f++)g[f]=b[f%v];var w=i.byteLength;var k=o*Math.ceil(w/o);var A=new ArrayBuffer(k);var S=new Uint8Array(A);var C=new Uint8Array(i);for(var f=0;f<k;f++)S[f]=C[f%w];var P=y.byteLength+A.byteLength;var I=new ArrayBuffer(P);var N=new Uint8Array(I);N.set(g);N.set(S,g.length);var B=Math.ceil((r>>3)/s);var x=Promise.resolve(I);for(var f=0;f<=B;f++){x=x.then((function(e){var t=new ArrayBuffer(m.byteLength+e.byteLength);var r=new Uint8Array(t);r.set(p);r.set(N,p.length);return t}));for(var E=0;E<n;E++)x=x.then((function(r){return e.digest({name:t},new Uint8Array(r))}));x=x.then((function(e){var t=new ArrayBuffer(o);var r=new Uint8Array(t);for(var i=0;i<t.byteLength;i++)r[i]=e[i%e.length];var a=Math.ceil(v/o)+Math.ceil(w/o);var n=[];var s=0;var l=o;for(var i=0;i<a;i++){var c=Array.from(new Uint8Array(I.slice(s,s+l)));s+=o;if(s+o>I.byteLength)l=I.byteLength-s;var h=511;for(var f=t.byteLength-1;f>=0;f--){h>>=8;h+=r[f]+c[f];c[f]=h&255}n.push.apply(n,c)}I=new ArrayBuffer(n.length);N=new Uint8Array(I);N.set(n);u.push.apply(u,new Uint8Array(e));return I}))}x=x.then((function(){var e=new ArrayBuffer(r>>3);var t=new Uint8Array(e);t.set(new Uint8Array(u).slice(0,r>>3));return e}));return x}var He=function(){function e(e){if(e===void 0){e={}}this.crypto=r(e,"crypto",{});this.subtle=r(e,"subtle",{});this.name=r(e,"name","")}e.prototype.importKey=function(e,t,r,i,a){var n=this;var s={};if(t instanceof Uint8Array)t=t.buffer;switch(e.toLowerCase()){case"raw":return this.subtle.importKey("raw",t,r,i,a);case"spki":{var o=g(t);if(o.offset===-1)return Promise.reject("Incorrect keyData");var u=new Be;try{u.fromSchema(o.result)}catch(V){return Promise.reject("Incorrect keyData")}switch(r.name.toUpperCase()){case"RSA-PSS":{switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="PS1";break;case"SHA-256":s.alg="PS256";break;case"SHA-384":s.alg="PS384";break;case"SHA-512":s.alg="PS512";break;default:return Promise.reject("Incorrect hash algorithm: "+r.hash.name.toUpperCase())}}case"RSASSA-PKCS1-V1_5":{a=["verify"];s.kty="RSA";s.ext=i;s.key_ops=a;if(u.algorithm.algorithmId!=="1.2.840.113549.1.1.1")return Promise.reject("Incorrect public key algorithm: "+u.algorithm.algorithmId);if("alg"in s===false){switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="RS1";break;case"SHA-256":s.alg="RS256";break;case"SHA-384":s.alg="RS384";break;case"SHA-512":s.alg="RS512";break;default:return Promise.reject("Incorrect hash algorithm: "+r.hash.name.toUpperCase())}}var l=u.toJSON();for(var c=0,h=Object.keys(l);c<h.length;c++){var f=h[c];s[f]=l[f]}}break;case"ECDSA":a=["verify"];case"ECDH":{s={kty:"EC",ext:i,key_ops:a};if(u.algorithm.algorithmId!=="1.2.840.10045.2.1")return Promise.reject("Incorrect public key algorithm: "+u.algorithm.algorithmId);var l=u.toJSON();for(var p=0,v=Object.keys(l);p<v.length;p++){var f=v[p];s[f]=l[f]}}break;case"RSA-OAEP":{s.kty="RSA";s.ext=i;s.key_ops=a;if(this.name.toLowerCase()==="safari")s.alg="RSA-OAEP";else{switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="RSA-OAEP";break;case"SHA-256":s.alg="RSA-OAEP-256";break;case"SHA-384":s.alg="RSA-OAEP-384";break;case"SHA-512":s.alg="RSA-OAEP-512";break;default:return Promise.reject("Incorrect hash algorithm: "+r.hash.name.toUpperCase())}}var l=u.toJSON();for(var d=0,y=Object.keys(l);d<y.length;d++){var f=y[d];s[f]=l[f]}}break;case"RSAES-PKCS1-V1_5":{s.kty="RSA";s.ext=i;s.key_ops=a;s.alg="PS1";var l=u.toJSON();for(var b=0,w=Object.keys(l);b<w.length;b++){var f=w[b];s[f]=l[f]}}break;default:return Promise.reject("Incorrect algorithm name: "+r.name.toUpperCase())}}break;case"pkcs8":{var k=new Le;var o=g(t);if(o.offset===-1)return Promise.reject("Incorrect keyData");try{k.fromSchema(o.result)}catch(V){return Promise.reject("Incorrect keyData")}if("parsedKey"in k===false)return Promise.reject("Incorrect keyData");switch(r.name.toUpperCase()){case"RSA-PSS":{switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="PS1";break;case"SHA-256":s.alg="PS256";break;case"SHA-384":s.alg="PS384";break;case"SHA-512":s.alg="PS512";break;default:return Promise.reject("Incorrect hash algorithm: "+r.hash.name.toUpperCase())}}case"RSASSA-PKCS1-V1_5":{a=["sign"];s.kty="RSA";s.ext=i;s.key_ops=a;if(k.privateKeyAlgorithm.algorithmId!=="1.2.840.113549.1.1.1")return Promise.reject("Incorrect private key algorithm: "+k.privateKeyAlgorithm.algorithmId);if("alg"in s===false){switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="RS1";break;case"SHA-256":s.alg="RS256";break;case"SHA-384":s.alg="RS384";break;case"SHA-512":s.alg="RS512";break;default:return Promise.reject("Incorrect hash algorithm: "+r.hash.name.toUpperCase())}}var A=k.toJSON();for(var S=0,C=Object.keys(A);S<C.length;S++){var f=C[S];s[f]=A[f]}}break;case"ECDSA":a=["sign"];case"ECDH":{s={kty:"EC",ext:i,key_ops:a};if(k.privateKeyAlgorithm.algorithmId!=="1.2.840.10045.2.1")return Promise.reject("Incorrect algorithm: "+k.privateKeyAlgorithm.algorithmId);var A=k.toJSON();for(var P=0,I=Object.keys(A);P<I.length;P++){var f=I[P];s[f]=A[f]}}break;case"RSA-OAEP":{s.kty="RSA";s.ext=i;s.key_ops=a;if(this.name.toLowerCase()==="safari")s.alg="RSA-OAEP";else{switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="RSA-OAEP";break;case"SHA-256":s.alg="RSA-OAEP-256";break;case"SHA-384":s.alg="RSA-OAEP-384";break;case"SHA-512":s.alg="RSA-OAEP-512";break;default:return Promise.reject("Incorrect hash algorithm: "+r.hash.name.toUpperCase())}}var A=k.toJSON();for(var N=0,B=Object.keys(A);N<B.length;N++){var f=B[N];s[f]=A[f]}}break;case"RSAES-PKCS1-V1_5":{a=["decrypt"];s.kty="RSA";s.ext=i;s.key_ops=a;s.alg="PS1";var A=k.toJSON();for(var x=0,E=Object.keys(A);x<E.length;x++){var f=E[x];s[f]=A[f]}}break;default:return Promise.reject("Incorrect algorithm name: "+r.name.toUpperCase())}}break;case"jwk":s=t;break;default:return Promise.reject("Incorrect format: "+e)}if(this.name.toLowerCase()==="safari"){return Promise.resolve().then((function(){return n.subtle.importKey("jwk",m(JSON.stringify(s)),r,i,a)})).then((function(e){return e}),(function(){return n.subtle.importKey("jwk",s,r,i,a)}))}return this.subtle.importKey("jwk",s,r,i,a)};e.prototype.exportKey=function(e,t){var r=this.subtle.exportKey("jwk",t);if(this.name.toLowerCase()==="safari"){r=r.then((function(e){if(e instanceof ArrayBuffer)return JSON.parse(f(e));return e}))}switch(e.toLowerCase()){case"raw":return this.subtle.exportKey("raw",t);case"spki":r=r.then((function(e){var t=new Be;try{t.fromJSON(e)}catch(r){return Promise.reject("Incorrect key data")}return t.toSchema().toBER(false)}));break;case"pkcs8":r=r.then((function(e){var t=new Le;try{t.fromJSON(e)}catch(r){return Promise.reject("Incorrect key data")}return t.toSchema().toBER(false)}));break;case"jwk":break;default:return Promise.reject("Incorrect format: "+e)}return r};e.prototype.convert=function(e,t,r,i,a,n){var s=this;switch(e.toLowerCase()){case"raw":switch(t.toLowerCase()){case"raw":return Promise.resolve(r);case"spki":return Promise.resolve().then((function(){return s.importKey("raw",r,i,a,n)})).then((function(e){return s.exportKey("spki",e)}));case"pkcs8":return Promise.resolve().then((function(){return s.importKey("raw",r,i,a,n)})).then((function(e){return s.exportKey("pkcs8",e)}));case"jwk":return Promise.resolve().then((function(){return s.importKey("raw",r,i,a,n)})).then((function(e){return s.exportKey("jwk",e)}));default:return Promise.reject("Incorrect outputFormat: "+t)}case"spki":switch(t.toLowerCase()){case"raw":return Promise.resolve().then((function(){return s.importKey("spki",r,i,a,n)})).then((function(e){return s.exportKey("raw",e)}));case"spki":return Promise.resolve(r);case"pkcs8":return Promise.reject("Impossible to convert between SPKI/PKCS8");case"jwk":return Promise.resolve().then((function(){return s.importKey("spki",r,i,a,n)})).then((function(e){return s.exportKey("jwk",e)}));default:return Promise.reject("Incorrect outputFormat: "+t)}case"pkcs8":switch(t.toLowerCase()){case"raw":return Promise.resolve().then((function(){return s.importKey("pkcs8",r,i,a,n)})).then((function(e){return s.exportKey("raw",e)}));case"spki":return Promise.reject("Impossible to convert between SPKI/PKCS8");case"pkcs8":return Promise.resolve(r);case"jwk":return Promise.resolve().then((function(){return s.importKey("pkcs8",r,i,a,n)})).then((function(e){return s.exportKey("jwk",e)}));default:return Promise.reject("Incorrect outputFormat: "+t)}case"jwk":switch(t.toLowerCase()){case"raw":return Promise.resolve().then((function(){return s.importKey("jwk",r,i,a,n)})).then((function(e){return s.exportKey("raw",e)}));case"spki":return Promise.resolve().then((function(){return s.importKey("jwk",r,i,a,n)})).then((function(e){return s.exportKey("spki",e)}));case"pkcs8":return Promise.resolve().then((function(){return s.importKey("jwk",r,i,a,n)})).then((function(e){return s.exportKey("pkcs8",e)}));case"jwk":return Promise.resolve(r);default:return Promise.reject("Incorrect outputFormat: "+t)}default:return Promise.reject("Incorrect inputFormat: "+e)}};e.prototype.encrypt=function(){var e;var t=[];for(var r=0;r<arguments.length;r++){t[r]=arguments[r]}return(e=this.subtle).encrypt.apply(e,t)};e.prototype.decrypt=function(){var e;var t=[];for(var r=0;r<arguments.length;r++){t[r]=arguments[r]}return(e=this.subtle).decrypt.apply(e,t)};e.prototype.sign=function(){var e;var t=[];for(var r=0;r<arguments.length;r++){t[r]=arguments[r]}return(e=this.subtle).sign.apply(e,t)};e.prototype.verify=function(){var e;var t=[];for(var r=0;r<arguments.length;r++){t[r]=arguments[r]}return(e=this.subtle).verify.apply(e,t)};e.prototype.digest=function(){var e;var t=[];for(var r=0;r<arguments.length;r++){t[r]=arguments[r]}return(e=this.subtle).digest.apply(e,t)};e.prototype.generateKey=function(){var e;var t=[];for(var r=0;r<arguments.length;r++){t[r]=arguments[r]}return(e=this.subtle).generateKey.apply(e,t)};e.prototype.deriveKey=function(){var e;var t=[];for(var r=0;r<arguments.length;r++){t[r]=arguments[r]}return(e=this.subtle).deriveKey.apply(e,t)};e.prototype.deriveBits=function(){var e;var t=[];for(var r=0;r<arguments.length;r++){t[r]=arguments[r]}return(e=this.subtle).deriveBits.apply(e,t)};e.prototype.wrapKey=function(){var e;var t=[];for(var r=0;r<arguments.length;r++){t[r]=arguments[r]}return(e=this.subtle).wrapKey.apply(e,t)};e.prototype.unwrapKey=function(){var e;var t=[];for(var r=0;r<arguments.length;r++){t[r]=arguments[r]}return(e=this.subtle).unwrapKey.apply(e,t)};e.prototype.getRandomValues=function(e){if("getRandomValues"in this.crypto===false)throw new Error("No support for getRandomValues");return this.crypto.getRandomValues(e)};e.prototype.getAlgorithmByOID=function(e){switch(e){case"1.2.840.113549.1.1.1":return{name:"RSAES-PKCS1-v1_5"};case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}return{}};e.prototype.getOIDByAlgorithm=function(e){var t="";switch(e.name.toUpperCase()){case"RSAES-PKCS1-V1_5":t="1.2.840.113549.1.1.1";break;case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.113549.1.1.5";break;case"SHA-256":t="1.2.840.113549.1.1.11";break;case"SHA-384":t="1.2.840.113549.1.1.12";break;case"SHA-512":t="1.2.840.113549.1.1.13";break}break;case"RSA-PSS":t="1.2.840.113549.1.1.10";break;case"RSA-OAEP":t="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.10045.4.1";break;case"SHA-256":t="1.2.840.10045.4.3.2";break;case"SHA-384":t="1.2.840.10045.4.3.3";break;case"SHA-512":t="1.2.840.10045.4.3.4";break}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":t="1.3.133.16.840.63.0.2";break;case"SHA-256":t="1.3.132.1.11.1";break;case"SHA-384":t="1.3.132.1.11.2";break;case"SHA-512":t="1.3.132.1.11.3";break}break;case"AES-CTR":break;case"AES-CBC":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.2";break;case 192:t="2.16.840.1.101.3.4.1.22";break;case 256:t="2.16.840.1.101.3.4.1.42";break}break;case"AES-CMAC":break;case"AES-GCM":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.6";break;case 192:t="2.16.840.1.101.3.4.1.26";break;case 256:t="2.16.840.1.101.3.4.1.46";break}break;case"AES-CFB":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.4";break;case 192:t="2.16.840.1.101.3.4.1.24";break;case 256:t="2.16.840.1.101.3.4.1.44";break}break;case"AES-KW":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.5";break;case 192:t="2.16.840.1.101.3.4.1.25";break;case 256:t="2.16.840.1.101.3.4.1.45";break}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.113549.2.7";break;case"SHA-256":t="1.2.840.113549.2.9";break;case"SHA-384":t="1.2.840.113549.2.10";break;case"SHA-512":t="1.2.840.113549.2.11";break}break;case"DH":t="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":t="1.3.14.3.2.26";break;case"SHA-256":t="2.16.840.1.101.3.4.2.1";break;case"SHA-384":t="2.16.840.1.101.3.4.2.2";break;case"SHA-512":t="2.16.840.1.101.3.4.2.3";break;case"CONCAT":break;case"HKDF":break;case"PBKDF2":t="1.2.840.113549.1.5.12";break;case"P-256":t="1.2.840.10045.3.1.7";break;case"P-384":t="1.3.132.0.34";break;case"P-521":t="1.3.132.0.35";break}return t};e.prototype.getAlgorithmParameters=function(e,t){var r={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSAES-PKCS1-V1_5":case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":r={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":r={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":r={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":r={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;case"exportkey":default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":r={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":r={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":r={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":r={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":switch(t.toLowerCase()){case"derivekey":r={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"HKDF"},usages:[]}}break;case"PBKDF2":switch(t.toLowerCase()){case"derivekey":r={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"PBKDF2"},usages:[]}}break}return r};e.prototype.getHashAlgorithm=function(e){var t="";switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":{try{var r=new De({schema:e.algorithmParams});if("hashAlgorithm"in r){var i=this.getAlgorithmByOID(r.hashAlgorithm.algorithmId);if("name"in i===false)return"";t=i.name}else t="SHA-1"}catch(a){}}break}return t};e.prototype.encryptEncryptedContentInfo=function(e){var t=this;if(e instanceof Object===false)return Promise.reject('Parameters must have type "Object"');if("password"in e===false)return Promise.reject('Absent mandatory parameter "password"');if("contentEncryptionAlgorithm"in e===false)return Promise.reject('Absent mandatory parameter "contentEncryptionAlgorithm"');if("hmacHashAlgorithm"in e===false)return Promise.reject('Absent mandatory parameter "hmacHashAlgorithm"');if("iterationCount"in e===false)return Promise.reject('Absent mandatory parameter "iterationCount"');if("contentToEncrypt"in e===false)return Promise.reject('Absent mandatory parameter "contentToEncrypt"');if("contentType"in e===false)return Promise.reject('Absent mandatory parameter "contentType"');var r=this.getOIDByAlgorithm(e.contentEncryptionAlgorithm);if(r==="")return Promise.reject('Wrong "contentEncryptionAlgorithm" value');var i=this.getOIDByAlgorithm({name:"PBKDF2"});if(i==="")return Promise.reject("Can not find OID for PBKDF2");var a=this.getOIDByAlgorithm({name:"HMAC",hash:{name:e.hmacHashAlgorithm}});if(a==="")return Promise.reject('Incorrect value for "hmacHashAlgorithm": '+e.hmacHashAlgorithm);var n=Promise.resolve();var s=new ArrayBuffer(16);var o=new Uint8Array(s);this.getRandomValues(o);var u=new ArrayBuffer(64);var l=new Uint8Array(u);this.getRandomValues(l);var c=new Uint8Array(e.contentToEncrypt);var h=new Ke({salt:new A({valueHex:u}),iterationCount:e.iterationCount,prf:new Pe({algorithmId:a,algorithmParams:new b})});n=n.then((function(){var r=new Uint8Array(e.password);return t.importKey("raw",r,"PBKDF2",false,["deriveKey"])}),(function(e){return Promise.reject(e)}));n=n.then((function(r){return t.deriveKey({name:"PBKDF2",hash:{name:e.hmacHashAlgorithm},salt:l,iterations:e.iterationCount},r,e.contentEncryptionAlgorithm,false,["encrypt"])}),(function(e){return Promise.reject(e)}));n=n.then((function(r){return t.encrypt({name:e.contentEncryptionAlgorithm.name,iv:o},r,c)}),(function(e){return Promise.reject(e)}));n=n.then((function(t){var a=new Oe({keyDerivationFunc:new Pe({algorithmId:i,algorithmParams:h.toSchema()}),encryptionScheme:new Pe({algorithmId:r,algorithmParams:new A({valueHex:s})})});return new je({contentType:e.contentType,contentEncryptionAlgorithm:new Pe({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:a.toSchema()}),encryptedContent:new A({valueHex:t})})}),(function(e){return Promise.reject(e)}));return n};e.prototype.decryptEncryptedContentInfo=function(e){var t=this;if(e instanceof Object===false)return Promise.reject('Parameters must have type "Object"');if("password"in e===false)return Promise.reject('Absent mandatory parameter "password"');if("encryptedContentInfo"in e===false)return Promise.reject('Absent mandatory parameter "encryptedContentInfo"');if(e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId!=="1.2.840.113549.1.5.13")return Promise.reject('Unknown "contentEncryptionAlgorithm": '+e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId);var r=Promise.resolve();var i;try{i=new Oe({schema:e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams})}catch(p){return Promise.reject('Incorrectly encoded "pbes2Parameters"')}var a;try{a=new Ke({schema:i.keyDerivationFunc.algorithmParams})}catch(p){return Promise.reject('Incorrectly encoded "pbkdf2Params"')}var n=this.getAlgorithmByOID(i.encryptionScheme.algorithmId);if("name"in n===false)return Promise.reject('Incorrect OID for "contentEncryptionAlgorithm": '+i.encryptionScheme.algorithmId);var s=i.encryptionScheme.algorithmParams.valueBlock.valueHex;var o=new Uint8Array(s);var u=a.salt.valueBlock.valueHex;var l=new Uint8Array(u);var h=a.iterationCount;var f="SHA-1";if("prf"in a){var m=this.getAlgorithmByOID(a.prf.algorithmId);if("name"in m===false)return Promise.reject("Incorrect OID for HMAC hash algorithm");f=m.hash.name}r=r.then((function(){return t.importKey("raw",e.password,"PBKDF2",false,["deriveKey"])}),(function(e){return Promise.reject(e)}));r=r.then((function(e){return t.deriveKey({name:"PBKDF2",hash:{name:f},salt:l,iterations:h},e,n,false,["decrypt"])}),(function(e){return Promise.reject(e)}));r=r.then((function(r){var i=new ArrayBuffer(0);if(e.encryptedContentInfo.encryptedContent.idBlock.isConstructed===false)i=e.encryptedContentInfo.encryptedContent.valueBlock.valueHex;else{for(var a=0,s=e.encryptedContentInfo.encryptedContent.valueBlock.value;a<s.length;a++){var u=s[a];i=c(i,u.valueBlock.valueHex)}}return t.decrypt({name:n.name,iv:o},r,i)}),(function(e){return Promise.reject(e)}));return r};e.prototype.stampDataWithPassword=function(e){var t=this;if(e instanceof Object===false)return Promise.reject('Parameters must have type "Object"');if("password"in e===false)return Promise.reject('Absent mandatory parameter "password"');if("hashAlgorithm"in e===false)return Promise.reject('Absent mandatory parameter "hashAlgorithm"');if("salt"in e===false)return Promise.reject('Absent mandatory parameter "iterationCount"');if("iterationCount"in e===false)return Promise.reject('Absent mandatory parameter "salt"');if("contentToStamp"in e===false)return Promise.reject('Absent mandatory parameter "contentToStamp"');var r;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":r=160;break;case"sha-256":r=256;break;case"sha-384":r=384;break;case"sha-512":r=512;break;default:return Promise.reject('Incorrect "parameters.hashAlgorithm" parameter: '+e.hashAlgorithm)}var i=Promise.resolve();var a={name:"HMAC",length:r,hash:{name:e.hashAlgorithm}};i=i.then((function(){return Ue(t,e.hashAlgorithm,r,e.password,e.salt,e.iterationCount)}));i=i.then((function(e){return t.importKey("raw",new Uint8Array(e),a,false,["sign"])}));i=i.then((function(r){return t.sign(a,r,new Uint8Array(e.contentToStamp))}),(function(e){return Promise.reject(e)}));return i};e.prototype.verifyDataStampedWithPassword=function(e){var t=this;if(e instanceof Object===false)return Promise.reject('Parameters must have type "Object"');if("password"in e===false)return Promise.reject('Absent mandatory parameter "password"');if("hashAlgorithm"in e===false)return Promise.reject('Absent mandatory parameter "hashAlgorithm"');if("salt"in e===false)return Promise.reject('Absent mandatory parameter "iterationCount"');if("iterationCount"in e===false)return Promise.reject('Absent mandatory parameter "salt"');if("contentToVerify"in e===false)return Promise.reject('Absent mandatory parameter "contentToVerify"');if("signatureToVerify"in e===false)return Promise.reject('Absent mandatory parameter "signatureToVerify"');var r;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":r=160;break;case"sha-256":r=256;break;case"sha-384":r=384;break;case"sha-512":r=512;break;default:return Promise.reject('Incorrect "parameters.hashAlgorithm" parameter: '+e.hashAlgorithm)}var i=Promise.resolve();var a={name:"HMAC",length:r,hash:{name:e.hashAlgorithm}};i=i.then((function(){return Ue(t,e.hashAlgorithm,r,e.password,e.salt,e.iterationCount)}));i=i.then((function(e){return t.importKey("raw",new Uint8Array(e),a,false,["verify"])}));i=i.then((function(r){return t.verify(a,r,new Uint8Array(e.signatureToVerify),new Uint8Array(e.contentToVerify))}),(function(e){return Promise.reject(e)}));return i};e.prototype.getSignatureParameters=function(e,t){if(t===void 0){t="SHA-1"}var r=this.getOIDByAlgorithm({name:t});if(r==="")return Promise.reject("Unsupported hash algorithm: "+t);var i=new Pe;var a=this.getAlgorithmParameters(e.algorithm.name,"sign");a.algorithm.hash.name=t;switch(e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":i.algorithmId=this.getOIDByAlgorithm(a.algorithm);break;case"RSA-PSS":{switch(t.toUpperCase()){case"SHA-256":a.algorithm.saltLength=32;break;case"SHA-384":a.algorithm.saltLength=48;break;case"SHA-512":a.algorithm.saltLength=64;break}var n={};if(t.toUpperCase()!=="SHA-1"){var s=this.getOIDByAlgorithm({name:t});if(s==="")return Promise.reject("Unsupported hash algorithm: "+t);n.hashAlgorithm=new Pe({algorithmId:s,algorithmParams:new b});n.maskGenAlgorithm=new Pe({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:n.hashAlgorithm.toSchema()})}if(a.algorithm.saltLength!==20)n.saltLength=a.algorithm.saltLength;var o=new De(n);i.algorithmId="1.2.840.113549.1.1.10";i.algorithmParams=o.toSchema()}break;default:return Promise.reject("Unsupported signature algorithm: "+e.algorithm.name)}return Promise.resolve().then((function(){return{signatureAlgorithm:i,parameters:a}}))};e.prototype.signWithPrivateKey=function(e,t,r){return this.sign(r.algorithm,t,new Uint8Array(e)).then((function(e){if(r.algorithm.name==="ECDSA")e=Te(e);return e}),(function(e){return Promise.reject("Signing error: "+e)}))};e.prototype.fillPublicKeyParameters=function(e,t){var r={};var i=this.getHashAlgorithm(t);if(i==="")return Promise.reject("Unsupported signature algorithm: "+t.algorithmId);var a;if(t.algorithmId==="1.2.840.113549.1.1.10")a=t.algorithmId;else a=e.algorithm.algorithmId;var n=this.getAlgorithmByOID(a);if("name"in n==="")return Promise.reject("Unsupported public key algorithm: "+t.algorithmId);r.algorithm=this.getAlgorithmParameters(n.name,"importkey");if("hash"in r.algorithm.algorithm)r.algorithm.algorithm.hash.name=i;if(n.name==="ECDSA"){var s=false;if("algorithmParams"in e.algorithm===true){if("idBlock"in e.algorithm.algorithmParams){if(e.algorithm.algorithmParams.idBlock.tagClass===1&&e.algorithm.algorithmParams.idBlock.tagNumber===6)s=true}}if(s===false)return Promise.reject("Incorrect type for ECDSA public key parameters");var o=this.getAlgorithmByOID(e.algorithm.algorithmParams.valueBlock.toString());if("name"in o===false)return Promise.reject("Unsupported named curve algorithm: "+e.algorithm.algorithmParams.valueBlock.toString());r.algorithm.algorithm.namedCurve=o.name}return r};e.prototype.getPublicKey=function(e,t,r){if(r===void 0){r=null}if(r===null)r=this.fillPublicKeyParameters(e,t);var i=e.toSchema();var a=i.toBER(false);var n=new Uint8Array(a);return this.importKey("spki",n,r.algorithm.algorithm,true,r.algorithm.usages)};e.prototype.verifyWithPublicKey=function(e,t,r,i,a){var n=this;if(a===void 0){a=null}var s=Promise.resolve();if(a===null){a=this.getHashAlgorithm(i);if(a==="")return Promise.reject("Unsupported signature algorithm: "+i.algorithmId);s=s.then((function(){return n.getPublicKey(r,i)}))}else{var o={};var u=void 0;if(i.algorithmId==="1.2.840.113549.1.1.10")u=i.algorithmId;else u=r.algorithm.algorithmId;var l=this.getAlgorithmByOID(u);if("name"in l==="")return Promise.reject("Unsupported public key algorithm: "+i.algorithmId);o.algorithm=this.getAlgorithmParameters(l.name,"importkey");if("hash"in o.algorithm.algorithm)o.algorithm.algorithm.hash.name=a;if(l.name==="ECDSA"){var c=false;if("algorithmParams"in r.algorithm===true){if("idBlock"in r.algorithm.algorithmParams){if(r.algorithm.algorithmParams.idBlock.tagClass===1&&r.algorithm.algorithmParams.idBlock.tagNumber===6)c=true}}if(c===false)return Promise.reject("Incorrect type for ECDSA public key parameters");var h=this.getAlgorithmByOID(r.algorithm.algorithmParams.valueBlock.toString());if("name"in h===false)return Promise.reject("Unsupported named curve algorithm: "+r.algorithm.algorithmParams.valueBlock.toString());o.algorithm.algorithm.namedCurve=h.name}s=s.then((function(){return n.getPublicKey(r,null,o)}))}s=s.then((function(r){var s=n.getAlgorithmParameters(r.algorithm.name,"verify");if("hash"in s.algorithm)s.algorithm.hash.name=a;var o=t.valueBlock.valueHex;if(r.algorithm.name==="ECDSA"){var u=g(o);o=We(u.result)}if(r.algorithm.name==="RSA-PSS"){var l=void 0;try{l=new De({schema:i.algorithmParams})}catch(f){return Promise.reject(f)}if("saltLength"in l)s.algorithm.saltLength=l.saltLength;else s.algorithm.saltLength=20;var c="SHA-1";if("hashAlgorithm"in l){var h=n.getAlgorithmByOID(l.hashAlgorithm.algorithmId);if("name"in h===false)return Promise.reject("Unrecognized hash algorithm: "+l.hashAlgorithm.algorithmId);c=h.name}s.algorithm.hash.name=c}return n.verify(s.algorithm,r,new Uint8Array(o),new Uint8Array(e))}));return s};return e}();var Re={name:"none",crypto:null,subtle:null};function Je(e,t,r){if(typeof process!=="undefined"&&"pid"in process&&typeof global!=="undefined"&&typeof window==="undefined"){if(typeof global[process.pid]==="undefined"){global[process.pid]={}}else{if(typeof global[process.pid]!=="object"){throw new Error("Name global."+process.pid+" already exists and it is not an object")}}if(typeof global[process.pid].pkijs==="undefined"){global[process.pid].pkijs={}}else{if(typeof global[process.pid].pkijs!=="object"){throw new Error("Name global."+process.pid+".pkijs already exists and it is not an object")}}global[process.pid].pkijs.engine={name:e,crypto:t,subtle:r}}else{if(Re.name!==e){Re={name:e,crypto:t,subtle:r}}}}function Me(){if(typeof process!=="undefined"&&"pid"in process&&typeof global!=="undefined"&&typeof window==="undefined"){var e=void 0;try{e=global[process.pid].pkijs.engine}catch(t){throw new Error('Please call "setEngine" before call to "getEngine"')}return e}return Re}(function e(){if(typeof self!=="undefined"){if("crypto"in self){var t="webcrypto";var r=self.crypto;var i=void 0;if("webkitSubtle"in self.crypto){try{i=self.crypto.webkitSubtle}catch(a){i=self.crypto.subtle}t="safari"}if("subtle"in self.crypto)i=self.crypto.subtle;if(typeof i==="undefined"){Re={name:t,crypto:r,subtle:null}}else{Re={name:t,crypto:r,subtle:new He({name:t,crypto:self.crypto,subtle:i})}}}}Je(Re.name,Re.crypto,Re.subtle)})();function qe(){var e=Me();if(e.subtle!==null)return e.subtle;return undefined}function Te(e){if(e.byteLength%2!==0)return new ArrayBuffer(0);var t=e.byteLength/2;var r=new ArrayBuffer(t);var i=new Uint8Array(r);i.set(new Uint8Array(e,0,t));var n=new v({valueHex:r});var s=new ArrayBuffer(t);var o=new Uint8Array(s);o.set(new Uint8Array(e,t,t));var u=new v({valueHex:s});return new a({value:[n.convertToDER(),u.convertToDER()]}).toBER(false)}function Fe(e){var t=false;var r="";var i=e.trim();for(var a=0;a<i.length;a++){if(i.charCodeAt(a)===32){if(t===false)t=true}else{if(t){r+=" ";t=false}r+=i[a]}}return r.toLowerCase()}function We(e){if(e instanceof a===false)return new ArrayBuffer(0);if(e.valueBlock.value.length!==2)return new ArrayBuffer(0);if(e.valueBlock.value[0]instanceof v===false)return new ArrayBuffer(0);if(e.valueBlock.value[1]instanceof v===false)return new ArrayBuffer(0);var t=e.valueBlock.value[0].convertFromDER();var r=e.valueBlock.value[1].convertFromDER();switch(true){case t.valueBlock.valueHex.byteLength<r.valueBlock.valueHex.byteLength:{if(r.valueBlock.valueHex.byteLength-t.valueBlock.valueHex.byteLength!==1)throw new Error("Incorrect DER integer decoding");var i=r.valueBlock.valueHex.byteLength;var n=new Uint8Array(t.valueBlock.valueHex);var s=new ArrayBuffer(i);var o=new Uint8Array(s);o.set(n,1);o[0]=0;return c(s,r.valueBlock.valueHex)}case t.valueBlock.valueHex.byteLength>r.valueBlock.valueHex.byteLength:{if(t.valueBlock.valueHex.byteLength-r.valueBlock.valueHex.byteLength!==1)throw new Error("Incorrect DER integer decoding");var i=t.valueBlock.valueHex.byteLength;var u=new Uint8Array(r.valueBlock.valueHex);var l=new ArrayBuffer(i);var h=new Uint8Array(l);h.set(u,1);h[0]=0;return c(t.valueBlock.valueHex,l)}default:{if(t.valueBlock.valueHex.byteLength%2){var i=t.valueBlock.valueHex.byteLength+1;var n=new Uint8Array(t.valueBlock.valueHex);var s=new ArrayBuffer(i);var o=new Uint8Array(s);o.set(n,1);o[0]=0;var u=new Uint8Array(r.valueBlock.valueHex);var l=new ArrayBuffer(i);var h=new Uint8Array(l);h.set(u,1);h[0]=0;return c(s,l)}}}return c(t.valueBlock.valueHex,r.valueBlock.valueHex)}var Qe=function(){function e(t){if(t===void 0){t={}}this.type=r(t,"type",e.defaultValues("type"));this.value=r(t,"value",e.defaultValues("value"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"type":return"";case"value":return{};default:throw new Error("Invalid member name for AttributeTypeAndValue class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new n({name:t.type||""}),new i({name:t.value||""})]})};e.blockName=function(){return"AttributeTypeAndValue"};e.prototype.fromSchema=function(t){s(t,["type","typeValue"]);var r=o(t,t,e.schema({names:{type:"type",value:"typeValue"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for AttributeTypeAndValue");this.type=r.result.type.valueBlock.toString();this.value=r.result.typeValue};e.prototype.toSchema=function(){return new a({value:[new n({value:this.type}),this.value]})};e.prototype.toJSON=function(){var e={type:this.type};if(Object.keys(this.value).length!==0)e.value=this.value.toJSON();else e.value=this.value;return e};e.prototype.isEqual=function(t){var r=[I.blockName(),N.blockName(),B.blockName(),x.blockName(),E.blockName(),V.blockName(),_.blockName(),L.blockName(),j.blockName(),D.blockName(),K.blockName(),O.blockName()];if(t.constructor.blockName()===e.blockName()){if(this.type!==t.type)return false;var i=false;var a=this.value.constructor.blockName();if(a===t.value.constructor.blockName()){for(var n=0,s=r;n<s.length;n++){var o=s[n];if(a===o){i=true;break}}}if(i){var l=Fe(this.value.valueBlock.value);var c=Fe(t.value.valueBlock.value);if(l.localeCompare(c)!==0)return false}else{if(u(this.value.valueBeforeDecode,t.value.valueBeforeDecode)===false)return false}return true}if(t instanceof ArrayBuffer)return u(this.value.valueBeforeDecode,t);return false};return e}();var Ge=function(){function e(t){if(t===void 0){t={}}this.typesAndValues=r(t,"typesAndValues",e.defaultValues("typesAndValues"));this.valueBeforeDecode=r(t,"valueBeforeDecode",e.defaultValues("valueBeforeDecode"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"typesAndValues":return[];case"valueBeforeDecode":return new ArrayBuffer(0);default:throw new Error("Invalid member name for RelativeDistinguishedNames class: "+e)}};e.compareWithDefault=function(e,t){switch(e){case"typesAndValues":return t.length===0;case"valueBeforeDecode":return t.byteLength===0;default:throw new Error("Invalid member name for RelativeDistinguishedNames class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new k({name:t.repeatedSequence||"",value:new w({value:[new k({name:t.repeatedSet||"",value:Qe.schema(t.typeAndValue||{})})]})})]})};e.prototype.fromSchema=function(t){s(t,["RDN","typesAndValues"]);var r=o(t,t,e.schema({names:{blockName:"RDN",repeatedSet:"typesAndValues"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for RelativeDistinguishedNames");if("typesAndValues"in r.result)this.typesAndValues=Array.from(r.result.typesAndValues,(function(e){return new Qe({schema:e})}));this.valueBeforeDecode=r.result.RDN.valueBeforeDecode};e.prototype.toSchema=function(){if(this.valueBeforeDecode.byteLength===0){return new a({value:[new w({value:Array.from(this.typesAndValues,(function(e){return e.toSchema()}))})]})}var e=g(this.valueBeforeDecode);return e.result};e.prototype.toJSON=function(){return{typesAndValues:Array.from(this.typesAndValues,(function(e){return e.toJSON()}))}};e.prototype.isEqual=function(t){if(t instanceof e){if(this.typesAndValues.length!==t.typesAndValues.length)return false;for(var r=0,i=this.typesAndValues.entries();r<i.length;r++){var a=i[r],n=a[0],s=a[1];if(s.isEqual(t.typesAndValues[n])===false)return false}return true}if(t instanceof ArrayBuffer)return u(this.valueBeforeDecode,t);return false};return e}();var ze=function(){function e(t){if(t===void 0){t={}}this.type=r(t,"type",e.defaultValues("type"));this.value=r(t,"value",e.defaultValues("value"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"type":return 0;case"value":return new Date(0,0,0);default:throw new Error("Invalid member name for Time class: "+e)}};e.schema=function(e,t){if(e===void 0){e={}}if(t===void 0){t=false}var i=r(e,"names",{});return new C({optional:t,value:[new U({name:i.utcTimeName||""}),new H({name:i.generalTimeName||""})]})};e.prototype.fromSchema=function(t){s(t,["utcTimeName","generalTimeName"]);var r=o(t,t,e.schema({names:{utcTimeName:"utcTimeName",generalTimeName:"generalTimeName"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for Time");if("utcTimeName"in r.result){this.type=0;this.value=r.result.utcTimeName.toDate()}if("generalTimeName"in r.result){this.type=1;this.value=r.result.generalTimeName.toDate()}};e.prototype.toSchema=function(){var e={};if(this.type===0)e=new U({valueDate:this.value});if(this.type===1)e=new H({valueDate:this.value});return e};e.prototype.toJSON=function(){return{type:this.type,value:this.value}};return e}();var Ye=function(){function e(t){if(t===void 0){t={}}this.attributes=r(t,"attributes",e.defaultValues("attributes"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"attributes":return[];default:throw new Error("Invalid member name for SubjectDirectoryAttributes class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new k({name:t.attributes||"",value:xe.schema()})]})};e.prototype.fromSchema=function(t){s(t,["attributes"]);var r=o(t,t,e.schema({names:{attributes:"attributes"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for SubjectDirectoryAttributes");this.attributes=Array.from(r.result.attributes,(function(e){return new xe({schema:e})}))};e.prototype.toSchema=function(){return new a({value:Array.from(this.attributes,(function(e){return e.toSchema()}))})};e.prototype.toJSON=function(){return{attributes:Array.from(this.attributes,(function(e){return e.toJSON()}))}};return e}();var Xe=function(){function e(t){if(t===void 0){t={}}if("notBefore"in t)this.notBefore=r(t,"notBefore",e.defaultValues("notBefore"));if("notAfter"in t)this.notAfter=r(t,"notAfter",e.defaultValues("notAfter"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"notBefore":return new Date;case"notAfter":return new Date;default:throw new Error("Invalid member name for PrivateKeyUsagePeriod class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new P({name:t.notBefore||"",optional:true,idBlock:{tagClass:3,tagNumber:0}}),new P({name:t.notAfter||"",optional:true,idBlock:{tagClass:3,tagNumber:1}})]})};e.prototype.fromSchema=function(t){s(t,["notBefore","notAfter"]);var r=o(t,t,e.schema({names:{notBefore:"notBefore",notAfter:"notAfter"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for PrivateKeyUsagePeriod");if("notBefore"in r.result){var i=new H;i.fromBuffer(r.result.notBefore.valueBlock.valueHex);this.notBefore=i.toDate()}if("notAfter"in r.result){var a=new H({valueHex:r.result.notAfter.valueBlock.valueHex});a.fromBuffer(r.result.notAfter.valueBlock.valueHex);this.notAfter=a.toDate()}};e.prototype.toSchema=function(){var e=[];if("notBefore"in this){e.push(new P({idBlock:{tagClass:3,tagNumber:0},valueHex:new H({valueDate:this.notBefore}).valueBlock.valueHex}))}if("notAfter"in this){e.push(new P({idBlock:{tagClass:3,tagNumber:1},valueHex:new H({valueDate:this.notAfter}).valueBlock.valueHex}))}return new a({value:e})};e.prototype.toJSON=function(){var e={};if("notBefore"in this)e.notBefore=this.notBefore;if("notAfter"in this)e.notAfter=this.notAfter;return e};return e}();function $e(e,t){if(e===void 0){e={}}if(t===void 0){t=false}var i=r(e,"names",{});return new a({optional:t,value:[new S({optional:true,idBlock:{tagClass:2,tagNumber:1},name:i.country_name||"",value:[new C({value:[new x,new E]})]}),new S({optional:true,idBlock:{tagClass:2,tagNumber:2},name:i.administration_domain_name||"",value:[new C({value:[new x,new E]})]}),new P({optional:true,idBlock:{tagClass:3,tagNumber:0},name:i.network_address||"",isHexOnly:true}),new P({optional:true,idBlock:{tagClass:3,tagNumber:1},name:i.terminal_identifier||"",isHexOnly:true}),new S({optional:true,idBlock:{tagClass:3,tagNumber:2},name:i.private_domain_name||"",value:[new C({value:[new x,new E]})]}),new P({optional:true,idBlock:{tagClass:3,tagNumber:3},name:i.organization_name||"",isHexOnly:true}),new P({optional:true,name:i.numeric_user_identifier||"",idBlock:{tagClass:3,tagNumber:4},isHexOnly:true}),new S({optional:true,name:i.personal_name||"",idBlock:{tagClass:3,tagNumber:5},value:[new P({idBlock:{tagClass:3,tagNumber:0},isHexOnly:true}),new P({optional:true,idBlock:{tagClass:3,tagNumber:1},isHexOnly:true}),new P({optional:true,idBlock:{tagClass:3,tagNumber:2},isHexOnly:true}),new P({optional:true,idBlock:{tagClass:3,tagNumber:3},isHexOnly:true})]}),new S({optional:true,name:i.organizational_unit_names||"",idBlock:{tagClass:3,tagNumber:6},value:[new k({value:new E})]})]})}function Ze(e){if(e===void 0){e=false}return new a({optional:e,value:[new E,new E]})}function et(e){if(e===void 0){e=false}return new w({optional:e,value:[new P({optional:true,idBlock:{tagClass:3,tagNumber:0},isHexOnly:true}),new S({optional:true,idBlock:{tagClass:3,tagNumber:1},value:[new i]})]})}var tt=function(){function e(t){if(t===void 0){t={}}this.type=r(t,"type",e.defaultValues("type"));this.value=r(t,"value",e.defaultValues("value"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"type":return 9;case"value":return{};default:throw new Error("Invalid member name for GeneralName class: "+e)}};e.compareWithDefault=function(t,r){switch(t){case"type":return r===e.defaultValues(t);case"value":return Object.keys(r).length===0;default:throw new Error("Invalid member name for GeneralName class: "+t)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new C({value:[new S({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||"",value:[new n,new S({idBlock:{tagClass:3,tagNumber:0},value:[new i]})]}),new P({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:1}}),new P({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:2}}),new S({idBlock:{tagClass:3,tagNumber:3},name:t.blockName||"",value:[$e(t.builtInStandardAttributes||{},false),Ze(true),et(true)]}),new S({idBlock:{tagClass:3,tagNumber:4},name:t.blockName||"",value:[Ge.schema(t.directoryName||{})]}),new S({idBlock:{tagClass:3,tagNumber:5},name:t.blockName||"",value:[new S({optional:true,idBlock:{tagClass:3,tagNumber:0},value:[new C({value:[new V,new E,new B,new I,new N]})]}),new S({idBlock:{tagClass:3,tagNumber:1},value:[new C({value:[new V,new E,new B,new I,new N]})]})]}),new P({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:6}}),new P({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:7}}),new P({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:8}})]})};e.prototype.fromSchema=function(t){s(t,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);var r=o(t,t,e.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for GeneralName");this.type=r.result.blockName.idBlock.tagNumber;switch(this.type){case 0:this.value=r.result.blockName;break;case 1:case 2:case 6:{var i=r.result.blockName;i.idBlock.tagClass=1;i.idBlock.tagNumber=22;var a=i.toBER(false);this.value=g(a).result.valueBlock.value}break;case 3:this.value=r.result.blockName;break;case 4:this.value=new Ge({schema:r.result.directoryName});break;case 5:this.value=r.result.ediPartyName;break;case 7:this.value=new A({valueHex:r.result.blockName.valueBlock.valueHex});break;case 8:{var i=r.result.blockName;i.idBlock.tagClass=1;i.idBlock.tagNumber=6;var a=i.toBER(false);this.value=g(a).result.valueBlock.toString()}break}};e.prototype.toSchema=function(){switch(this.type){case 0:case 3:case 5:return new S({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:{var t=new L({value:this.value});t.idBlock.tagClass=3;t.idBlock.tagNumber=this.type;return t}case 4:return new S({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:{var t=this.value;t.idBlock.tagClass=3;t.idBlock.tagNumber=this.type;return t}case 8:{var t=new n({value:this.value});t.idBlock.tagClass=3;t.idBlock.tagNumber=this.type;return t}default:return e.schema()}};e.prototype.toJSON=function(){var e={type:this.type,value:""};if(typeof this.value==="string")e.value=this.value;else{try{e.value=this.value.toJSON()}catch(t){}}return e};return e}();var rt=function(){function e(t){if(t===void 0){t={}}this.altNames=r(t,"altNames",e.defaultValues("altNames"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"altNames":return[];default:throw new Error("Invalid member name for AltName class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new k({name:t.altNames||"",value:tt.schema()})]})};e.prototype.fromSchema=function(t){s(t,["altNames"]);var r=o(t,t,e.schema({names:{altNames:"altNames"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for AltName");if("altNames"in r.result)this.altNames=Array.from(r.result.altNames,(function(e){return new tt({schema:e})}))};e.prototype.toSchema=function(){return new a({value:Array.from(this.altNames,(function(e){return e.toSchema()}))})};e.prototype.toJSON=function(){return{altNames:Array.from(this.altNames,(function(e){return e.toJSON()}))}};return e}();var it=function(){function e(e){if(e===void 0){e={}}this.cA=r(e,"cA",false);if("pathLenConstraint"in e)this.pathLenConstraint=r(e,"pathLenConstraint",0);if("schema"in e)this.fromSchema(e.schema)}e.defaultValues=function(e){switch(e){case"cA":return false;default:throw new Error("Invalid member name for BasicConstraints class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new R({optional:true,name:t.cA||""}),new v({optional:true,name:t.pathLenConstraint||""})]})};e.prototype.fromSchema=function(t){s(t,["cA","pathLenConstraint"]);var r=o(t,t,e.schema({names:{cA:"cA",pathLenConstraint:"pathLenConstraint"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for BasicConstraints");if("cA"in r.result)this.cA=r.result.cA.valueBlock.value;if("pathLenConstraint"in r.result){if(r.result.pathLenConstraint.valueBlock.isHexOnly)this.pathLenConstraint=r.result.pathLenConstraint;else this.pathLenConstraint=r.result.pathLenConstraint.valueBlock.valueDec}};e.prototype.toSchema=function(){var t=[];if(this.cA!==e.defaultValues("cA"))t.push(new R({value:this.cA}));if("pathLenConstraint"in this){if(this.pathLenConstraint instanceof v)t.push(this.pathLenConstraint);else t.push(new v({value:this.pathLenConstraint}))}return new a({value:t})};e.prototype.toJSON=function(){var t={};if(this.cA!==e.defaultValues("cA"))t.cA=this.cA;if("pathLenConstraint"in this){if(this.pathLenConstraint instanceof v)t.pathLenConstraint=this.pathLenConstraint.toJSON();else t.pathLenConstraint=this.pathLenConstraint}return t};return e}();var at=function(){function e(t){if(t===void 0){t={}}if("distributionPoint"in t)this.distributionPoint=r(t,"distributionPoint",e.defaultValues("distributionPoint"));this.onlyContainsUserCerts=r(t,"onlyContainsUserCerts",e.defaultValues("onlyContainsUserCerts"));this.onlyContainsCACerts=r(t,"onlyContainsCACerts",e.defaultValues("onlyContainsCACerts"));if("onlySomeReasons"in t)this.onlySomeReasons=r(t,"onlySomeReasons",e.defaultValues("onlySomeReasons"));this.indirectCRL=r(t,"indirectCRL",e.defaultValues("indirectCRL"));this.onlyContainsAttributeCerts=r(t,"onlyContainsAttributeCerts",e.defaultValues("onlyContainsAttributeCerts"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"distributionPoint":return[];case"onlyContainsUserCerts":return false;case"onlyContainsCACerts":return false;case"onlySomeReasons":return 0;case"indirectCRL":return false;case"onlyContainsAttributeCerts":return false;default:throw new Error("Invalid member name for IssuingDistributionPoint class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new S({optional:true,idBlock:{tagClass:3,tagNumber:0},value:[new C({value:[new S({name:t.distributionPoint||"",idBlock:{tagClass:3,tagNumber:0},value:[new k({name:t.distributionPointNames||"",value:tt.schema()})]}),new S({name:t.distributionPoint||"",idBlock:{tagClass:3,tagNumber:1},value:Ge.schema().valueBlock.value})]})]}),new P({name:t.onlyContainsUserCerts||"",optional:true,idBlock:{tagClass:3,tagNumber:1}}),new P({name:t.onlyContainsCACerts||"",optional:true,idBlock:{tagClass:3,tagNumber:2}}),new P({name:t.onlySomeReasons||"",optional:true,idBlock:{tagClass:3,tagNumber:3}}),new P({name:t.indirectCRL||"",optional:true,idBlock:{tagClass:3,tagNumber:4}}),new P({name:t.onlyContainsAttributeCerts||"",optional:true,idBlock:{tagClass:3,tagNumber:5}})]})};e.prototype.fromSchema=function(t){s(t,["distributionPoint","distributionPointNames","onlyContainsUserCerts","onlyContainsCACerts","onlySomeReasons","indirectCRL","onlyContainsAttributeCerts"]);var r=o(t,t,e.schema({names:{distributionPoint:"distributionPoint",distributionPointNames:"distributionPointNames",onlyContainsUserCerts:"onlyContainsUserCerts",onlyContainsCACerts:"onlyContainsCACerts",onlySomeReasons:"onlySomeReasons",indirectCRL:"indirectCRL",onlyContainsAttributeCerts:"onlyContainsAttributeCerts"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for IssuingDistributionPoint");if("distributionPoint"in r.result){switch(true){case r.result.distributionPoint.idBlock.tagNumber===0:this.distributionPoint=Array.from(r.result.distributionPointNames,(function(e){return new tt({schema:e})}));break;case r.result.distributionPoint.idBlock.tagNumber===1:{this.distributionPoint=new Ge({schema:new a({value:r.result.distributionPoint.valueBlock.value})})}break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}}if("onlyContainsUserCerts"in r.result){var i=new Uint8Array(r.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=i[0]!==0}if("onlyContainsCACerts"in r.result){var i=new Uint8Array(r.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=i[0]!==0}if("onlySomeReasons"in r.result){var i=new Uint8Array(r.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=i[0]}if("indirectCRL"in r.result){var i=new Uint8Array(r.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=i[0]!==0}if("onlyContainsAttributeCerts"in r.result){var i=new Uint8Array(r.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=i[0]!==0}};e.prototype.toSchema=function(){var t=[];if("distributionPoint"in this){var r=void 0;if(this.distributionPoint instanceof Array){r=new S({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,(function(e){return e.toSchema()}))})}else{r=this.distributionPoint.toSchema();r.idBlock.tagClass=3;r.idBlock.tagNumber=1}t.push(new S({idBlock:{tagClass:3,tagNumber:0},value:[r]}))}if(this.onlyContainsUserCerts!==e.defaultValues("onlyContainsUserCerts")){t.push(new P({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer}))}if(this.onlyContainsCACerts!==e.defaultValues("onlyContainsCACerts")){t.push(new P({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer}))}if("onlySomeReasons"in this){var i=new ArrayBuffer(1);var n=new Uint8Array(i);n[0]=this.onlySomeReasons;t.push(new P({idBlock:{tagClass:3,tagNumber:3},valueHex:i}))}if(this.indirectCRL!==e.defaultValues("indirectCRL")){t.push(new P({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer}))}if(this.onlyContainsAttributeCerts!==e.defaultValues("onlyContainsAttributeCerts")){t.push(new P({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer}))}return new a({value:t})};e.prototype.toJSON=function(){var t={};if("distributionPoint"in this){if(this.distributionPoint instanceof Array)t.distributionPoint=Array.from(this.distributionPoint,(function(e){return e.toJSON()}));else t.distributionPoint=this.distributionPoint.toJSON()}if(this.onlyContainsUserCerts!==e.defaultValues("onlyContainsUserCerts"))t.onlyContainsUserCerts=this.onlyContainsUserCerts;if(this.onlyContainsCACerts!==e.defaultValues("onlyContainsCACerts"))t.onlyContainsCACerts=this.onlyContainsCACerts;if("onlySomeReasons"in this)t.onlySomeReasons=this.onlySomeReasons;if(this.indirectCRL!==e.defaultValues("indirectCRL"))t.indirectCRL=this.indirectCRL;if(this.onlyContainsAttributeCerts!==e.defaultValues("onlyContainsAttributeCerts"))t.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts;return t};return e}();var nt=function(){function e(t){if(t===void 0){t={}}this.names=r(t,"names",e.defaultValues("names"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"names":return[];default:throw new Error("Invalid member name for GeneralNames class: "+e)}};e.schema=function(e,t){if(e===void 0){e={}}if(t===void 0){t=false}var i=r(e,"names",{});return new a({optional:t,name:i.blockName||"",value:[new k({name:i.generalNames||"",value:tt.schema()})]})};e.prototype.fromSchema=function(t){s(t,["names","generalNames"]);var r=o(t,t,e.schema({names:{blockName:"names",generalNames:"generalNames"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for GeneralNames");this.names=Array.from(r.result.generalNames,(function(e){return new tt({schema:e})}))};e.prototype.toSchema=function(){return new a({value:Array.from(this.names,(function(e){return e.toSchema()}))})};e.prototype.toJSON=function(){return{names:Array.from(this.names,(function(e){return e.toJSON()}))}};return e}();var st=function(){function e(t){if(t===void 0){t={}}this.base=r(t,"base",e.defaultValues("base"));this.minimum=r(t,"minimum",e.defaultValues("minimum"));if("maximum"in t)this.maximum=r(t,"maximum",e.defaultValues("maximum"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"base":return new tt;case"minimum":return 0;case"maximum":return 0;default:throw new Error("Invalid member name for GeneralSubtree class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[tt.schema(t.base||{}),new S({optional:true,idBlock:{tagClass:3,tagNumber:0},value:[new v({name:t.minimum||""})]}),new S({optional:true,idBlock:{tagClass:3,tagNumber:1},value:[new v({name:t.maximum||""})]})]})};e.prototype.fromSchema=function(t){s(t,["base","minimum","maximum"]);var r=o(t,t,e.schema({names:{base:{names:{blockName:"base"}},minimum:"minimum",maximum:"maximum"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for GeneralSubtree");this.base=new tt({schema:r.result.base});if("minimum"in r.result){if(r.result.minimum.valueBlock.isHexOnly)this.minimum=r.result.minimum;else this.minimum=r.result.minimum.valueBlock.valueDec}if("maximum"in r.result){if(r.result.maximum.valueBlock.isHexOnly)this.maximum=r.result.maximum;else this.maximum=r.result.maximum.valueBlock.valueDec}};e.prototype.toSchema=function(){var e=[];e.push(this.base.toSchema());if(this.minimum!==0){var t=0;if(this.minimum instanceof v)t=this.minimum;else t=new v({value:this.minimum});e.push(new S({optional:true,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if("maximum"in this){var r=0;if(this.maximum instanceof v)r=this.maximum;else r=new v({value:this.maximum});e.push(new S({optional:true,idBlock:{tagClass:3,tagNumber:1},value:[r]}))}return new a({value:e})};e.prototype.toJSON=function(){var e={base:this.base.toJSON()};if(this.minimum!==0){if(typeof this.minimum==="number")e.minimum=this.minimum;else e.minimum=this.minimum.toJSON()}if("maximum"in this){if(typeof this.maximum==="number")e.maximum=this.maximum;else e.maximum=this.maximum.toJSON()}return e};return e}();var ot=function(){function e(t){if(t===void 0){t={}}if("permittedSubtrees"in t)this.permittedSubtrees=r(t,"permittedSubtrees",e.defaultValues("permittedSubtrees"));if("excludedSubtrees"in t)this.excludedSubtrees=r(t,"excludedSubtrees",e.defaultValues("excludedSubtrees"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"permittedSubtrees":return[];case"excludedSubtrees":return[];default:throw new Error("Invalid member name for NameConstraints class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new S({optional:true,idBlock:{tagClass:3,tagNumber:0},value:[new k({name:t.permittedSubtrees||"",value:st.schema()})]}),new S({optional:true,idBlock:{tagClass:3,tagNumber:1},value:[new k({name:t.excludedSubtrees||"",value:st.schema()})]})]})};e.prototype.fromSchema=function(t){s(t,["permittedSubtrees","excludedSubtrees"]);var r=o(t,t,e.schema({names:{permittedSubtrees:"permittedSubtrees",excludedSubtrees:"excludedSubtrees"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for NameConstraints");if("permittedSubtrees"in r.result)this.permittedSubtrees=Array.from(r.result.permittedSubtrees,(function(e){return new st({schema:e})}));if("excludedSubtrees"in r.result)this.excludedSubtrees=Array.from(r.result.excludedSubtrees,(function(e){return new st({schema:e})}))};e.prototype.toSchema=function(){var e=[];if("permittedSubtrees"in this){e.push(new S({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.permittedSubtrees,(function(e){return e.toSchema()}))}))}if("excludedSubtrees"in this){e.push(new S({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.excludedSubtrees,(function(e){return e.toSchema()}))}))}return new a({value:e})};e.prototype.toJSON=function(){var e={};if("permittedSubtrees"in this)e.permittedSubtrees=Array.from(this.permittedSubtrees,(function(e){return e.toJSON()}));if("excludedSubtrees"in this)e.excludedSubtrees=Array.from(this.excludedSubtrees,(function(e){return e.toJSON()}));return e};return e}();var ut=function(){function e(t){if(t===void 0){t={}}if("distributionPoint"in t)this.distributionPoint=r(t,"distributionPoint",e.defaultValues("distributionPoint"));if("reasons"in t)this.reasons=r(t,"reasons",e.defaultValues("reasons"));if("cRLIssuer"in t)this.cRLIssuer=r(t,"cRLIssuer",e.defaultValues("cRLIssuer"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"distributionPoint":return[];case"reasons":return new y;case"cRLIssuer":return[];default:throw new Error("Invalid member name for DistributionPoint class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new S({optional:true,idBlock:{tagClass:3,tagNumber:0},value:[new C({value:[new S({name:t.distributionPoint||"",optional:true,idBlock:{tagClass:3,tagNumber:0},value:[new k({name:t.distributionPointNames||"",value:tt.schema()})]}),new S({name:t.distributionPoint||"",optional:true,idBlock:{tagClass:3,tagNumber:1},value:Ge.schema().valueBlock.value})]})]}),new P({name:t.reasons||"",optional:true,idBlock:{tagClass:3,tagNumber:1}}),new S({name:t.cRLIssuer||"",optional:true,idBlock:{tagClass:3,tagNumber:2},value:[new k({name:t.cRLIssuerNames||"",value:tt.schema()})]})]})};e.prototype.fromSchema=function(t){s(t,["distributionPoint","distributionPointNames","reasons","cRLIssuer","cRLIssuerNames"]);var r=o(t,t,e.schema({names:{distributionPoint:"distributionPoint",distributionPointNames:"distributionPointNames",reasons:"reasons",cRLIssuer:"cRLIssuer",cRLIssuerNames:"cRLIssuerNames"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for DistributionPoint");if("distributionPoint"in r.result){if(r.result.distributionPoint.idBlock.tagNumber===0)this.distributionPoint=Array.from(r.result.distributionPointNames,(function(e){return new tt({schema:e})}));if(r.result.distributionPoint.idBlock.tagNumber===1){this.distributionPoint=new Ge({schema:new a({value:r.result.distributionPoint.valueBlock.value})})}}if("reasons"in r.result)this.reasons=new y({valueHex:r.result.reasons.valueBlock.valueHex});if("cRLIssuer"in r.result)this.cRLIssuer=Array.from(r.result.cRLIssuerNames,(function(e){return new tt({schema:e})}))};e.prototype.toSchema=function(){var e=[];if("distributionPoint"in this){var t=void 0;if(this.distributionPoint instanceof Array){t=new S({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,(function(e){return e.toSchema()}))})}else{t=new S({idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]})}e.push(new S({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if("reasons"in this){e.push(new P({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHex}))}if("cRLIssuer"in this){e.push(new S({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,(function(e){return e.toSchema()}))}))}return new a({value:e})};e.prototype.toJSON=function(){var e={};if("distributionPoint"in this){if(this.distributionPoint instanceof Array)e.distributionPoint=Array.from(this.distributionPoint,(function(e){return e.toJSON()}));else e.distributionPoint=this.distributionPoint.toJSON()}if("reasons"in this)e.reasons=this.reasons.toJSON();if("cRLIssuer"in this)e.cRLIssuer=Array.from(this.cRLIssuer,(function(e){return e.toJSON()}));return e};return e}();var lt=function(){function e(t){if(t===void 0){t={}}this.distributionPoints=r(t,"distributionPoints",e.defaultValues("distributionPoints"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"distributionPoints":return[];default:throw new Error("Invalid member name for CRLDistributionPoints class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new k({name:t.distributionPoints||"",value:ut.schema()})]})};e.prototype.fromSchema=function(t){s(t,["distributionPoints"]);var r=o(t,t,e.schema({names:{distributionPoints:"distributionPoints"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for CRLDistributionPoints");this.distributionPoints=Array.from(r.result.distributionPoints,(function(e){return new ut({schema:e})}))};e.prototype.toSchema=function(){return new a({value:Array.from(this.distributionPoints,(function(e){return e.toSchema()}))})};e.prototype.toJSON=function(){return{distributionPoints:Array.from(this.distributionPoints,(function(e){return e.toJSON()}))}};return e}();var ct=function(){function e(t){if(t===void 0){t={}}this.policyQualifierId=r(t,"policyQualifierId",e.defaultValues("policyQualifierId"));this.qualifier=r(t,"qualifier",e.defaultValues("qualifier"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"policyQualifierId":return"";case"qualifier":return new i;default:throw new Error("Invalid member name for PolicyQualifierInfo class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new n({name:t.policyQualifierId||""}),new i({name:t.qualifier||""})]})};e.prototype.fromSchema=function(t){s(t,["policyQualifierId","qualifier"]);var r=o(t,t,e.schema({names:{policyQualifierId:"policyQualifierId",qualifier:"qualifier"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for PolicyQualifierInfo");this.policyQualifierId=r.result.policyQualifierId.valueBlock.toString();this.qualifier=r.result.qualifier};e.prototype.toSchema=function(){return new a({value:[new n({value:this.policyQualifierId}),this.qualifier]})};e.prototype.toJSON=function(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}};return e}();var ht=function(){function e(t){if(t===void 0){t={}}this.policyIdentifier=r(t,"policyIdentifier",e.defaultValues("policyIdentifier"));if("policyQualifiers"in t)this.policyQualifiers=r(t,"policyQualifiers",e.defaultValues("policyQualifiers"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"policyIdentifier":return"";case"policyQualifiers":return[];default:throw new Error("Invalid member name for PolicyInformation class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new n({name:t.policyIdentifier||""}),new a({optional:true,value:[new k({name:t.policyQualifiers||"",value:ct.schema()})]})]})};e.prototype.fromSchema=function(t){s(t,["policyIdentifier","policyQualifiers"]);var r=o(t,t,e.schema({names:{policyIdentifier:"policyIdentifier",policyQualifiers:"policyQualifiers"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for PolicyInformation");this.policyIdentifier=r.result.policyIdentifier.valueBlock.toString();if("policyQualifiers"in r.result)this.policyQualifiers=Array.from(r.result.policyQualifiers,(function(e){return new ct({schema:e})}))};e.prototype.toSchema=function(){var e=[];e.push(new n({value:this.policyIdentifier}));if("policyQualifiers"in this){e.push(new a({value:Array.from(this.policyQualifiers,(function(e){return e.toSchema()}))}))}return new a({value:e})};e.prototype.toJSON=function(){var e={policyIdentifier:this.policyIdentifier};if("policyQualifiers"in this)e.policyQualifiers=Array.from(this.policyQualifiers,(function(e){return e.toJSON()}));return e};return e}();var ft=function(){function e(t){if(t===void 0){t={}}this.certificatePolicies=r(t,"certificatePolicies",e.defaultValues("certificatePolicies"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"certificatePolicies":return[];default:throw new Error("Invalid member name for CertificatePolicies class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new k({name:t.certificatePolicies||"",value:ht.schema()})]})};e.prototype.fromSchema=function(t){s(t,["certificatePolicies"]);var r=o(t,t,e.schema({names:{certificatePolicies:"certificatePolicies"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for CertificatePolicies");this.certificatePolicies=Array.from(r.result.certificatePolicies,(function(e){return new ht({schema:e})}))};e.prototype.toSchema=function(){return new a({value:Array.from(this.certificatePolicies,(function(e){return e.toSchema()}))})};e.prototype.toJSON=function(){return{certificatePolicies:Array.from(this.certificatePolicies,(function(e){return e.toJSON()}))}};return e}();var mt=function(){function e(t){if(t===void 0){t={}}this.issuerDomainPolicy=r(t,"issuerDomainPolicy",e.defaultValues("issuerDomainPolicy"));this.subjectDomainPolicy=r(t,"subjectDomainPolicy",e.defaultValues("subjectDomainPolicy"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"issuerDomainPolicy":return"";case"subjectDomainPolicy":return"";default:throw new Error("Invalid member name for PolicyMapping class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new n({name:t.issuerDomainPolicy||""}),new n({name:t.subjectDomainPolicy||""})]})};e.prototype.fromSchema=function(t){s(t,["issuerDomainPolicy","subjectDomainPolicy"]);var r=o(t,t,e.schema({names:{issuerDomainPolicy:"issuerDomainPolicy",subjectDomainPolicy:"subjectDomainPolicy"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for PolicyMapping");this.issuerDomainPolicy=r.result.issuerDomainPolicy.valueBlock.toString();this.subjectDomainPolicy=r.result.subjectDomainPolicy.valueBlock.toString()};e.prototype.toSchema=function(){return new a({value:[new n({value:this.issuerDomainPolicy}),new n({value:this.subjectDomainPolicy})]})};e.prototype.toJSON=function(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}};return e}();var pt=function(){function e(t){if(t===void 0){t={}}this.mappings=r(t,"mappings",e.defaultValues("mappings"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"mappings":return[];default:throw new Error("Invalid member name for PolicyMappings class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new k({name:t.mappings||"",value:mt.schema()})]})};e.prototype.fromSchema=function(t){s(t,["mappings"]);var r=o(t,t,e.schema({names:{mappings:"mappings"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for PolicyMappings");this.mappings=Array.from(r.result.mappings,(function(e){return new mt({schema:e})}))};e.prototype.toSchema=function(){return new a({value:Array.from(this.mappings,(function(e){return e.toSchema()}))})};e.prototype.toJSON=function(){return{mappings:Array.from(this.mappings,(function(e){return e.toJSON()}))}};return e}();var vt=function(){function e(t){if(t===void 0){t={}}if("keyIdentifier"in t)this.keyIdentifier=r(t,"keyIdentifier",e.defaultValues("keyIdentifier"));if("authorityCertIssuer"in t)this.authorityCertIssuer=r(t,"authorityCertIssuer",e.defaultValues("authorityCertIssuer"));if("authorityCertSerialNumber"in t)this.authorityCertSerialNumber=r(t,"authorityCertSerialNumber",e.defaultValues("authorityCertSerialNumber"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"keyIdentifier":return new A;case"authorityCertIssuer":return[];case"authorityCertSerialNumber":return new v;default:throw new Error("Invalid member name for AuthorityKeyIdentifier class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new P({name:t.keyIdentifier||"",optional:true,idBlock:{tagClass:3,tagNumber:0}}),new S({optional:true,idBlock:{tagClass:3,tagNumber:1},value:[new k({name:t.authorityCertIssuer||"",value:tt.schema()})]}),new P({name:t.authorityCertSerialNumber||"",optional:true,idBlock:{tagClass:3,tagNumber:2}})]})};e.prototype.fromSchema=function(t){s(t,["keyIdentifier","authorityCertIssuer","authorityCertSerialNumber"]);var r=o(t,t,e.schema({names:{keyIdentifier:"keyIdentifier",authorityCertIssuer:"authorityCertIssuer",authorityCertSerialNumber:"authorityCertSerialNumber"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for AuthorityKeyIdentifier");if("keyIdentifier"in r.result)this.keyIdentifier=new A({valueHex:r.result.keyIdentifier.valueBlock.valueHex});if("authorityCertIssuer"in r.result)this.authorityCertIssuer=Array.from(r.result.authorityCertIssuer,(function(e){return new tt({schema:e})}));if("authorityCertSerialNumber"in r.result)this.authorityCertSerialNumber=new v({valueHex:r.result.authorityCertSerialNumber.valueBlock.valueHex})};e.prototype.toSchema=function(){var e=[];if("keyIdentifier"in this){e.push(new P({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHex}))}if("authorityCertIssuer"in this){e.push(new S({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,(function(e){return e.toSchema()}))}))}if("authorityCertSerialNumber"in this){e.push(new P({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHex}))}return new a({value:e})};e.prototype.toJSON=function(){var e={};if("keyIdentifier"in this)e.keyIdentifier=this.keyIdentifier.toJSON();if("authorityCertIssuer"in this)e.authorityCertIssuer=Array.from(this.authorityCertIssuer,(function(e){return e.toJSON()}));if("authorityCertSerialNumber"in this)e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON();return e};return e}();var dt=function(){function e(t){if(t===void 0){t={}}if("requireExplicitPolicy"in t)this.requireExplicitPolicy=r(t,"requireExplicitPolicy",e.defaultValues("requireExplicitPolicy"));if("inhibitPolicyMapping"in t)this.inhibitPolicyMapping=r(t,"inhibitPolicyMapping",e.defaultValues("inhibitPolicyMapping"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"requireExplicitPolicy":return 0;case"inhibitPolicyMapping":return 0;default:throw new Error("Invalid member name for PolicyConstraints class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new P({name:t.requireExplicitPolicy||"",optional:true,idBlock:{tagClass:3,tagNumber:0}}),new P({name:t.inhibitPolicyMapping||"",optional:true,idBlock:{tagClass:3,tagNumber:1}})]})};e.prototype.fromSchema=function(t){s(t,["requireExplicitPolicy","inhibitPolicyMapping"]);var r=o(t,t,e.schema({names:{requireExplicitPolicy:"requireExplicitPolicy",inhibitPolicyMapping:"inhibitPolicyMapping"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for PolicyConstraints");if("requireExplicitPolicy"in r.result){var i=r.result.requireExplicitPolicy;i.idBlock.tagClass=1;i.idBlock.tagNumber=2;var a=i.toBER(false);var n=g(a);this.requireExplicitPolicy=n.result.valueBlock.valueDec}if("inhibitPolicyMapping"in r.result){var u=r.result.inhibitPolicyMapping;u.idBlock.tagClass=1;u.idBlock.tagNumber=2;var l=u.toBER(false);var c=g(l);this.inhibitPolicyMapping=c.result.valueBlock.valueDec}};e.prototype.toSchema=function(){var e=[];if("requireExplicitPolicy"in this){var t=new v({value:this.requireExplicitPolicy});t.idBlock.tagClass=3;t.idBlock.tagNumber=0;e.push(t)}if("inhibitPolicyMapping"in this){var r=new v({value:this.inhibitPolicyMapping});r.idBlock.tagClass=3;r.idBlock.tagNumber=1;e.push(r)}return new a({value:e})};e.prototype.toJSON=function(){var e={};if("requireExplicitPolicy"in this)e.requireExplicitPolicy=this.requireExplicitPolicy;if("inhibitPolicyMapping"in this)e.inhibitPolicyMapping=this.inhibitPolicyMapping;return e};return e}();var yt=function(){function e(t){if(t===void 0){t={}}this.keyPurposes=r(t,"keyPurposes",e.defaultValues("keyPurposes"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"keyPurposes":return[];default:throw new Error("Invalid member name for ExtKeyUsage class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new k({name:t.keyPurposes||"",value:new n})]})};e.prototype.fromSchema=function(t){s(t,["keyPurposes"]);var r=o(t,t,e.schema({names:{keyPurposes:"keyPurposes"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for ExtKeyUsage");this.keyPurposes=Array.from(r.result.keyPurposes,(function(e){return e.valueBlock.toString()}))};e.prototype.toSchema=function(){return new a({value:Array.from(this.keyPurposes,(function(e){return new n({value:e})}))})};e.prototype.toJSON=function(){return{keyPurposes:Array.from(this.keyPurposes)}};return e}();var gt=function(){function e(t){if(t===void 0){t={}}this.accessMethod=r(t,"accessMethod",e.defaultValues("accessMethod"));this.accessLocation=r(t,"accessLocation",e.defaultValues("accessLocation"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"accessMethod":return"";case"accessLocation":return new tt;default:throw new Error("Invalid member name for AccessDescription class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new n({name:t.accessMethod||""}),tt.schema(t.accessLocation||{})]})};e.prototype.fromSchema=function(t){s(t,["accessMethod","accessLocation"]);var r=o(t,t,e.schema({names:{accessMethod:"accessMethod",accessLocation:{names:{blockName:"accessLocation"}}}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for AccessDescription");this.accessMethod=r.result.accessMethod.valueBlock.toString();this.accessLocation=new tt({schema:r.result.accessLocation})};e.prototype.toSchema=function(){return new a({value:[new n({value:this.accessMethod}),this.accessLocation.toSchema()]})};e.prototype.toJSON=function(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}};return e}();var bt=function(){function e(t){if(t===void 0){t={}}this.accessDescriptions=r(t,"accessDescriptions",e.defaultValues("accessDescriptions"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"accessDescriptions":return[];default:throw new Error("Invalid member name for InfoAccess class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new k({name:t.accessDescriptions||"",value:gt.schema()})]})};e.prototype.fromSchema=function(t){s(t,["accessDescriptions"]);var r=o(t,t,e.schema({names:{accessDescriptions:"accessDescriptions"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for InfoAccess");this.accessDescriptions=Array.from(r.result.accessDescriptions,(function(e){return new gt({schema:e})}))};e.prototype.toSchema=function(){return new a({value:Array.from(this.accessDescriptions,(function(e){return e.toSchema()}))})};e.prototype.toJSON=function(){return{accessDescriptions:Array.from(this.accessDescriptions,(function(e){return e.toJSON()}))}};return e}();var wt=function(){function e(e){if(e===void 0){e={}}this.clear();for(var t=0,r=Object.keys(e);t<r.length;t++){var i=r[t];switch(i){case"length":this.length=e.length;break;case"stub":for(var a=0;a<this._view.length;a++)this._view[a]=e.stub;break;case"view":this.fromUint8Array(e.view);break;case"buffer":this.fromArrayBuffer(e.buffer);break;case"string":this.fromString(e.string);break;case"hexstring":this.fromHexString(e.hexstring);break}}}Object.defineProperty(e.prototype,"buffer",{get:function(){return this._buffer},set:function(e){this._buffer=e.slice(0);this._view=new Uint8Array(this._buffer)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"view",{get:function(){return this._view},set:function(e){this._buffer=new ArrayBuffer(e.length);this._view=new Uint8Array(this._buffer);this._view.set(e)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"length",{get:function(){return this._buffer.byteLength},set:function(e){this._buffer=new ArrayBuffer(e);this._view=new Uint8Array(this._buffer)},enumerable:false,configurable:true});e.prototype.clear=function(){this._buffer=new ArrayBuffer(0);this._view=new Uint8Array(this._buffer)};e.prototype.fromArrayBuffer=function(e){this.buffer=e};e.prototype.fromUint8Array=function(e){this._buffer=new ArrayBuffer(e.length);this._view=new Uint8Array(this._buffer);this._view.set(e)};e.prototype.fromString=function(e){var t=e.length;this.length=t;for(var r=0;r<t;r++)this.view[r]=e.charCodeAt(r)};e.prototype.toString=function(e,t){if(e===void 0){e=0}if(t===void 0){t=this.view.length-e}var r="";if(e>=this.view.length||e<0){e=0}if(t>=this.view.length||t<0){t=this.view.length-e}for(var i=e;i<e+t;i++)r+=String.fromCharCode(this.view[i]);return r};e.prototype.fromHexString=function(e){var t=e.length;this.buffer=new ArrayBuffer(t>>1);this.view=new Uint8Array(this.buffer);var r=new Map;r.set("0",0);r.set("1",1);r.set("2",2);r.set("3",3);r.set("4",4);r.set("5",5);r.set("6",6);r.set("7",7);r.set("8",8);r.set("9",9);r.set("A",10);r.set("a",10);r.set("B",11);r.set("b",11);r.set("C",12);r.set("c",12);r.set("D",13);r.set("d",13);r.set("E",14);r.set("e",14);r.set("F",15);r.set("f",15);var i=0;var a=0;for(var n=0;n<t;n++){if(!(n%2)){a=r.get(e.charAt(n))<<4}else{a|=r.get(e.charAt(n));this.view[i]=a;i++}}};e.prototype.toHexString=function(e,t){if(e===void 0){e=0}if(t===void 0){t=this.view.length-e}var r="";if(e>=this.view.length||e<0){e=0}if(t>=this.view.length||t<0){t=this.view.length-e}for(var i=e;i<e+t;i++){var a=this.view[i].toString(16).toUpperCase();r=r+(a.length==1?"0":"")+a}return r};e.prototype.copy=function(t,r){if(t===void 0){t=0}if(r===void 0){r=this._buffer.byteLength-t}if(t===0&&this._buffer.byteLength===0)return new e;if(t<0||t>this._buffer.byteLength-1)throw new Error("Wrong start position: "+t);var i=new e;i._buffer=this._buffer.slice(t,t+r);i._view=new Uint8Array(i._buffer);return i};e.prototype.slice=function(t,r){if(t===void 0){t=0}if(r===void 0){r=this._buffer.byteLength}if(t===0&&this._buffer.byteLength===0)return new e;if(t<0||t>this._buffer.byteLength-1)throw new Error("Wrong start position: "+t);var i=new e;i._buffer=this._buffer.slice(t,r);i._view=new Uint8Array(i._buffer);return i};e.prototype.realloc=function(e){var t=new ArrayBuffer(e);var r=new Uint8Array(t);if(e>this._view.length)r.set(this._view);else{r.set(new Uint8Array(this._buffer,0,e))}this._buffer=t.slice(0);this._view=new Uint8Array(this._buffer)};e.prototype.append=function(e){var t=this._buffer.byteLength;var r=e._buffer.byteLength;var i=e._view.slice();this.realloc(t+r);this._view.set(i,t)};e.prototype.insert=function(e,t,r){if(t===void 0){t=0}if(r===void 0){r=this._buffer.byteLength-t}if(t>this._buffer.byteLength-1)return false;if(r>this._buffer.byteLength-t){r=this._buffer.byteLength-t}if(r>e._buffer.byteLength){r=e._buffer.byteLength}if(r==e._buffer.byteLength)this._view.set(e._view,t);else{this._view.set(e._view.slice(0,r),t)}return true};e.prototype.isEqual=function(e){if(this._buffer.byteLength!=e._buffer.byteLength)return false;for(var t=0;t<e._buffer.byteLength;t++){if(this.view[t]!=e.view[t])return false}return true};e.prototype.isEqualView=function(e){if(e.length!=this.view.length)return false;for(var t=0;t<e.length;t++){if(this.view[t]!=e[t])return false}return true};e.prototype.findPattern=function(e,t,r,i){if(t===void 0){t=null}if(r===void 0){r=null}if(i===void 0){i=false}if(t==null){t=i?this.buffer.byteLength:0}if(t>this.buffer.byteLength){t=this.buffer.byteLength}if(i){if(r==null){r=t}if(r>t){r=t}}else{if(r==null){r=this.buffer.byteLength-t}if(r>this.buffer.byteLength-t){r=this.buffer.byteLength-t}}var a=e.buffer.byteLength;if(a>r)return-1;var n=[];for(var s=0;s<a;s++)n.push(e.view[s]);for(var s=0;s<=r-a;s++){var o=true;var u=i?t-a-s:t+s;for(var l=0;l<a;l++){if(this.view[l+u]!=n[l]){o=false;break}}if(o){return i?t-a-s:t+a+s}}return-1};e.prototype.findFirstIn=function(e,t,r,i){if(t===void 0){t=null}if(r===void 0){r=null}if(i===void 0){i=false}if(t==null){t=i?this.buffer.byteLength:0}if(t>this.buffer.byteLength){t=this.buffer.byteLength}if(i){if(r==null){r=t}if(r>t){r=t}}else{if(r==null){r=this.buffer.byteLength-t}if(r>this.buffer.byteLength-t){r=this.buffer.byteLength-t}}var a={id:-1,position:i?0:t+r,length:0};for(var n=0;n<e.length;n++){var s=this.findPattern(e[n],t,r,i);if(s!=-1){var o=false;var u=e[n].length;if(i){if(s-u>=a.position-a.length)o=true}else{if(s-u<=a.position-a.length)o=true}if(o){a.position=s;a.id=n;a.length=u}}}return a};e.prototype.findAllIn=function(e,t,r){if(t===void 0){t=0}if(r===void 0){r=this.buffer.byteLength-t}var i=[];if(t==null){t=0}if(t>this.buffer.byteLength-1)return i;if(r==null){r=this.buffer.byteLength-t}if(r>this.buffer.byteLength-t){r=this.buffer.byteLength-t}var a={id:-1,position:t};do{var n=a.position;a=this.findFirstIn(e,a.position,r);if(a.id==-1){break}r-=a.position-n;i.push({id:a.id,position:a.position})}while(true);return i};e.prototype.findAllPatternIn=function(e,t,r){if(t===void 0){t=0}if(r===void 0){r=this.buffer.byteLength-t}if(t==null){t=0}if(t>this.buffer.byteLength){t=this.buffer.byteLength}if(r==null){r=this.buffer.byteLength-t}if(r>this.buffer.byteLength-t){r=this.buffer.byteLength-t}var i=[];var a=e.buffer.byteLength;if(a>r)return-1;var n=Array.from(e.view);for(var s=0;s<=r-a;s++){var o=true;var u=t+s;for(var l=0;l<a;l++){if(this.view[l+u]!=n[l]){o=false;break}}if(o){i.push(t+a+s);s+=a-1}}return i};e.prototype.findFirstNotIn=function(t,r,i,a){if(r===void 0){r=null}if(i===void 0){i=null}if(a===void 0){a=false}if(r==null){r=a?this.buffer.byteLength:0}if(r>this.buffer.byteLength){r=this.buffer.byteLength}if(a){if(i==null){i=r}if(i>r){i=r}}else{if(i==null){i=this.buffer.byteLength-r}if(i>this.buffer.byteLength-r){i=this.buffer.byteLength-r}}var n={left:{id:-1,position:r},right:{id:-1,position:0},value:new e};var s=i;while(s>0){n.right=this.findFirstIn(t,a?r-i+s:r+i-s,s,a);if(n.right.id==-1){i=s;if(a){r-=i}else{r=n.left.position}n.value=new e;n.value._buffer=this._buffer.slice(r,r+i);n.value._view=new Uint8Array(n.value._buffer);break}if(n.right.position!=(a?n.left.position-t[n.right.id].buffer.byteLength:n.left.position+t[n.right.id].buffer.byteLength)){if(a){r=n.right.position+t[n.right.id].buffer.byteLength;i=n.left.position-n.right.position-t[n.right.id].buffer.byteLength}else{r=n.left.position;i=n.right.position-n.left.position-t[n.right.id].buffer.byteLength}n.value=new e;n.value._buffer=this._buffer.slice(r,r+i);n.value._view=new Uint8Array(n.value._buffer);break}n.left=n.right;s-=t[n.right.id]._buffer.byteLength}if(a){var o=n.right;n.right=n.left;n.left=o}return n};e.prototype.findAllNotIn=function(t,r,i){if(r===void 0){r=null}if(i===void 0){i=null}var a=[];if(r==null){r=0}if(r>this.buffer.byteLength-1)return a;if(i==null){i=this.buffer.byteLength-r}if(i>this.buffer.byteLength-r){i=this.buffer.byteLength-r}var n={left:{id:-1,position:r},right:{id:-1,position:r},value:new e};do{var s=n.right.position;n=this.findFirstNotIn(t,n.right.position,i);i-=n.right.position-s;a.push({left:{id:n.left.id,position:n.left.position},right:{id:n.right.id,position:n.right.position},value:n.value})}while(n.right.id!=-1);return a};e.prototype.findFirstSequence=function(t,r,i,a){if(r===void 0){r=null}if(i===void 0){i=null}if(a===void 0){a=false}if(r==null){r=a?this.buffer.byteLength:0}if(r>this.buffer.byteLength){r=this.buffer.byteLength}if(a){if(i==null){i=r}if(i>r){i=r}}else{if(i==null){i=this.buffer.byteLength-r}if(i>this.buffer.byteLength-r){i=this.buffer.byteLength-r}}var n=this.skipNotPatterns(t,r,i,a);if(n==-1){return{position:-1,value:new e}}var s=this.skipPatterns(t,n,i-(a?r-n:n-r),a);if(a){r=s;i=n-s}else{r=n;i=s-n}var o=new e;o._buffer=this._buffer.slice(r,r+i);o._view=new Uint8Array(o._buffer);return{position:s,value:o}};e.prototype.findAllSequences=function(t,r,i){if(r===void 0){r=null}if(i===void 0){i=null}var a=[];if(r==null){r=0}if(r>this.buffer.byteLength-1)return a;if(i==null){i=this.buffer.byteLength-r}if(i>this.buffer.byteLength-r){i=this.buffer.byteLength-r}var n={position:r,value:new e};do{var s=n.position;n=this.findFirstSequence(t,n.position,i);if(n.position!=-1){i-=n.position-s;a.push({position:n.position,value:n.value})}}while(n.position!=-1);return a};e.prototype.findPairedPatterns=function(e,t,r,i){if(r===void 0){r=null}if(i===void 0){i=null}var a=[];if(e.isEqual(t))return a;if(r==null){r=0}if(r>this.buffer.byteLength-1)return a;if(i==null){i=this.buffer.byteLength-r}if(i>this.buffer.byteLength-r){i=this.buffer.byteLength-r}var n=0;var s=this.findAllPatternIn(e,r,i);if(s.length==0)return a;var o=this.findAllPatternIn(t,r,i);if(o.length==0)return a;while(n<s.length){if(o.length==0){break}if(s[0]==o[0]){a.push({left:s[0],right:o[0]});s.splice(0,1);o.splice(0,1);continue}if(s[n]>o[0]){break}while(s[n]<o[0]){n++;if(n>=s.length){break}}a.push({left:s[n-1],right:o[0]});s.splice(n-1,1);o.splice(0,1);n=0}a.sort((function(e,t){return e.left-t.left}));return a};e.prototype.findPairedArrays=function(e,t,r,i){if(r===void 0){r=null}if(i===void 0){i=null}var a=[];if(r==null){r=0}if(r>this.buffer.byteLength-1)return a;if(i==null){i=this.buffer.byteLength-r}if(i>this.buffer.byteLength-r){i=this.buffer.byteLength-r}var n=0;var s=this.findAllIn(e,r,i);if(s.length==0)return a;var o=this.findAllIn(t,r,i);if(o.length==0)return a;while(n<s.length){if(o.length==0){break}if(s[0].position==o[0].position){a.push({left:s[0],right:o[0]});s.splice(0,1);o.splice(0,1);continue}if(s[n].position>o[0].position){break}while(s[n].position<o[0].position){n++;if(n>=s.length){break}}a.push({left:s[n-1],right:o[0]});s.splice(n-1,1);o.splice(0,1);n=0}a.sort((function(e,t){return e.left.position-t.left.position}));return a};e.prototype.replacePattern=function(e,t,r,i,a){var n;if(r===void 0){r=null}if(i===void 0){i=null}if(a===void 0){a=null}var s;var o;var u={status:-1,searchPatternPositions:[],replacePatternPositions:[]};if(r==null){r=0}if(r>this.buffer.byteLength-1)return false;if(i==null){i=this.buffer.byteLength-r}if(i>this.buffer.byteLength-r){i=this.buffer.byteLength-r}if(a==null){s=this.findAllIn([e],r,i);if(s.length==0)return u}else s=a;(n=u.searchPatternPositions).push.apply(n,Array.from(s,(function(e){return e.position})));var l=e.buffer.byteLength-t.buffer.byteLength;var c=new ArrayBuffer(this.view.length-s.length*l);var h=new Uint8Array(c);h.set(new Uint8Array(this.buffer,0,r));for(o=0;o<s.length;o++){var f=o==0?r:s[o-1].position;h.set(new Uint8Array(this.buffer,f,s[o].position-e.buffer.byteLength-f),f-o*l);h.set(t.view,s[o].position-e.buffer.byteLength-o*l);u.replacePatternPositions.push(s[o].position-e.buffer.byteLength-o*l)}o--;h.set(new Uint8Array(this.buffer,s[o].position,this.buffer.byteLength-s[o].position),s[o].position-e.buffer.byteLength+t.buffer.byteLength-o*l);this.buffer=c;this.view=new Uint8Array(this.buffer);u.status=1;return u};e.prototype.skipPatterns=function(e,t,r,i){if(t===void 0){t=null}if(r===void 0){r=null}if(i===void 0){i=false}if(t==null){t=i?this.buffer.byteLength:0}if(t>this.buffer.byteLength){t=this.buffer.byteLength}if(i){if(r==null){r=t}if(r>t){r=t}}else{if(r==null){r=this.buffer.byteLength-t}if(r>this.buffer.byteLength-t){r=this.buffer.byteLength-t}}var a=t;for(var n=0;n<e.length;n++){var s=e[n].buffer.byteLength;var o=i?a-s:a;var u=true;for(var l=0;l<s;l++){if(this.view[l+o]!=e[n].view[l]){u=false;break}}if(u){n=-1;if(i){a-=s;if(a<=0)return a}else{a+=s;if(a>=t+r)return a}}}return a};e.prototype.skipNotPatterns=function(e,t,r,i){if(t===void 0){t=null}if(r===void 0){r=null}if(i===void 0){i=false}if(t==null){t=i?this.buffer.byteLength:0}if(t>this.buffer.byteLength){t=this.buffer.byteLength}if(i){if(r==null){r=t}if(r>t){r=t}}else{if(r==null){r=this.buffer.byteLength-t}if(r>this.buffer.byteLength-t){r=this.buffer.byteLength-t}}var a=-1;for(var n=0;n<r;n++){for(var s=0;s<e.length;s++){var o=e[s].buffer.byteLength;var u=i?t-n-o:t+n;var l=true;for(var c=0;c<o;c++){if(this.view[c+u]!=e[s].view[c]){l=false;break}}if(l){a=i?t-n:t+n;break}}if(a!=-1){break}}return a};return e}();var kt=function(){function e(e){if(e===void 0){e={}}this.stream=new wt;this._length=0;this.backward=false;this._start=0;this.appendBlock=0;this.prevLength=0;this.prevStart=0;for(var t=0,r=Object.keys(e);t<r.length;t++){var i=r[t];switch(i){case"stream":this.stream=e.stream;break;case"backward":this.backward=e.backward;this._start=this.stream.buffer.byteLength;break;case"length":this._length=e.length;break;case"start":this._start=e.start;break;case"appendBlock":this.appendBlock=e.appendBlock;break;case"view":this.stream=new wt({view:e.view});break;case"buffer":this.stream=new wt({buffer:e.buffer});break;case"string":this.stream=new wt({string:e.string});break;case"hexstring":this.stream=new wt({hexstring:e.hexstring});break}}}Object.defineProperty(e.prototype,"stream",{get:function(){return this._stream},set:function(e){this._stream=e;this.prevLength=this._length;this._length=e._buffer.byteLength;this.prevStart=this._start;this._start=0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"length",{get:function(){if(this.appendBlock)return this.start;return this._length},set:function(e){this.prevLength=this._length;this._length=e},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"start",{get:function(){return this._start},set:function(e){if(e>this.stream.buffer.byteLength)return;this.prevStart=this._start;this.prevLength=this._length;this._length-=this.backward?this._start-e:e-this._start;this._start=e},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"buffer",{get:function(){return this._stream._buffer.slice(0,this._length)},enumerable:false,configurable:true});e.prototype.resetPosition=function(){this._start=this.prevStart;this._length=this.prevLength};e.prototype.findPattern=function(e,t){if(t===void 0){t=null}if(t==null||t>this.length){t=this.length}var r=this.stream.findPattern(e,this.start,this.length,this.backward);if(r==-1)return r;if(this.backward){if(r<this.start-e.buffer.byteLength-t)return-1}else{if(r>this.start+e.buffer.byteLength+t)return-1}this.start=r;return r};e.prototype.findFirstIn=function(e,t){if(t===void 0){t=null}if(t==null||t>this.length){t=this.length}var r=this.stream.findFirstIn(e,this.start,this.length,this.backward);if(r.id==-1)return r;if(this.backward){if(r.position<this.start-e[r.id].buffer.byteLength-t){return{id:-1,position:this.backward?0:this.start+this.length}}}else{if(r.position>this.start+e[r.id].buffer.byteLength+t){return{id:-1,position:this.backward?0:this.start+this.length}}}this.start=r.position;return r};e.prototype.findAllIn=function(e){var t=this.backward?this.start-this.length:this.start;return this.stream.findAllIn(e,t,this.length)};e.prototype.findFirstNotIn=function(e,t){if(t===void 0){t=null}if(t==null||t>this._length){t=this._length}var r=this._stream.findFirstNotIn(e,this._start,this._length,this.backward);if(r.left.id==-1&&r.right.id==-1)return r;if(this.backward){if(r.right.id!=-1){if(r.right.position<this._start-e[r.right.id]._buffer.byteLength-t){return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new wt}}}}else{if(r.left.id!=-1){if(r.left.position>this._start+e[r.left.id]._buffer.byteLength+t){return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new wt}}}}if(this.backward){if(r.left.id==-1)this.start=0;else this.start=r.left.position}else{if(r.right.id==-1)this.start=this._start+this._length;else this.start=r.right.position}return r};e.prototype.findAllNotIn=function(e){var t=this.backward?this._start-this._length:this._start;return this._stream.findAllNotIn(e,t,this._length)};e.prototype.findFirstSequence=function(e,t,r){if(t===void 0){t=null}if(r===void 0){r=null}if(t==null||t>this._length){t=this._length}if(r==null||r>t){r=t}var i=this._stream.findFirstSequence(e,this._start,t,this.backward);if(i.value.buffer.byteLength==0)return i;if(this.backward){if(i.position<this._start-i.value._buffer.byteLength-r){return{position:-1,value:new wt}}}else{if(i.position>this._start+i.value._buffer.byteLength+r){return{position:-1,value:new wt}}}this.start=i.position;return i};e.prototype.findAllSequences=function(e){var t=this.backward?this.start-this.length:this.start;return this.stream.findAllSequences(e,t,this.length)};e.prototype.findPairedPatterns=function(e,t,r){if(r===void 0){r=null}if(r==null||r>this.length){r=this.length}var i=this.backward?this.start-this.length:this.start;var a=this.stream.findPairedPatterns(e,t,i,this.length);if(a.length){if(this.backward){if(a[0].right<this.start-t.buffer.byteLength-r)return[]}else{if(a[0].left>this.start+e.buffer.byteLength+r)return[]}}return a};e.prototype.findPairedArrays=function(e,t,r){if(r===void 0){r=null}if(r==null||r>this.length){r=this.length}var i=this.backward?this.start-this.length:this.start;var a=this.stream.findPairedArrays(e,t,i,this.length);if(a.length){if(this.backward){if(a[0].right.position<this.start-t[a[0].right.id].buffer.byteLength-r)return[]}else{if(a[0].left.position>this.start+e[a[0].left.id].buffer.byteLength+r)return[]}}return a};e.prototype.replacePattern=function(e,t){var r=this.backward?this.start-this.length:this.start;return this.stream.replacePattern(e,t,r,this.length)};e.prototype.skipPatterns=function(e){var t=this.stream.skipPatterns(e,this.start,this.length,this.backward);this.start=t;return t};e.prototype.skipNotPatterns=function(e){var t=this.stream.skipNotPatterns(e,this.start,this.length,this.backward);if(t==-1)return-1;this.start=t;return t};e.prototype.append=function(e){if(this._start+e._buffer.byteLength>this._stream._buffer.byteLength){if(e._buffer.byteLength>this.appendBlock){this.appendBlock=e._buffer.byteLength+1e3}this._stream.realloc(this._stream._buffer.byteLength+this.appendBlock)}this._stream._view.set(e._view,this._start);this._length+=e._buffer.byteLength*2;this.start=this._start+e._buffer.byteLength;this.prevLength-=e._buffer.byteLength*2};e.prototype.appendView=function(e){if(this._start+e.length>this._stream._buffer.byteLength){if(e.length>this.appendBlock){this.appendBlock=e.length+1e3}this._stream.realloc(this._stream._buffer.byteLength+this.appendBlock)}this._stream._view.set(e,this._start);this._length+=e.length*2;this.start=this._start+e.length;this.prevLength-=e.length*2};e.prototype.appendChar=function(e){if(this._start+1>this._stream._buffer.byteLength){if(1>this.appendBlock){this.appendBlock=1e3}this._stream.realloc(this._stream._buffer.byteLength+this.appendBlock)}this._stream._view[this._start]=e;this._length+=2;this.start=this._start+1;this.prevLength-=2};e.prototype.appendUint16=function(e){if(this._start+2>this._stream._buffer.byteLength){if(2>this.appendBlock){this.appendBlock=1e3}this._stream.realloc(this._stream._buffer.byteLength+this.appendBlock)}var t=new Uint16Array([e]);var r=new Uint8Array(t.buffer);this._stream._view[this._start]=r[1];this._stream._view[this._start+1]=r[0];this._length+=4;this.start=this._start+2;this.prevLength-=4};e.prototype.appendUint24=function(e){if(this._start+3>this._stream._buffer.byteLength){if(3>this.appendBlock){this.appendBlock=1e3}this._stream.realloc(this._stream._buffer.byteLength+this.appendBlock)}var t=new Uint32Array([e]);var r=new Uint8Array(t.buffer);this._stream._view[this._start]=r[2];this._stream._view[this._start+1]=r[1];this._stream._view[this._start+2]=r[0];this._length+=6;this.start=this._start+3;this.prevLength-=6};e.prototype.appendUint32=function(e){if(this._start+4>this._stream._buffer.byteLength){if(4>this.appendBlock){this.appendBlock=1e3}this._stream.realloc(this._stream._buffer.byteLength+this.appendBlock)}var t=new Uint32Array([e]);var r=new Uint8Array(t.buffer);this._stream._view[this._start]=r[3];this._stream._view[this._start+1]=r[2];this._stream._view[this._start+2]=r[1];this._stream._view[this._start+3]=r[0];this._length+=8;this.start=this._start+4;this.prevLength-=8};e.prototype.getBlock=function(e,t){if(t===void 0){t=true}if(this._length<=0)return[];if(this._length<e){e=this._length}var r;if(this.backward){var i=this._stream._buffer.slice(this._length-e,this._length);var a=new Uint8Array(i);r=new Array(e);for(var n=0;n<e;n++)r[e-1-n]=a[n]}else{var i=this._stream._buffer.slice(this._start,this._start+e);r=Array.from(new Uint8Array(i))}if(t){this.start+=this.backward?-1*e:e}return r};e.prototype.getUint16=function(e){if(e===void 0){e=true}var t=this.getBlock(2,e);if(t.length<2)return 0;var r=new Uint16Array(1);var i=new Uint8Array(r.buffer);i[0]=t[1];i[1]=t[0];return r[0]};e.prototype.getInt16=function(e){if(e===void 0){e=true}var t=this.getBlock(2,e);if(t.length<2)return 0;var r=new Int16Array(1);var i=new Uint8Array(r.buffer);i[0]=t[1];i[1]=t[0];return r[0]};e.prototype.getUint24=function(e){if(e===void 0){e=true}var t=this.getBlock(3,e);if(t.length<3)return 0;var r=new Uint32Array(1);var i=new Uint8Array(r.buffer);for(var a=3;a>=1;a--)i[3-a]=t[a-1];return r[0]};e.prototype.getUint32=function(e){if(e===void 0){e=true}var t=this.getBlock(4,e);if(t.length<4)return 0;var r=new Uint32Array(1);var i=new Uint8Array(r.buffer);for(var a=3;a>=0;a--)i[3-a]=t[a];return r[0]};e.prototype.getInt32=function(e){if(e===void 0){e=true}var t=this.getBlock(4,e);if(t.length<4)return 0;var r=new Int32Array(1);var i=new Uint8Array(r.buffer);for(var a=3;a>=0;a--)i[3-a]=t[a];return r[0]};return e}();var At=function(){function e(t){if(t===void 0){t={}}this.version=r(t,"version",e.defaultValues("version"));this.logID=r(t,"logID",e.defaultValues("logID"));this.timestamp=r(t,"timestamp",e.defaultValues("timestamp"));this.extensions=r(t,"extensions",e.defaultValues("extensions"));this.hashAlgorithm=r(t,"hashAlgorithm",e.defaultValues("hashAlgorithm"));this.signatureAlgorithm=r(t,"signatureAlgorithm",e.defaultValues("signatureAlgorithm"));this.signature=r(t,"signature",e.defaultValues("signature"));if("schema"in t)this.fromSchema(t.schema);if("stream"in t)this.fromStream(t.stream)}e.defaultValues=function(e){switch(e){case"version":return 0;case"logID":case"extensions":return new ArrayBuffer(0);case"timestamp":return new Date(0);case"hashAlgorithm":case"signatureAlgorithm":return"";case"signature":return new i;default:throw new Error("Invalid member name for SignedCertificateTimestamp class: "+e)}};e.prototype.fromSchema=function(e){if(e instanceof l===false)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestamp");var t=new kt({stream:new wt({buffer:e.data})});this.fromStream(t)};e.prototype.fromStream=function(e){var t=e.getUint16();this.version=e.getBlock(1)[0];if(this.version===0){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0);this.timestamp=new Date(J(new Uint8Array(e.getBlock(8)),8));var r=e.getUint16();this.extensions=new Uint8Array(e.getBlock(r)).buffer.slice(0);switch(e.getBlock(1)[0]){case 0:this.hashAlgorithm="none";break;case 1:this.hashAlgorithm="md5";break;case 2:this.hashAlgorithm="sha1";break;case 3:this.hashAlgorithm="sha224";break;case 4:this.hashAlgorithm="sha256";break;case 5:this.hashAlgorithm="sha384";break;case 6:this.hashAlgorithm="sha512";break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm="anonymous";break;case 1:this.signatureAlgorithm="rsa";break;case 2:this.signatureAlgorithm="dsa";break;case 3:this.signatureAlgorithm="ecdsa";break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}var i=e.getUint16();var a=new Uint8Array(e.getBlock(i)).buffer.slice(0);var n=g(a);if(n.offset===-1)throw new Error("Object's stream was not correct for SignedCertificateTimestamp");this.signature=n.result;if(t!==47+r+i)throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}};e.prototype.toSchema=function(){var e=this.toStream();return new l({data:e.stream.buffer})};e.prototype.toStream=function(){var e=new kt;e.appendUint16(47+this.extensions.byteLength+this.signature.valueBeforeDecode.byteLength);e.appendChar(this.version);e.appendView(new Uint8Array(this.logID));var t=new ArrayBuffer(8);var r=new Uint8Array(t);var i=M(this.timestamp.valueOf(),8);r.set(new Uint8Array(i),8-i.byteLength);e.appendView(r);e.appendUint16(this.extensions.byteLength);if(this.extensions.byteLength)e.appendView(new Uint8Array(this.extensions));var a;switch(this.hashAlgorithm.toLowerCase()){case"none":a=0;break;case"md5":a=1;break;case"sha1":a=2;break;case"sha224":a=3;break;case"sha256":a=4;break;case"sha384":a=5;break;case"sha512":a=6;break;default:throw new Error("Incorrect data for hashAlgorithm: "+this.hashAlgorithm)}e.appendChar(a);var n;switch(this.signatureAlgorithm.toLowerCase()){case"anonymous":n=0;break;case"rsa":n=1;break;case"dsa":n=2;break;case"ecdsa":n=3;break;default:throw new Error("Incorrect data for signatureAlgorithm: "+this.signatureAlgorithm)}e.appendChar(n);var s=this.signature.toBER(false);e.appendUint16(s.byteLength);e.appendView(new Uint8Array(s));return e};e.prototype.toJSON=function(){return{version:this.version,logID:q(this.logID),timestamp:this.timestamp,extensions:q(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:this.signature.toJSON()}};e.prototype.verify=function(e,t,r){if(r===void 0){r=0}return __awaiter(this,void 0,void 0,(function(){var i,a,n,s,o,u,l,c,v,d,y;return __generator(this,(function(b){i=h(f(this.logID));a=null;s=new kt;for(o=0,u=e;o<u.length;o++){l=u[o];if(l.log_id===i){a=l.key;break}}if(a===null)throw new Error("Public key not found for CT with logId: "+i);c=g(m(p(a)));if(c.offset===-1)throw new Error("Incorrect key value for CT Log with logId: "+i);n=new Be({schema:c.result});s.appendChar(0);s.appendChar(0);v=new ArrayBuffer(8);d=new Uint8Array(v);y=M(this.timestamp.valueOf(),8);d.set(new Uint8Array(y),8-y.byteLength);s.appendView(d);s.appendUint16(r);if(r===0)s.appendUint24(t.byteLength);s.appendView(new Uint8Array(t));s.appendUint16(this.extensions.byteLength);if(this.extensions.byteLength!==0)s.appendView(new Uint8Array(this.extensions));return[2,Me().subtle.verifyWithPublicKey(s._stream._buffer.slice(0,s._length),{valueBlock:{valueHex:this.signature.toBER(false)}},n,{algorithmId:""},"SHA-256")]}))}))};return e}();var St=function(){function e(t){if(t===void 0){t={}}this.timestamps=r(t,"timestamps",e.defaultValues("timestamps"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"timestamps":return[];default:throw new Error("Invalid member name for SignedCertificateTimestampList class: "+e)}};e.compareWithDefault=function(e,t){switch(e){case"timestamps":return t.length===0;default:throw new Error("Invalid member name for SignedCertificateTimestampList class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});if("optional"in t===false)t.optional=false;return new A({name:t.blockName||"SignedCertificateTimestampList",optional:t.optional})};e.prototype.fromSchema=function(e){if(e instanceof A===false)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");var t=new kt({stream:new wt({buffer:e.valueBlock.valueHex})});var r=t.getUint16();if(r!==t.length)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");while(t.length)this.timestamps.push(new At({stream:t}))};e.prototype.toSchema=function(){var e=new kt;var t=0;var r=[];for(var i=0,a=this.timestamps;i<a.length;i++){var n=a[i];var s=n.toStream();r.push(s);t+=s.stream.buffer.byteLength}e.appendUint16(t);for(var o=0,u=r;o<u.length;o++){var n=u[o];e.appendView(n.stream.view)}return new A({valueHex:e.stream.buffer.slice(0)})};e.prototype.toJSON=function(){return{timestamps:Array.from(this.timestamps,(function(e){return e.toJSON()}))}};return e}();var Ct=function(){function e(t){if(t===void 0){t={}}this.templateID=r(t,"templateID",e.defaultValues("templateID"));if("templateMajorVersion"in t)this.templateMajorVersion=r(t,"templateMajorVersion",e.defaultValues("templateMajorVersion"));if("templateMinorVersion"in t)this.templateMinorVersion=r(t,"templateMinorVersion",e.defaultValues("templateMinorVersion"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"templateID":return"";case"templateMajorVersion":case"templateMinorVersion":return 0;default:throw new Error("Invalid member name for CertificateTemplate class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new n({name:t.templateID||""}),new v({name:t.templateMajorVersion||"",optional:true}),new v({name:t.templateMinorVersion||"",optional:true})]})};e.prototype.fromSchema=function(t){s(t,["templateID","templateMajorVersion","templateMinorVersion"]);var r=o(t,t,e.schema({names:{templateID:"templateID",templateMajorVersion:"templateMajorVersion",templateMinorVersion:"templateMinorVersion"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for CertificateTemplate");this.templateID=r.result.templateID.valueBlock.toString();if("templateMajorVersion"in r.result)this.templateMajorVersion=r.result.templateMajorVersion.valueBlock.valueDec;if("templateMinorVersion"in r.result)this.templateMinorVersion=r.result.templateMinorVersion.valueBlock.valueDec};e.prototype.toSchema=function(){var e=[];e.push(new n({value:this.templateID}));if("templateMajorVersion"in this)e.push(new v({value:this.templateMajorVersion}));if("templateMinorVersion"in this)e.push(new v({value:this.templateMinorVersion}));return new a({value:e})};e.prototype.toJSON=function(){var e={extnID:this.templateID};if("templateMajorVersion"in this)e.templateMajorVersion=this.templateMajorVersion;if("templateMinorVersion"in this)e.templateMinorVersion=this.templateMinorVersion;return e};return e}();var Pt=function(){function e(t){if(t===void 0){t={}}this.certificateIndex=r(t,"certificateIndex",e.defaultValues("certificateIndex"));this.keyIndex=r(t,"keyIndex",e.defaultValues("keyIndex"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"certificateIndex":case"keyIndex":return 0;default:throw new Error("Invalid member name for CAVersion class: "+e)}};e.schema=function(e){if(e===void 0){e={}}return new v};e.prototype.fromSchema=function(e){if(e.constructor.blockName()!==v.blockName())throw new Error("Object's schema was not verified against input data for CAVersion");var t=e.valueBlock.valueHex.slice(0);var r=new Uint8Array(t);switch(true){case t.byteLength<4:{var i=new ArrayBuffer(4);var a=new Uint8Array(i);a.set(r,4-t.byteLength);t=i.slice(0)}break;case t.byteLength>4:{var i=new ArrayBuffer(4);var a=new Uint8Array(i);a.set(r.slice(0,4));t=i.slice(0)}break}var n=t.slice(0,2);var s=new Uint8Array(n);var o=s[0];s[0]=s[1];s[1]=o;var u=new Uint16Array(n);this.keyIndex=u[0];var l=t.slice(2);var c=new Uint8Array(l);o=c[0];c[0]=c[1];c[1]=o;var h=new Uint16Array(l);this.certificateIndex=h[0]};e.prototype.toSchema=function(){var e=new ArrayBuffer(2);var t=new Uint16Array(e);t[0]=this.certificateIndex;var r=new Uint8Array(e);var i=r[0];r[0]=r[1];r[1]=i;var a=new ArrayBuffer(2);var n=new Uint16Array(a);n[0]=this.keyIndex;var s=new Uint8Array(a);i=s[0];s[0]=s[1];s[1]=i;return new v({valueHex:c(a,e)})};e.prototype.toJSON=function(){return{certificateIndex:this.certificateIndex,keyIndex:this.keyIndex}};return e}();var It=function(){function e(t){if(t===void 0){t={}}this.id=r(t,"id",e.defaultValues("id"));if("type"in t){this.type=r(t,"type",e.defaultValues("type"))}if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"id":return"";case"type":return new b;default:throw new Error("Invalid member name for QCStatement class: "+e)}};e.compareWithDefault=function(e,t){switch(e){case"id":return t==="";case"type":return t instanceof b;default:throw new Error("Invalid member name for QCStatement class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new n({name:t.id||""}),new i({name:t.type||"",optional:true})]})};e.prototype.fromSchema=function(t){s(t,["id","type"]);var r=o(t,t,e.schema({names:{id:"id",type:"type"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for QCStatement");this.id=r.result.id.valueBlock.toString();if("type"in r.result)this.type=r.result.type};e.prototype.toSchema=function(){var e=[new n({value:this.id})];if("type"in this)e.push(this.type);return new a({value:e})};e.prototype.toJSON=function(){var e={id:this.id};if("type"in this)e.type=this.type.toJSON();return e};return e}();var Nt=function(){function e(t){if(t===void 0){t={}}this.values=r(t,"values",e.defaultValues("values"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"values":return[];default:throw new Error("Invalid member name for QCStatements class: "+e)}};e.compareWithDefault=function(e,t){switch(e){case"values":return t.length===0;default:throw new Error("Invalid member name for QCStatements class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new k({name:t.values||"",value:It.schema(t.value||{})})]})};e.prototype.fromSchema=function(t){s(t,["values"]);var r=o(t,t,e.schema({names:{values:"values"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for QCStatements");this.values=Array.from(r.result.values,(function(e){return new It({schema:e})}))};e.prototype.toSchema=function(){return new a({value:Array.from(this.values,(function(e){return e.toSchema()}))})};e.prototype.toJSON=function(){return{extensions:Array.from(this.values,(function(e){return e.toJSON()}))}};return e}();var Bt=function(){function e(t){if(t===void 0){t={}}this.extnID=r(t,"extnID",e.defaultValues("extnID"));this.critical=r(t,"critical",e.defaultValues("critical"));if("extnValue"in t)this.extnValue=new A({valueHex:t.extnValue});else this.extnValue=e.defaultValues("extnValue");if("parsedValue"in t)this.parsedValue=r(t,"parsedValue",e.defaultValues("parsedValue"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"extnID":return"";case"critical":return false;case"extnValue":return new A;case"parsedValue":return{};default:throw new Error("Invalid member name for Extension class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[new n({name:t.extnID||""}),new R({name:t.critical||"",optional:true}),new A({name:t.extnValue||""})]})};e.prototype.fromSchema=function(t){s(t,["extnID","critical","extnValue"]);var r=o(t,t,e.schema({names:{extnID:"extnID",critical:"critical",extnValue:"extnValue"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for Extension");this.extnID=r.result.extnID.valueBlock.toString();if("critical"in r.result)this.critical=r.result.critical.valueBlock.value;this.extnValue=r.result.extnValue;r=g(this.extnValue.valueBlock.valueHex);if(r.offset===-1)return;switch(this.extnID){case"2.5.29.9":try{this.parsedValue=new Ye({schema:r.result})}catch(i){this.parsedValue=new Ye;this.parsedValue.parsingError="Incorrectly formated SubjectDirectoryAttributes"}break;case"2.5.29.14":this.parsedValue=r.result;break;case"2.5.29.15":this.parsedValue=r.result;break;case"2.5.29.16":try{this.parsedValue=new Xe({schema:r.result})}catch(i){this.parsedValue=new Xe;this.parsedValue.parsingError="Incorrectly formated PrivateKeyUsagePeriod"}break;case"2.5.29.17":case"2.5.29.18":try{this.parsedValue=new rt({schema:r.result})}catch(i){this.parsedValue=new rt;this.parsedValue.parsingError="Incorrectly formated AltName"}break;case"2.5.29.19":try{this.parsedValue=new it({schema:r.result})}catch(i){this.parsedValue=new it;this.parsedValue.parsingError="Incorrectly formated BasicConstraints"}break;case"2.5.29.20":case"2.5.29.27":this.parsedValue=r.result;break;case"2.5.29.21":this.parsedValue=r.result;break;case"2.5.29.24":this.parsedValue=r.result;break;case"2.5.29.28":try{this.parsedValue=new at({schema:r.result})}catch(i){this.parsedValue=new at;this.parsedValue.parsingError="Incorrectly formated IssuingDistributionPoint"}break;case"2.5.29.29":try{this.parsedValue=new nt({schema:r.result})}catch(i){this.parsedValue=new nt;this.parsedValue.parsingError="Incorrectly formated GeneralNames"}break;case"2.5.29.30":try{this.parsedValue=new ot({schema:r.result})}catch(i){this.parsedValue=new ot;this.parsedValue.parsingError="Incorrectly formated NameConstraints"}break;case"2.5.29.31":case"2.5.29.46":try{this.parsedValue=new lt({schema:r.result})}catch(i){this.parsedValue=new lt;this.parsedValue.parsingError="Incorrectly formated CRLDistributionPoints"}break;case"2.5.29.32":case"1.3.6.1.4.1.311.21.10":try{this.parsedValue=new ft({schema:r.result})}catch(i){this.parsedValue=new ft;this.parsedValue.parsingError="Incorrectly formated CertificatePolicies"}break;case"2.5.29.33":try{this.parsedValue=new pt({schema:r.result})}catch(i){this.parsedValue=new pt;this.parsedValue.parsingError="Incorrectly formated CertificatePolicies"}break;case"2.5.29.35":try{this.parsedValue=new vt({schema:r.result})}catch(i){this.parsedValue=new vt;this.parsedValue.parsingError="Incorrectly formated AuthorityKeyIdentifier"}break;case"2.5.29.36":try{this.parsedValue=new dt({schema:r.result})}catch(i){this.parsedValue=new dt;this.parsedValue.parsingError="Incorrectly formated PolicyConstraints"}break;case"2.5.29.37":try{this.parsedValue=new yt({schema:r.result})}catch(i){this.parsedValue=new yt;this.parsedValue.parsingError="Incorrectly formated ExtKeyUsage"}break;case"2.5.29.54":this.parsedValue=r.result;break;case"1.3.6.1.5.5.7.1.1":case"1.3.6.1.5.5.7.1.11":try{this.parsedValue=new bt({schema:r.result})}catch(i){this.parsedValue=new bt;this.parsedValue.parsingError="Incorrectly formated InfoAccess"}break;case"1.3.6.1.4.1.11129.2.4.2":try{this.parsedValue=new St({schema:r.result})}catch(i){this.parsedValue=new St;this.parsedValue.parsingError="Incorrectly formated SignedCertificateTimestampList"}break;case"1.3.6.1.4.1.311.20.2":this.parsedValue=r.result;break;case"1.3.6.1.4.1.311.21.2":this.parsedValue=r.result;break;case"1.3.6.1.4.1.311.21.7":try{this.parsedValue=new Ct({schema:r.result})}catch(i){this.parsedValue=new Ct;this.parsedValue.parsingError="Incorrectly formated CertificateTemplate"}break;case"1.3.6.1.4.1.311.21.1":try{this.parsedValue=new Pt({schema:r.result})}catch(i){this.parsedValue=new Pt;this.parsedValue.parsingError="Incorrectly formated CAVersion"}break;case"1.3.6.1.5.5.7.1.3":try{this.parsedValue=new Nt({schema:r.result})}catch(i){this.parsedValue=new Nt;this.parsedValue.parsingError="Incorrectly formated QCStatements"}break}};e.prototype.toSchema=function(){var t=[];t.push(new n({value:this.extnID}));if(this.critical!==e.defaultValues("critical"))t.push(new R({value:this.critical}));t.push(this.extnValue);return new a({value:t})};e.prototype.toJSON=function(){var t={extnID:this.extnID,extnValue:this.extnValue.toJSON()};if(this.critical!==e.defaultValues("critical"))t.critical=this.critical;if("parsedValue"in this){if("toJSON"in this.parsedValue)t.parsedValue=this.parsedValue.toJSON()}return t};return e}();var xt=function(){function e(t){if(t===void 0){t={}}this.extensions=r(t,"extensions",e.defaultValues("extensions"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"extensions":return[];default:throw new Error("Invalid member name for Extensions class: "+e)}};e.schema=function(e,t){if(e===void 0){e={}}if(t===void 0){t=false}var i=r(e,"names",{});return new a({optional:t,name:i.blockName||"",value:[new k({name:i.extensions||"",value:Bt.schema(i.extension||{})})]})};e.prototype.fromSchema=function(t){s(t,["extensions"]);var r=o(t,t,e.schema({names:{extensions:"extensions"}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for Extensions");this.extensions=Array.from(r.result.extensions,(function(e){return new Bt({schema:e})}))};e.prototype.toSchema=function(){return new a({value:Array.from(this.extensions,(function(e){return e.toSchema()}))})};e.prototype.toJSON=function(){return{extensions:Array.from(this.extensions,(function(e){return e.toJSON()}))}};return e}();function Et(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"tbsCertificate",value:[new S({optional:true,idBlock:{tagClass:3,tagNumber:0},value:[new v({name:t.tbsCertificateVersion||"tbsCertificate.version"})]}),new v({name:t.tbsCertificateSerialNumber||"tbsCertificate.serialNumber"}),Pe.schema(t.signature||{names:{blockName:"tbsCertificate.signature"}}),Ge.schema(t.issuer||{names:{blockName:"tbsCertificate.issuer"}}),new a({name:t.tbsCertificateValidity||"tbsCertificate.validity",value:[ze.schema(t.notBefore||{names:{utcTimeName:"tbsCertificate.notBefore",generalTimeName:"tbsCertificate.notBefore"}}),ze.schema(t.notAfter||{names:{utcTimeName:"tbsCertificate.notAfter",generalTimeName:"tbsCertificate.notAfter"}})]}),Ge.schema(t.subject||{names:{blockName:"tbsCertificate.subject"}}),Be.schema(t.subjectPublicKeyInfo||{names:{blockName:"tbsCertificate.subjectPublicKeyInfo"}}),new P({name:t.tbsCertificateIssuerUniqueID||"tbsCertificate.issuerUniqueID",optional:true,idBlock:{tagClass:3,tagNumber:1}}),new P({name:t.tbsCertificateSubjectUniqueID||"tbsCertificate.subjectUniqueID",optional:true,idBlock:{tagClass:3,tagNumber:2}}),new S({optional:true,idBlock:{tagClass:3,tagNumber:3},value:[xt.schema(t.extensions||{names:{blockName:"tbsCertificate.extensions"}})]})]})}var Vt=function(){function e(t){if(t===void 0){t={}}this.tbs=r(t,"tbs",e.defaultValues("tbs"));this.version=r(t,"version",e.defaultValues("version"));this.serialNumber=r(t,"serialNumber",e.defaultValues("serialNumber"));this.signature=r(t,"signature",e.defaultValues("signature"));this.issuer=r(t,"issuer",e.defaultValues("issuer"));this.notBefore=r(t,"notBefore",e.defaultValues("notBefore"));this.notAfter=r(t,"notAfter",e.defaultValues("notAfter"));this.subject=r(t,"subject",e.defaultValues("subject"));this.subjectPublicKeyInfo=r(t,"subjectPublicKeyInfo",e.defaultValues("subjectPublicKeyInfo"));if("issuerUniqueID"in t)this.issuerUniqueID=r(t,"issuerUniqueID",e.defaultValues("issuerUniqueID"));if("subjectUniqueID"in t)this.subjectUniqueID=r(t,"subjectUniqueID",e.defaultValues("subjectUniqueID"));if("extensions"in t)this.extensions=r(t,"extensions",e.defaultValues("extensions"));this.signatureAlgorithm=r(t,"signatureAlgorithm",e.defaultValues("signatureAlgorithm"));this.signatureValue=r(t,"signatureValue",e.defaultValues("signatureValue"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"tbs":return new ArrayBuffer(0);case"version":return 0;case"serialNumber":return new v;case"signature":return new Pe;case"issuer":return new Ge;case"notBefore":return new ze;case"notAfter":return new ze;case"subject":return new Ge;case"subjectPublicKeyInfo":return new Be;case"issuerUniqueID":return new ArrayBuffer(0);case"subjectUniqueID":return new ArrayBuffer(0);case"extensions":return[];case"signatureAlgorithm":return new Pe;case"signatureValue":return new y;default:throw new Error("Invalid member name for Certificate class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.blockName||"",value:[Et(t.tbsCertificate),Pe.schema(t.signatureAlgorithm||{names:{blockName:"signatureAlgorithm"}}),new y({name:t.signatureValue||"signatureValue"})]})};e.prototype.fromSchema=function(t){s(t,["tbsCertificate","tbsCertificate.extensions","tbsCertificate.version","tbsCertificate.serialNumber","tbsCertificate.signature","tbsCertificate.issuer","tbsCertificate.notBefore","tbsCertificate.notAfter","tbsCertificate.subject","tbsCertificate.subjectPublicKeyInfo","tbsCertificate.issuerUniqueID","tbsCertificate.subjectUniqueID","signatureAlgorithm","signatureValue"]);var r=o(t,t,e.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:"tbsCertificate.extensions"}}}}}}));if(r.verified===false)throw new Error("Object's schema was not verified against input data for Certificate");this.tbs=r.result.tbsCertificate.valueBeforeDecode;if("tbsCertificate.version"in r.result)this.version=r.result["tbsCertificate.version"].valueBlock.valueDec;this.serialNumber=r.result["tbsCertificate.serialNumber"];this.signature=new Pe({schema:r.result["tbsCertificate.signature"]});this.issuer=new Ge({schema:r.result["tbsCertificate.issuer"]});this.notBefore=new ze({schema:r.result["tbsCertificate.notBefore"]});this.notAfter=new ze({schema:r.result["tbsCertificate.notAfter"]});this.subject=new Ge({schema:r.result["tbsCertificate.subject"]});this.subjectPublicKeyInfo=new Be({schema:r.result["tbsCertificate.subjectPublicKeyInfo"]});if("tbsCertificate.issuerUniqueID"in r.result)this.issuerUniqueID=r.result["tbsCertificate.issuerUniqueID"].valueBlock.valueHex;if("tbsCertificate.subjectUniqueID"in r.result)this.subjectUniqueID=r.result["tbsCertificate.subjectUniqueID"].valueBlock.valueHex;if("tbsCertificate.extensions"in r.result)this.extensions=Array.from(r.result["tbsCertificate.extensions"],(function(e){return new Bt({schema:e})}));this.signatureAlgorithm=new Pe({schema:r.result.signatureAlgorithm});this.signatureValue=r.result.signatureValue};e.prototype.encodeTBS=function(){var t=[];if("version"in this&&this.version!==e.defaultValues("version")){t.push(new S({optional:true,idBlock:{tagClass:3,tagNumber:0},value:[new v({value:this.version})]}))}t.push(this.serialNumber);t.push(this.signature.toSchema());t.push(this.issuer.toSchema());t.push(new a({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]}));t.push(this.subject.toSchema());t.push(this.subjectPublicKeyInfo.toSchema());if("issuerUniqueID"in this){t.push(new P({optional:true,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID}))}if("subjectUniqueID"in this){t.push(new P({optional:true,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID}))}if("extensions"in this){t.push(new S({optional:true,idBlock:{tagClass:3,tagNumber:3},value:[new a({value:Array.from(this.extensions,(function(e){return e.toSchema()}))})]}))}return new a({value:t})};e.prototype.toSchema=function(t){if(t===void 0){t=false}var r={};if(t===false){if(this.tbs.length===0)return e.schema().value[0];r=g(this.tbs).result}else r=this.encodeTBS();return new a({value:[r,this.signatureAlgorithm.toSchema(),this.signatureValue]})};e.prototype.toJSON=function(){var t={tbs:q(this.tbs,0,this.tbs.byteLength),serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};if("version"in this&&this.version!==e.defaultValues("version"))t.version=this.version;if("issuerUniqueID"in this)t.issuerUniqueID=q(this.issuerUniqueID,0,this.issuerUniqueID.byteLength);if("subjectUniqueID"in this)t.subjectUniqueID=q(this.subjectUniqueID,0,this.subjectUniqueID.byteLength);if("extensions"in this)t.extensions=Array.from(this.extensions,(function(e){return e.toJSON()}));return t};e.prototype.getPublicKey=function(e){if(e===void 0){e=null}return Me().subtle.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)};e.prototype.getKeyHash=function(e){if(e===void 0){e="SHA-1"}var t=qe();if(typeof t==="undefined")return Promise.reject("Unable to create WebCrypto object");return t.digest({name:e},new Uint8Array(this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHex))};e.prototype.sign=function(e,t){var r=this;if(t===void 0){t="SHA-1"}if(typeof e==="undefined")return Promise.reject("Need to provide a private key for signing");var i=Promise.resolve();var a;var n=Me();i=i.then((function(){return n.subtle.getSignatureParameters(e,t)}));i=i.then((function(e){a=e.parameters;r.signature=e.signatureAlgorithm;r.signatureAlgorithm=e.signatureAlgorithm}));i=i.then((function(){r.tbs=r.encodeTBS().toBER(false)}));i=i.then((function(){return n.subtle.signWithPrivateKey(r.tbs,e,a)}));i=i.then((function(e){r.signatureValue=new y({valueHex:e})}));return i};e.prototype.verify=function(e){if(e===void 0){e=null}var t={};if(e!==null)t=e.subjectPublicKeyInfo;else{if(this.issuer.isEqual(this.subject))t=this.subjectPublicKeyInfo}if(t instanceof Be===false)return Promise.reject("Please provide issuer certificate as a parameter");return Me().subtle.verifyWithPublicKey(this.tbs,this.signatureValue,t,this.signatureAlgorithm)};return e}();function _t(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({name:t.CertificationRequestInfo||"CertificationRequestInfo",value:[new v({name:t.CertificationRequestInfoVersion||"CertificationRequestInfo.version"}),Ge.schema(t.subject||{names:{blockName:"CertificationRequestInfo.subject"}}),Be.schema({names:{blockName:"CertificationRequestInfo.subjectPublicKeyInfo"}}),new S({optional:true,idBlock:{tagClass:3,tagNumber:0},value:[new k({optional:true,name:t.CertificationRequestInfoAttributes||"CertificationRequestInfo.attributes",value:xe.schema(t.attributes||{})})]})]})}var Lt=function(){function e(t){if(t===void 0){t={}}this.tbs=r(t,"tbs",e.defaultValues("tbs"));this.version=r(t,"version",e.defaultValues("version"));this.subject=r(t,"subject",e.defaultValues("subject"));this.subjectPublicKeyInfo=r(t,"subjectPublicKeyInfo",e.defaultValues("subjectPublicKeyInfo"));if("attributes"in t)this.attributes=r(t,"attributes",e.defaultValues("attributes"));this.signatureAlgorithm=r(t,"signatureAlgorithm",e.defaultValues("signatureAlgorithm"));this.signatureValue=r(t,"signatureValue",e.defaultValues("signatureValue"));if("schema"in t)this.fromSchema(t.schema)}e.defaultValues=function(e){switch(e){case"tbs":return new ArrayBuffer(0);case"version":return 0;case"subject":return new Ge;case"subjectPublicKeyInfo":return new Be;case"attributes":return[];case"signatureAlgorithm":return new Pe;case"signatureValue":return new y;default:throw new Error("Invalid member name for CertificationRequest class: "+e)}};e.schema=function(e){if(e===void 0){e={}}var t=r(e,"names",{});return new a({value:[_t(t.certificationRequestInfo||{}),new a({name:t.signatureAlgorithm||"signatureAlgorithm",value:[new n,new i({optional:true})]}),new y({name:t.signatureValue||"signatureValue"})]})};e.prototype.fromSchema=function(t){s(t,["CertificationRequestInfo","CertificationRequestInfo.version","CertificationRequestInfo.subject","CertificationRequestInfo.subjectPublicKeyInfo","CertificationRequestInfo.attributes","signatureAlgorithm","signatureValue"]);var r=o(t,t,e.schema());if(r.verified===false)throw new Error("Object's schema was not verified against input data for CertificationRequest");this.tbs=r.result.CertificationRequestInfo.valueBeforeDecode;this.version=r.result["CertificationRequestInfo.version"].valueBlock.valueDec;this.subject=new Ge({schema:r.result["CertificationRequestInfo.subject"]});this.subjectPublicKeyInfo=new Be({schema:r.result["CertificationRequestInfo.subjectPublicKeyInfo"]});if("CertificationRequestInfo.attributes"in r.result)this.attributes=Array.from(r.result["CertificationRequestInfo.attributes"],(function(e){return new xe({schema:e})}));this.signatureAlgorithm=new Pe({schema:r.result.signatureAlgorithm});this.signatureValue=r.result.signatureValue};e.prototype.encodeTBS=function(){var e=[new v({value:this.version}),this.subject.toSchema(),this.subjectPublicKeyInfo.toSchema()];if("attributes"in this){e.push(new S({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,(function(e){return e.toSchema()}))}))}return new a({value:e})};e.prototype.toSchema=function(t){if(t===void 0){t=false}var r;if(t===false){if(this.tbs.byteLength===0)return e.schema();r=g(this.tbs).result}else r=this.encodeTBS();return new a({value:[r,this.signatureAlgorithm.toSchema(),this.signatureValue]})};e.prototype.toJSON=function(){var e={tbs:q(this.tbs,0,this.tbs.byteLength),version:this.version,subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};if("attributes"in this)e.attributes=Array.from(this.attributes,(function(e){return e.toJSON()}));return e};e.prototype.sign=function(e,t){var r=this;if(t===void 0){t="SHA-1"}if(typeof e==="undefined")return Promise.reject("Need to provide a private key for signing");var i=Promise.resolve();var a;var n=Me();i=i.then((function(){return n.subtle.getSignatureParameters(e,t)}));i=i.then((function(e){a=e.parameters;r.signatureAlgorithm=e.signatureAlgorithm}));i=i.then((function(){r.tbs=r.encodeTBS().toBER(false)}));i=i.then((function(){return n.subtle.signWithPrivateKey(r.tbs,e,a)}));i=i.then((function(e){r.signatureValue=new y({valueHex:e})}));return i};e.prototype.verify=function(){return Me().subtle.verifyWithPublicKey(this.tbs,this.signatureValue,this.subjectPublicKeyInfo,this.signatureAlgorithm)};e.prototype.getPublicKey=function(e){if(e===void 0){e=null}return Me().getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)};return e}();
/**
             * @license
             * Copyright (c) Peculiar Ventures, LLC.
             *
             * This source code is licensed under the BSD 3-Clause license found in the
             * LICENSE file in the root directory of this source tree.
             */var jt;(function(e){e["CommonName"]="CN";e["Country"]="C";e["Region"]="L";e["State"]="ST";e["Organization"]="O";e["OrganizationUnit"]="OU"})(jt||(jt=e("b",{})));var Dt=(te={},te[jt.CommonName]="2.5.4.3",te[jt.Country]="2.5.4.6",te[jt.Region]="2.5.4.7",te[jt.State]="2.5.4.8",te[jt.Organization]="2.5.4.10",te[jt.OrganizationUnit]="2.5.4.11",te);var Kt=function(){function e(){}e.csr=function(t,r,i){return __awaiter(this,void 0,void 0,(function(){var a,n,s,o,u;return __generator(this,(function(l){switch(l.label){case 0:a=new Lt;Je("Crypto",t,new He({name:"Crypto",crypto:t,subtle:t.subtle}));return[4,t.subtle.generateKey(r,false,e.keyUsages)];case 1:n=l.sent(),s=n.publicKey,o=n.privateKey;a.version=0;Object.keys(i).forEach((function(e){var t=i[e];if(t&&Dt[e]){a.subject.typesAndValues.push(new Qe({type:Dt[e],value:new E({value:t})}))}}));a.attributes=[];return[4,a.subjectPublicKeyInfo.importKey(s)];case 2:l.sent();return[4,a.sign(o,"SHA-256")];case 3:l.sent();if(!a.signatureAlgorithm.algorithmParams){a.signatureAlgorithm.algorithmParams=new b}u=a.toSchema().toBER(false);return[2,{der:u,privateKey:o,publicKey:s}]}}))}))};e.x509=function(t,r,i,a){return __awaiter(this,void 0,void 0,(function(){var n,s,o,u,l,c,h,f,m,p,d;return __generator(this,(function(g){switch(g.label){case 0:n=new Vt;Je("Crypto",t,new He({name:"Crypto",crypto:t,subtle:t.subtle}));return[4,t.subtle.generateKey(r,false,e.keyUsages)];case 1:s=g.sent(),o=s.publicKey,u=s.privateKey;n.version=2;n.serialNumber=new v({value:1});Object.keys(i).forEach((function(e){var t=i[e];if(t&&Dt[e]){n.subject.typesAndValues.push(new Qe({type:Dt[e],value:new E({value:t})}))}}));Object.keys(a).forEach((function(e){var t=a[e];if(t&&Dt[e]){n.issuer.typesAndValues.push(new Qe({type:Dt[e],value:new E({value:t})}))}}));l=new Date;n.notBefore.value=new Date(l.getFullYear(),l.getMonth(),l.getDate());n.notAfter.value=new Date(l.getFullYear()+1,l.getMonth(),l.getDate());n.extensions=[];c=new it({cA:true,pathLenConstraint:3});n.extensions.push(new Bt({extnID:"2.5.29.19",critical:true,extnValue:c.toSchema().toBER(false),parsedValue:c}));h=new ArrayBuffer(1);f=new Uint8Array(h);f[0]|=2;f[0]|=4;f[0]|=128;m=new y({valueHex:h});n.extensions.push(new Bt({extnID:"2.5.29.15",critical:false,extnValue:m.toBER(false),parsedValue:m}));p=new yt({keyPurposes:["2.5.29.37.0","1.3.6.1.5.5.7.3.1","1.3.6.1.5.5.7.3.2","1.3.6.1.5.5.7.3.3","1.3.6.1.5.5.7.3.4","1.3.6.1.5.5.7.3.8","1.3.6.1.5.5.7.3.9","1.3.6.1.4.1.311.10.3.1","1.3.6.1.4.1.311.10.3.4"]});n.extensions.push(new Bt({extnID:"2.5.29.37",critical:false,extnValue:p.toSchema().toBER(false),parsedValue:p}));return[4,n.subjectPublicKeyInfo.importKey(o)];case 2:g.sent();return[4,n.sign(u,"SHA-256")];case 3:g.sent();d=n.toSchema(true).toBER(false);return[2,{der:d,privateKey:u,publicKey:o}]}}))}))};return e}();Kt.keyUsages=["sign","verify"];
/**
             * @license
             * Copyright (c) Peculiar Ventures, LLC.
             *
             * This source code is licensed under the BSD 3-Clause license found in the
             * LICENSE file in the root directory of this source tree.
             */var Ot=function(){function e(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(e.length===1){this.asn=e[0];this.rawData=T.serialize(this.asn)}else{this.asn=T.parse(e[0],e[1]);this.rawData=ee.BufferSourceConverter.toArrayBuffer(e[0])}}return e}();
/**
             * @license
             * Copyright (c) Peculiar Ventures, LLC.
             *
             * This source code is licensed under the BSD 3-Clause license found in the
             * LICENSE file in the root directory of this source tree.
             */var Ut=function(e){__extends(t,e);function t(t){var r=e.call(this,t,F)||this;var i=r.getAsnExtnValue();switch(r.asn.extnID){case X:r.value=Q.parse(i,$);break;case z:r.value=Q.parse(i,Y);break;case W:r.value=Q.parse(i,G);break;default:r.value=i}return r}t.prototype.getAsnExtnValue=function(){return this.asn.extnValue.buffer};return t}(Ot);
/**
             * @license
             * Copyright (c) Peculiar Ventures, LLC.
             *
             * This source code is licensed under the BSD 3-Clause license found in the
             * LICENSE file in the root directory of this source tree.
             */var Ht="0.4.0.1862.1.1";var Rt="0.4.0.1862.1.4";var Jt="0.4.0.1862.1.6.2";var Mt="0.4.0.1456.1.1";var qt="0.4.0.194112.1.1";var Tt="0.4.0.194112.1.2";var Ft="0.4.0.194112.1.3";var Wt=function(e){__extends(t,e);function t(t){var r=e.call(this,t,Z)||this;r.extensions=[];r.parseExtensions();return r}t.prototype.parseExtensions=function(){var e=this.asn.tbsCertificate;if(e.extensions){this.extensions=e.extensions.map((function(e){return new Ut(T.serialize(e))}))}};t.prototype.getExtensionByOid=function(e){if(!this.extensions.length){return undefined}for(var t=0;t<this.extensions.length;t+=1){var r=this.extensions[t];if(r&&r.asn.extnID===e){return r}}return undefined};t.prototype.hasKeyUsage=function(e){if(!e||!e.length){return false}var t=this.getExtensionByOid(X);if(!t){return false}var r=t.value.toJSON();if(!r.length){return false}var i=__spreadArrays(e);for(var a=0;a<r.length;a+=1){if(i.length){var n=i.indexOf(r[a]);if(n!==-1){i.splice(n,1)}}else{break}}if(!i.length){return true}return false};t.prototype.isQualified=function(e){if(e===void 0){e=[]}var t=this.getExtensionByOid(z);if(!t){return false}var r=this.getExtensionByOid(W);if(!r){return false}var i=t.value.map((function(e){return e.policyIdentifier}));var a=r.value.map((function(e){return e.statementId}));var n=a.includes(Ht);var s=i.includes(Mt)||i.includes(Ft)||i.includes(Tt)||a.includes(Rt);var o=i.includes(qt)||a.includes(Jt);if(e.length){e.forEach((function(e){if(a.includes(e)){s=true}}))}if(!(n&&s||o)){return false}return true};return t}(Ot);
/**
             * @license
             * Copyright (c) Peculiar Ventures, LLC.
             *
             * This source code is licensed under the BSD 3-Clause license found in the
             * LICENSE file in the root directory of this source tree.
             */var Qt=undefined&&undefined.__classPrivateFieldGet||function(e,t){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return t.get(e)};var Gt=undefined&&undefined.__classPrivateFieldSet||function(e,t,r){if(!t.has(e)){throw new TypeError("attempted to set private field on non-instance")}t.set(e,r);return r};var zt,Yt,Xt;var $t;(function(e){e["RSASSA_PKCS1_V1_5"]="RSASSA-PKCS1-V1_5";e["ECDSA"]="ECDSA"})($t||($t=e("E",{})));var Zt;(function(e){e["SHA_256"]="SHA-256";e["SHA_384"]="SHA-384";e["SHA_512"]="SHA-512"})(Zt||(Zt=e("a",{})));var er=function(){function e(e){this.FORTIFY_URL="127.0.0.1:31337";this.CONNECTION_CHECK_TIME=1e4;this.options={onClose:function(){},onProvidersAdded:function(){},onProvidersRemoved:function(){},filters:{}};zt.set(this,void 0);Yt.set(this,Ce(window.navigator));Xt.set(this,void 0);Object.assign(this.options,e)}e.prototype.isConnectionSupported=function(){return!Qt(this,Yt).phone};e.prototype.isConnectionDetected=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;return __generator(this,(function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,fetch("https://"+this.FORTIFY_URL+"/.well-known/webcrypto-socket")];case 1:e=r.sent();return[2,e.ok];case 2:t=r.sent();return[2,false];case 3:return[2]}}))}))};e.prototype.isConnectionDetectedAuto=function(){return __awaiter(this,void 0,void 0,(function(){var e=this;return __generator(this,(function(t){return[2,new Promise((function(t){var r=function(){return __awaiter(e,void 0,void 0,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.isConnectionDetected()];case 1:e=i.sent();if(e){t()}else{Gt(this,Xt,window.setTimeout(r,this.CONNECTION_CHECK_TIME))}return[2]}}))}))};r()}))]}))}))};e.prototype.start=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!this.isConnectionSupported()){throw new Error("connection_not_supported")}return[4,this.isConnectionDetected()];case 1:if(!e.sent()){throw new Error("connection_not_detected")}return[4,this.connect()];case 2:e.sent();return[2]}}))}))};e.prototype.finish=function(){if(this.server){this.server.client.close();this.server=null}if(Qt(this,Xt)){clearTimeout(Qt(this,Xt));Gt(this,Xt,null)}};e.prototype.challenge=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.server.isLoggedIn()];case 1:e=t.sent();if(!e){return[2,this.server.challenge()]}return[2,undefined]}}))}))};e.prototype.login=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:t.trys.push([0,2,,3]);return[4,this.server.login()];case 1:t.sent();return[3,3];case 2:e=t.sent();throw new Error("connection_key_not_approved");case 3:return[2]}}))}))};e.prototype.connect=function(){return __awaiter(this,void 0,void 0,(function(){var e,t,r;var i=this;return __generator(this,(function(a){switch(a.label){case 0:return[4,se()];case 1:a.sent();if(!!Qt(this,zt))return[3,5];a.label=2;case 2:a.trys.push([2,4,,5]);e=Gt;t=[this,zt];return[4,WebcryptoSocket.BrowserStorage.create()];case 3:e.apply(void 0,t.concat([a.sent()]));return[3,5];case 4:r=a.sent();Gt(this,zt,new WebcryptoSocket.MemoryStorage);return[3,5];case 5:return[2,new Promise((function(e,t){if(i.server){e()}i.server=new WebcryptoSocket.SocketProvider({storage:Qt(i,zt)}).connect(i.FORTIFY_URL).on("error",(function(e){t(e)})).on("listening",(function(){return __awaiter(i,void 0,void 0,(function(){return __generator(this,(function(t){e();return[2]}))}))})).on("token",(function(e){return __awaiter(i,void 0,void 0,(function(){var t;var r=this;return __generator(this,(function(i){if(e.added.length){t=e.added.filter((function(e){return r.providerFilter(e)}));this.options.onProvidersAdded(t)}if(e.removed.length){this.options.onProvidersRemoved(e.removed)}return[2]}))}))})).on("disconnect",(function(){console.log("disconnect")})).on("close",(function(){i.options.onClose()}))}))]}}))}))};e.prototype.providerFilter=function(e){var t=this.options.filters;if(t.onlySmartcards&&!e.isRemovable){return false}if(t.providerNameMatch){if(typeof t.providerNameMatch==="string"&&!new RegExp(t.providerNameMatch,"i").test(e.name)){return false}if(t.providerNameMatch instanceof RegExp&&!t.providerNameMatch.test(e.name)){return false}}return true};e.prototype.getProviders=function(){return __awaiter(this,void 0,void 0,(function(){var e;var t=this;return __generator(this,(function(r){switch(r.label){case 0:return[4,this.server.info()];case 1:e=r.sent();return[2,e.providers.filter((function(e){return t.providerFilter(e)}))]}}))}))};e.prototype.getProviderById=function(e,t){return __awaiter(this,void 0,void 0,(function(){var r,i;return __generator(this,(function(a){switch(a.label){case 0:return[4,this.server.getCrypto(e)];case 1:r=a.sent();if(!t)return[3,4];return[4,r.isLoggedIn()];case 2:i=a.sent();if(!!i)return[3,4];return[4,r.login()];case 3:a.sent();a.label=4;case 4:return[2,r]}}))}))};e.prototype.getCertificatesByProviders=function(e){return __awaiter(this,void 0,void 0,(function(){var t,r,i,a,n;return __generator(this,(function(s){switch(s.label){case 0:t=[];r=0,i=e;s.label=1;case 1:if(!(r<i.length))return[3,4];a=i[r];return[4,this.getCertificatesByProviderId(a.id)];case 2:n=s.sent();t.push.apply(t,n);s.label=3;case 3:r++;return[3,1];case 4:return[2,t]}}))}))};e.prototype.certificatePreFilter=function(e){var t=this.options.filters;if(e.split("-")[0]!=="x509"){return false}if(t.certificateIdMatch){var r=void 0;if(typeof t.certificateIdMatch==="string"){r=new RegExp(t.certificateIdMatch,"i")}else if(t.certificateIdMatch instanceof RegExp){r=t.certificateIdMatch}if(r&&!r.test(e)){return false}}return true};e.prototype.certificateFilter=function(e,t){return __awaiter(this,void 0,void 0,(function(){var r,i,i,a,n,s,o;return __generator(this,(function(u){switch(u.label){case 0:r=this.options.filters;if(!r.expired&&e.notAfter.getTime()<Date.now()){return[2,false]}if(r.subjectDNMatch){i=void 0;if(typeof r.subjectDNMatch==="string"){i=new RegExp(r.subjectDNMatch,"i")}else if(r.subjectDNMatch instanceof RegExp){i=r.subjectDNMatch}if(i&&!i.test(e.subjectName)){return[2,false]}}if(r.issuerDNMatch){i=void 0;if(typeof r.issuerDNMatch==="string"){i=new RegExp(r.issuerDNMatch,"i")}else if(r.issuerDNMatch instanceof RegExp){i=r.issuerDNMatch}if(i&&!i.test(e.issuerName)){return[2,false]}}if(!(r.keyUsage&&r.keyUsage.length||r.onlyQualified))return[3,2];return[4,t.certStorage.exportCert("raw",e)];case 1:a=u.sent();n=new Wt(a);if(r.onlyQualified){s=n.isQualified(r.qualifiedCertificateStatements);if(!s){return[2,false]}}if(r.keyUsage&&r.keyUsage.length){o=n.hasKeyUsage(r.keyUsage);if(!o){return[2,false]}}u.label=2;case 2:return[2,true]}}))}))};e.prototype.getCertificateByIndex=function(t,r,i){return __awaiter(this,void 0,void 0,(function(){var a,n,s;return __generator(this,(function(o){switch(o.label){case 0:o.trys.push([0,2,,3]);return[4,r.certStorage.getItem(t)];case 1:a=o.sent();return[3,3];case 2:n=o.sent();console.warn("Can't read certificate: "+t);return[2,undefined];case 3:return[4,this.certificateFilter(a,r)];case 4:s=o.sent();if(!s){return[2,undefined]}a.index=t;a.subject=e.getDNValue(a.subjectName);a.issuer=e.getDNValue(a.issuerName);a.privateKeyId=i;return[2,a]}}))}))};e.prototype.getCertificatesByProviderId=function(t){return __awaiter(this,void 0,void 0,(function(){var r,i,a,n,s,o,u,l,c,h,f,m;return __generator(this,(function(p){switch(p.label){case 0:r=this.options.filters;p.label=1;case 1:p.trys.push([1,3,,4]);return[4,this.getProviderById(t,r.onlyWithPrivateKey)];case 2:i=p.sent();return[3,4];case 3:a=p.sent();return[2,[]];case 4:n=[];return[4,i.keyStorage.keys()];case 5:s=p.sent();return[4,i.certStorage.keys()];case 6:o=p.sent();for(u=0,l=o;u<l.length;u++){c=l[u];h=this.certificatePreFilter(c);if(!h){continue}f=e.getCertificatePrivateKeyByIndex(c,s);if(r.onlyWithPrivateKey&&!f){continue}n.push(this.getCertificateByIndex(c,i,f))}return[4,Promise.all(n)];case 7:m=p.sent();return[2,m.filter((function(e){return!!e}))]}}))}))};e.prototype.getCertificateBodyById=function(e,t){return __awaiter(this,void 0,void 0,(function(){var r,i,a,n;return __generator(this,(function(s){switch(s.label){case 0:r=this.options.filters;return[4,this.getProviderById(e,r.onlyWithPrivateKey)];case 1:i=s.sent();return[4,i.certStorage.getItem(t)];case 2:a=s.sent();return[4,i.certStorage.exportCert("raw",a)];case 3:n=s.sent();return[2,ee.Convert.ToBase64(n)]}}))}))};e.getCertificatePrivateKeyByIndex=function(e,t){var r=t.filter((function(t){var r=t.split("-");return r[0]==="private"&&r[2]===e.split("-")[2]}))[0];if(!r){return undefined}return r};e.getDNValue=function(e){var t={};var r=e.split(/, /g);r.forEach((function(e){var r=e.split("="),i=r[0],a=r[1];t[i]=a}));return t};e.prototype.createX509=function(e,t){return __awaiter(this,void 0,void 0,(function(){var r,i,a,n;return __generator(this,(function(s){switch(s.label){case 0:return[4,this.getProviderById(e,true)];case 1:r=s.sent();r.exportKey=r.subtle.exportKey.bind(r.subtle);r.sign=r.subtle.sign.bind(r.subtle);r.digest=r.subtle.digest.bind(r.subtle);switch(t.publicKey.signatureAlgorithm){case $t.RSASSA_PKCS1_V1_5:i={hash:t.publicKey.hashAlgorithm,name:t.publicKey.signatureAlgorithm,publicExponent:new Uint8Array([1,0,1]),modulusLength:2048};break;case $t.ECDSA:i={hash:t.publicKey.hashAlgorithm,name:t.publicKey.signatureAlgorithm,namedCurve:"P-256"};break;default:console.error("Unsupported signature algorithm name:",t.publicKey.signatureAlgorithm)}return[4,Kt.x509(r,i,t.subject,t.subject)];case 2:a=s.sent();return[4,r.certStorage.importCert("raw",a.der,i,Kt.keyUsages)];case 3:n=s.sent();return[4,r.keyStorage.setItem(a.privateKey)];case 4:s.sent();return[4,r.keyStorage.setItem(a.publicKey)];case 5:s.sent();return[4,r.certStorage.setItem(n)];case 6:s.sent();return[2,a]}}))}))};e.prototype.createCSR=function(e,t){return __awaiter(this,void 0,void 0,(function(){var r,i,a,n;return __generator(this,(function(s){switch(s.label){case 0:return[4,this.getProviderById(e,true)];case 1:r=s.sent();r.exportKey=r.subtle.exportKey.bind(r.subtle);r.sign=r.subtle.sign.bind(r.subtle);r.digest=r.subtle.digest.bind(r.subtle);switch(t.publicKey.signatureAlgorithm){case $t.RSASSA_PKCS1_V1_5:i={hash:t.publicKey.hashAlgorithm,name:t.publicKey.signatureAlgorithm,publicExponent:new Uint8Array([1,0,1]),modulusLength:2048};break;case $t.ECDSA:i={hash:t.publicKey.hashAlgorithm,name:t.publicKey.signatureAlgorithm,namedCurve:"P-256"};break;default:console.error("Unsupported signature algorithm name:",t.publicKey.signatureAlgorithm)}return[4,Kt.csr(r,i,t.subject)];case 2:a=s.sent();return[4,r.certStorage.importCert("raw",a.der,i,Kt.keyUsages)];case 3:n=s.sent();return[4,r.keyStorage.setItem(a.privateKey)];case 4:s.sent();return[4,r.keyStorage.setItem(a.publicKey)];case 5:s.sent();return[4,r.certStorage.setItem(n)];case 6:s.sent();return[2,a]}}))}))};return e}();e("F",er);zt=new WeakMap,Yt=new WeakMap,Xt=new WeakMap}}}));