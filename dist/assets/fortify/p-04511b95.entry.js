import{r as t,c as e,h as i,H as r}from"./p-ccfcf823.js";import"./p-7005d10f.js";import"./p-e1655586.js";import{F as s}from"./p-04ae9136.js";import{l as n}from"./p-be826c49.js";
/**
 * @license
 * Copyright (c) Peculiar Ventures, LLC.
 *
 * This source code is licensed under the BSD 3-Clause license found in the
 * LICENSE file in the root directory of this source tree.
 */
var o,h=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};const a=class{constructor(i){t(this,i),this.cancel=e(this,"cancel",7),this.close=e(this,"close",7),o.set(this,void 0),this.providers=[],this.isFetching={connectionDetect:"pending"},this.onClickCancel=()=>{this.cancel.emit()},this.onClickEnrollRerun=()=>{this.deleteFetching("enroll"),this.enrollResult=void 0,this.tryGetData()},this.onClickClose=()=>{this.close.emit()},this.onClickTryAgain=async()=>{await this.tryLogin()&&await this.tryGetData()},this.onSubmit=async t=>{this.setFetching("enroll","pending");try{let e;e=t.options.certificate?await h(this,o).createX509(t.provider.providerId,t):await h(this,o).createCSR(t.provider.providerId,t),this.enrollResult={der:e.der,name:t.subject.CN,type:t.options.certificate?"x509":"csr"},this.setFetching("enroll","resolved")}catch(e){this.setFetching("enroll","rejected"),console.error("Error creating x509|csr:",e)}}}componentWillLoad(){n.setLocale(this.language)}componentDidLoad(){(function(t,e,i){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");e.set(t,i)})(this,o,new s({onClose:this.onClose.bind(this),onProvidersAdded:this.tryGetData.bind(this),onProvidersRemoved:this.tryGetData.bind(this)})),this.start()}componentDidUnload(){h(this,o).finish()}onClose(){this.providers=[],this.setFetching("connectionDetect","rejected")}async start(){this.setFetching("connectionDetect","pending"),h(this,o).isConnectionSupported()?(await h(this,o).isConnectionDetected()||this.setFetching("connectionDetect","rejected"),await h(this,o).isConnectionDetectedAuto(),this.setFetching("connectionDetect","pending"),await h(this,o).connect(),await this.tryLogin()&&await this.tryGetData()):this.setFetching("connectionSupport","rejected")}async tryGetData(){this.setFetching("providers","pending"),this.providers=[];try{this.providers=await h(this,o).getProviders(),this.setFetching("providers","resolved")}catch(t){this.setFetching("providers","rejected")}}async tryLogin(){this.challenge=void 0,this.setFetching("connectionApprove","pending");try{const t=await h(this,o).challenge();t&&(this.challenge=t,await h(this,o).login()),this.setFetching("connectionApprove","resolved")}catch(t){return void this.setFetching("connectionApprove","rejected")}return!0}setFetching(t,e){this.isFetching=Object.assign(Object.assign({},this.isFetching),{[t]:e})}deleteFetching(t){this.isFetching=Object.assign(Object.assign({},this.isFetching),{[t]:void 0})}static renderConnecting(){return i("peculiar-fortify-connecting",null)}static renderFortifyAuthorization(t){return i("peculiar-fortify-authorization",{pin:t})}renderFortifyNotDetected(){return i("peculiar-fortify-not-detected",{downloadAppLink:this.downloadAppLink})}static renderFortifyNotSupported(){return i("peculiar-fortify-not-supported",null)}renderChallengeNotApproved(){return i("peculiar-fortify-challenge-not-approved",{onCancel:this.onClickCancel,onTryAgain:this.onClickTryAgain})}renderProvidersEmpty(){return i("peculiar-fortify-providers-empty",{onCancel:this.onClickCancel})}renderEnrollForm(){return i("peculiar-fortify-enrollment-form",{providers:this.providers,ponSubmit:this.onSubmit,ponCancel:this.onClickCancel})}renderEnrollResolved(){return i("peculiar-fortify-enrollment-resolved",{type:this.enrollResult.type,der:this.enrollResult.der,name:this.enrollResult.name,ponClose:this.onClickClose})}renderEnrollRejected(){return i("peculiar-fortify-enrollment-rejected",{ponCancel:this.onClickCancel,ponAccept:this.onClickEnrollRerun})}static renderUnresolvedStatus(){return i("peculiar-fortify-layout",{type:"message",titleValue:"Someting went wrong for status",descriptionValue:"ERROR"})}render(){let t=null;switch(!0){case"rejected"===this.isFetching.connectionSupport:t=a.renderFortifyNotSupported();break;case"rejected"===this.isFetching.connectionDetect:t=this.renderFortifyNotDetected();break;case"rejected"===this.isFetching.connectionApprove:t=this.renderChallengeNotApproved();break;case"pending"===this.isFetching.connectionApprove&&!!this.challenge:t=a.renderFortifyAuthorization(this.challenge);break;case"pending"===this.isFetching.enroll:t=a.renderConnecting();break;case"rejected"===this.isFetching.enroll:t=this.renderEnrollRejected();break;case"resolved"===this.isFetching.enroll:t=this.renderEnrollResolved();break;case"resolved"===this.isFetching.providers&&!this.providers.length:t=this.renderProvidersEmpty();break;case"resolved"===this.isFetching.providers:t=this.renderEnrollForm();break;case"pending"===this.isFetching.connectionDetect:case"pending"===this.isFetching.connectionSupport:case"pending"===this.isFetching.connectionApprove:case"pending"===this.isFetching.providers:t=a.renderConnecting();break;default:t=a.renderUnresolvedStatus()}return i(r,null,i("peculiar-fortify-layout",{hideFooter:this.hideFooter},t))}};o=new WeakMap,a.style=":host{-webkit-box-sizing:border-box;box-sizing:border-box}:host *,:host *:before,:host *:after{-webkit-box-sizing:inherit;box-sizing:inherit}:host{display:block;min-height:550px;height:550px}.title{padding-bottom:20px;border-width:0px 0px 1px 0px}";export{a as peculiar_fortify_enrollment}