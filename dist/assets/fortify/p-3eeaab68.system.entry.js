var __awaiter=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{a(r.next(e))}catch(t){o(t)}}function c(e){try{a(r["throw"](e))}catch(t){o(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((r=r.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:c(0),throw:c(1),return:c(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function c(e){return function(t){return a([e,t])}}function a(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=s[0]&2?i["return"]:s[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;if(i=0,o)s=[s[0]&2,o.value];switch(s[0]){case 0:case 1:o=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;i=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(s[0]===6&&n.label<o[1]){n.label=o[1];o=s;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(s);break}if(o[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(c){s=[6,c];i=0}finally{r=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};System.register(["./p-f0dd3588.system.js","./p-2e76ca07.system.js","./p-99e0707d.system.js","./p-22d0d452.system.js","./p-2adccdb7.system.js"],(function(e){"use strict";var t,n,r,i,o,s;return{setters:[function(e){t=e.r;n=e.c;r=e.h;i=e.H},function(){},function(){},function(e){o=e.F},function(e){s=e.l}],execute:function(){var c=":host{-webkit-box-sizing:border-box;box-sizing:border-box}:host *,:host *:before,:host *:after{-webkit-box-sizing:inherit;box-sizing:inherit}:host{display:block;min-height:550px;height:550px}.title{padding-bottom:20px;border-width:0px 0px 1px 0px}";
/**
             * @license
             * Copyright (c) Peculiar Ventures, LLC.
             *
             * This source code is licensed under the BSD 3-Clause license found in the
             * LICENSE file in the root directory of this source tree.
             */var a=undefined&&undefined.__classPrivateFieldGet||function(e,t){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return t.get(e)};var l=undefined&&undefined.__classPrivateFieldSet||function(e,t,n){if(!t.has(e)){throw new TypeError("attempted to set private field on non-instance")}t.set(e,n);return n};var u;var h=e("peculiar_fortify_enrollment",function(){function e(e){var r=this;t(this,e);this.cancel=n(this,"cancel",7);this.close=n(this,"close",7);u.set(this,void 0);this.providers=[];this.isFetching={connectionDetect:"pending"};this.onClickCancel=function(){r.cancel.emit()};this.onClickEnrollRerun=function(){r.deleteFetching("enroll");r.enrollResult=undefined;r.tryGetData()};this.onClickClose=function(){r.close.emit()};this.onClickTryAgain=function(){return __awaiter(r,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.tryLogin()];case 1:e=t.sent();if(!e){return[2]}return[4,this.tryGetData()];case 2:t.sent();return[2]}}))}))};this.onSubmit=function(e){return __awaiter(r,void 0,void 0,(function(){var t,n;return __generator(this,(function(r){switch(r.label){case 0:this.setFetching("enroll","pending");r.label=1;case 1:r.trys.push([1,6,,7]);t=void 0;if(!e.options.certificate)return[3,3];return[4,a(this,u).createX509(e.provider.providerId,e)];case 2:t=r.sent();return[3,5];case 3:return[4,a(this,u).createCSR(e.provider.providerId,e)];case 4:t=r.sent();r.label=5;case 5:this.enrollResult={der:t.der,name:e.subject.CN,type:e.options.certificate?"x509":"csr"};this.setFetching("enroll","resolved");return[3,7];case 6:n=r.sent();this.setFetching("enroll","rejected");console.error("Error creating x509|csr:",n);return[3,7];case 7:return[2]}}))}))}}e.prototype.componentWillLoad=function(){s.setLocale(this.language)};e.prototype.componentDidLoad=function(){l(this,u,new o({onClose:this.onClose.bind(this),onProvidersAdded:this.tryGetData.bind(this),onProvidersRemoved:this.tryGetData.bind(this)}));this.start()};e.prototype.componentDidUnload=function(){a(this,u).finish()};e.prototype.onClose=function(){this.providers=[];this.setFetching("connectionDetect","rejected")};e.prototype.start=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:this.setFetching("connectionDetect","pending");if(!a(this,u).isConnectionSupported()){this.setFetching("connectionSupport","rejected");return[2]}return[4,a(this,u).isConnectionDetected()];case 1:if(!t.sent()){this.setFetching("connectionDetect","rejected")}return[4,a(this,u).isConnectionDetectedAuto()];case 2:t.sent();this.setFetching("connectionDetect","pending");return[4,a(this,u).connect()];case 3:t.sent();return[4,this.tryLogin()];case 4:e=t.sent();if(!e){return[2]}return[4,this.tryGetData()];case 5:t.sent();return[2]}}))}))};e.prototype.tryGetData=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;return __generator(this,(function(n){switch(n.label){case 0:this.setFetching("providers","pending");this.providers=[];n.label=1;case 1:n.trys.push([1,3,,4]);e=this;return[4,a(this,u).getProviders()];case 2:e.providers=n.sent();this.setFetching("providers","resolved");return[3,4];case 3:t=n.sent();this.setFetching("providers","rejected");return[3,4];case 4:return[2]}}))}))};e.prototype.tryLogin=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;return __generator(this,(function(n){switch(n.label){case 0:this.challenge=undefined;this.setFetching("connectionApprove","pending");n.label=1;case 1:n.trys.push([1,5,,6]);return[4,a(this,u).challenge()];case 2:e=n.sent();if(!e)return[3,4];this.challenge=e;return[4,a(this,u).login()];case 3:n.sent();n.label=4;case 4:this.setFetching("connectionApprove","resolved");return[3,6];case 5:t=n.sent();this.setFetching("connectionApprove","rejected");return[2,undefined];case 6:return[2,true]}}))}))};e.prototype.setFetching=function(e,t){var n;this.isFetching=Object.assign(Object.assign({},this.isFetching),(n={},n[e]=t,n))};e.prototype.deleteFetching=function(e){var t;this.isFetching=Object.assign(Object.assign({},this.isFetching),(t={},t[e]=undefined,t))};e.renderConnecting=function(){return r("peculiar-fortify-connecting",null)};e.renderFortifyAuthorization=function(e){return r("peculiar-fortify-authorization",{pin:e})};e.prototype.renderFortifyNotDetected=function(){return r("peculiar-fortify-not-detected",{downloadAppLink:this.downloadAppLink})};e.renderFortifyNotSupported=function(){return r("peculiar-fortify-not-supported",null)};e.prototype.renderChallengeNotApproved=function(){return r("peculiar-fortify-challenge-not-approved",{onCancel:this.onClickCancel,onTryAgain:this.onClickTryAgain})};e.prototype.renderProvidersEmpty=function(){return r("peculiar-fortify-providers-empty",{onCancel:this.onClickCancel})};e.prototype.renderEnrollForm=function(){return r("peculiar-fortify-enrollment-form",{providers:this.providers,ponSubmit:this.onSubmit,ponCancel:this.onClickCancel})};e.prototype.renderEnrollResolved=function(){return r("peculiar-fortify-enrollment-resolved",{type:this.enrollResult.type,der:this.enrollResult.der,name:this.enrollResult.name,ponClose:this.onClickClose})};e.prototype.renderEnrollRejected=function(){return r("peculiar-fortify-enrollment-rejected",{ponCancel:this.onClickCancel,ponAccept:this.onClickEnrollRerun})};e.renderUnresolvedStatus=function(){return r("peculiar-fortify-layout",{type:"message",titleValue:"Someting went wrong for status",descriptionValue:"ERROR"})};e.prototype.render=function(){var e=null;switch(true){case this.isFetching.connectionSupport==="rejected":e=h.renderFortifyNotSupported();break;case this.isFetching.connectionDetect==="rejected":e=this.renderFortifyNotDetected();break;case this.isFetching.connectionApprove==="rejected":e=this.renderChallengeNotApproved();break;case this.isFetching.connectionApprove==="pending"&&!!this.challenge:e=h.renderFortifyAuthorization(this.challenge);break;case this.isFetching.enroll==="pending":e=h.renderConnecting();break;case this.isFetching.enroll==="rejected":e=this.renderEnrollRejected();break;case this.isFetching.enroll==="resolved":e=this.renderEnrollResolved();break;case this.isFetching.providers==="resolved"&&!this.providers.length:e=this.renderProvidersEmpty();break;case this.isFetching.providers==="resolved":e=this.renderEnrollForm();break;case this.isFetching.connectionDetect==="pending":case this.isFetching.connectionSupport==="pending":case this.isFetching.connectionApprove==="pending":case this.isFetching.providers==="pending":e=h.renderConnecting();break;default:e=h.renderUnresolvedStatus()}return r(i,null,r("peculiar-fortify-layout",{hideFooter:this.hideFooter},e))};return e}());u=new WeakMap;h.style=c}}}));